<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="./../../..">Project Website</a>
      <a href="./indexpage.html">Index</a>
      <a href="./toc.html">Table of Contents</a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Giskard</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Giskard.structures.html#"><span class="id" title="library">structures</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab10"></a><h1 class="section">Local state operations, properties, and transitions</h1>

<div class="paragraph"> </div>

 Local state transitions capture message sending, receiving and processing
behaviors of individual nodes. Local state transitions can be defined as a
quaternary relation on:
<ul class="doclist">
<li> pre-state, 

</li>
<li> incoming message, 

</li>
<li> post-state, and

</li>
<li> outgoing message(s).

</li>
</ul>

<div class="paragraph"> </div>

Valid Giskard local state transitions can be defined as a predicate on these relations. 
<div class="paragraph"> </div>

<a id="lab11"></a><h2 class="section">Local state operations</h2>

<div class="paragraph"> </div>

 The following section defines operations that transform the pre-state
to post-state in local state transitions. 
<div class="paragraph"> </div>

 Received messages are stored in the in buffer. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="received" class="idref" href="#received"><span class="id" title="definition">received</span></a> (<a id="s:1" class="idref" href="#s:1"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="m:2" class="idref" href="#m:2"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#m:2"><span class="id" title="variable">m</span></a> (<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:1"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
Sent messages are stored in the out buffer, as history.  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="sent" class="idref" href="#sent"><span class="id" title="definition">sent</span></a> (<a id="s:3" class="idref" href="#s:3"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="m:4" class="idref" href="#m:4"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#m:4"><span class="id" title="variable">m</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:3"><span class="id" title="variable">s</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="record" class="idref" href="#record"><span class="id" title="definition">record</span></a> (<a id="s:5" class="idref" href="#s:5"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="m:6" class="idref" href="#m:6"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>)  (<a class="idref" href="Giskard.local.html#m:6"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:5"><span class="id" title="variable">s</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="record_plural" class="idref" href="#record_plural"><span class="id" title="definition">record_plural</span></a> (<a id="s:7" class="idref" href="#s:7"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:8" class="idref" href="#lm:8"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>)  (<a class="idref" href="Giskard.local.html#lm:8"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:7"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
Broadcast messages are stored in the in buffer, awaiting processing. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="add" class="idref" href="#add"><span class="id" title="definition">add</span></a> (<a id="s:9" class="idref" href="#s:9"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="m:10" class="idref" href="#m:10"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#m:10"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>)  (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:9"><span class="id" title="variable">s</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="add_plural" class="idref" href="#add_plural"><span class="id" title="definition">add_plural</span></a> (<a id="s:11" class="idref" href="#s:11"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:12" class="idref" href="#lm:12"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#lm:12"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>)  (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:11"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
Invalid messages are removed from the in buffer, and thus unable to be processed. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="discard" class="idref" href="#discard"><span class="id" title="definition">discard</span></a> (<a id="s:13" class="idref" href="#s:13"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="m:14" class="idref" href="#m:14"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#remove"><span class="id" title="definition">remove</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <a class="idref" href="Giskard.local.html#m:14"><span class="id" title="variable">m</span></a> (<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>)) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>)  (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:13"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
Processed messages are removed from the in buffer and added to the counting buffer. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process" class="idref" href="#process"><span class="id" title="definition">process</span></a> (<a id="s:15" class="idref" href="#s:15"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:16" class="idref" href="#msg:16"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#remove"><span class="id" title="definition">remove</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <a class="idref" href="Giskard.local.html#msg:16"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>)) (<a class="idref" href="Giskard.local.html#msg:16"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:15"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
During a normal or abnormal view change, the view is incremented,
and the in message buffer and timeout flag reset. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="increment_view" class="idref" href="#increment_view"><span class="id" title="definition">increment_view</span></a> (<a id="s:17" class="idref" href="#s:17"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:17"><span class="id" title="variable">s</span></a>)) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:17"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:17"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:17"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab12"></a><h2 class="section">Local state properties</h2>

<div class="paragraph"> </div>

 The following section defines properties that constitute pre- and post- conditions
for local state transitions. 
<div class="paragraph"> </div>

 A message has a valid view with respect to a local state when it is equal to the
local state's current view. Nodes only process "non-expired" messages sent in its current view. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="view_valid" class="idref" href="#view_valid"><span class="id" title="definition">view_valid</span></a> (<a id="s:18" class="idref" href="#s:18"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:19" class="idref" href="#msg:19"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:18"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:19"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="view_validb" class="idref" href="#view_validb"><span class="id" title="definition">view_validb</span></a> (<a id="s:20" class="idref" href="#s:20"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:21" class="idref" href="#msg:21"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:20"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:21"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab13"></a><h3 class="section">Byzantine behavior</h3>

<div class="paragraph"> </div>

 The primary form of Byzantine behavior Giskard considers is double voting:
sending two PrepareVote messages for two different blocks of the same height within the same view.
We call two messages equivocating if they evidence double voting behavior of their sender. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="equivocating_messages" class="idref" href="#equivocating_messages"><span class="id" title="definition">equivocating_messages</span></a> (<a id="s:22" class="idref" href="#s:22"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg1:23" class="idref" href="#msg1:23"><span class="id" title="binder">msg1</span></a> <a id="msg2:24" class="idref" href="#msg2:24"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg1:23"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:22"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg2:24"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:22"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg1:23"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg2:24"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg1:23"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg2:24"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg1:23"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg2:24"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg1:23"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg2:24"><span class="id" title="variable">msg2</span></a>).<br/>

<br/>
</div>

<div class="doc">
Duplicate block checking for either:
<ul class="doclist">
<li> a PrepareVote message in the processed message buffer for a different block of the same height, or

</li>
<li> a PrepareVote or PrepareQC message in the sent message buffer for a different block of the same height. 
</li>
</ul>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="exists_same_height_block_old" class="idref" href="#exists_same_height_block_old"><span class="id" title="definition">exists_same_height_block_old</span></a> (<a id="s:25" class="idref" href="#s:25"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:26" class="idref" href="#b:26"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Either&nbsp;PrepareBlock&nbsp;has&nbsp;been&nbsp;processed,&nbsp;but&nbsp;no&nbsp;vote&nbsp;has&nbsp;been&nbsp;cast&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:27" class="idref" href="#msg:27"><span class="id" title="binder">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:27"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:25"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:27"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.local.html#b:26"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:27"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#b:26"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:27"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Or&nbsp;a&nbsp;PrepareVote&nbsp;or&nbsp;PrepareQC&nbsp;has&nbsp;been&nbsp;sent&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:28" class="idref" href="#msg:28"><span class="id" title="binder">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:28"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:25"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:28"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:28"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.local.html#b:26"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:28"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#b:26"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:28"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="exists_same_height_block" class="idref" href="#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> (<a id="s:29" class="idref" href="#s:29"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:30" class="idref" href="#b:30"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:31" class="idref" href="#msg:31"><span class="id" title="binder">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:31"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:29"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:31"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.local.html#b:30"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:31"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#b:30"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:31"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="exists_same_height_PrepareBlock" class="idref" href="#exists_same_height_PrepareBlock"><span class="id" title="definition">exists_same_height_PrepareBlock</span></a> (<a id="s:32" class="idref" href="#s:32"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:33" class="idref" href="#b:33"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:34" class="idref" href="#msg:34"><span class="id" title="binder">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:34"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:32"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:34"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.local.html#b:33"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:34"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#b:33"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:34"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="same_height_block_msg" class="idref" href="#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a> (<a id="b:35" class="idref" href="#b:35"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="msg:36" class="idref" href="#msg:36"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:36"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.local.html#b:35"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:36"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;<a class="idref" href="Giskard.local.html#b:35"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:36"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="same_height_block_msg_dec" class="idref" href="#same_height_block_msg_dec"><span class="id" title="definition">same_height_block_msg_dec</span></a> (<a id="b:37" class="idref" href="#b:37"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="msg:38" class="idref" href="#msg:38"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">{</span></a> <a class="idref" href="Giskard.local.html#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a> <a class="idref" href="Giskard.local.html#b:37"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.local.html#msg:38"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}+{</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a> <a class="idref" href="Giskard.local.html#b:37"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.local.html#msg:38"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#message_type_eq_dec"><span class="id" title="definition">message_type_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a>).<br/>
- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <span class="id" title="var">b</span>) (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>))).<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#block_eq_dec"><span class="id" title="definition">block_eq_dec</span></a> <span class="id" title="var">b</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
- <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Program Definition</span> <a id="exists_same_height_block_dec" class="idref" href="#exists_same_height_block_dec"><span class="id" title="definition">exists_same_height_block_dec</span></a> (<a id="s:39" class="idref" href="#s:39"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:40" class="idref" href="#b:40"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) :<br/>
&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">{</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> <a class="idref" href="Giskard.local.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:40"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}+{</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> <a class="idref" href="Giskard.local.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:40"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}</span></a> :=<br/>
<span class="id" title="keyword">match</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#Exists_dec"><span class="id" title="lemma">Exists_dec</span></a> (<a class="idref" href="Giskard.local.html#same_height_block_msg"><span class="id" title="definition">same_height_block_msg</span></a> <a class="idref" href="Giskard.local.html#b:40"><span class="id" title="variable">b</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:39"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.local.html#same_height_block_msg_dec"><span class="id" title="definition">same_height_block_msg_dec</span></a> <a class="idref" href="Giskard.local.html#b:40"><span class="id" title="variable">b</span></a>) <span class="id" title="keyword">with</span><br/>
| <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#left"><span class="id" title="constructor">left</span></a> <span class="id" title="var">H_dec</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#left"><span class="id" title="constructor">left</span></a> <span class="id" title="var">_</span><br/>
| <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#right"><span class="id" title="constructor">right</span></a> <span class="id" title="var">H_dec</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Specif.html#right"><span class="id" title="constructor">right</span></a> <span class="id" title="var">_</span><br/>
<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">Heq_anonymous</span>.<br/>
<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#Exists_exists"><span class="id" title="lemma">Exists_exists</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_dec</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_dec</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">Next</span> <span class="id" title="keyword">Obligation</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">Heq_anonymous</span>.<br/>
<span class="id" title="tactic">intro</span>.<br/>
<span class="id" title="var">contradict</span> <span class="id" title="var">H_dec</span>.<br/>
<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#Exists_exists"><span class="id" title="lemma">Exists_exists</span></a>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="exists_same_height_blockb" class="idref" href="#exists_same_height_blockb"><span class="id" title="definition">exists_same_height_blockb</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;<span class="id" title="keyword">fun</span> <a id="s:41" class="idref" href="#s:41"><span class="id" title="binder">s</span></a> <a id="b:42" class="idref" href="#b:42"><span class="id" title="binder">b</span></a> =&gt; <span class="id" title="keyword">if</span> <a class="idref" href="Giskard.local.html#exists_same_height_block_dec"><span class="id" title="definition">exists_same_height_block_dec</span></a> <a class="idref" href="Giskard.local.html#s:41"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:42"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="exists_same_height_block_correct" class="idref" href="#exists_same_height_block_correct"><span class="id" title="lemma">exists_same_height_block_correct</span></a> : <span class="id" title="keyword">forall</span> (<a id="s:43" class="idref" href="#s:43"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:44" class="idref" href="#b:44"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;<a class="idref" href="Giskard.local.html#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> <a class="idref" href="Giskard.local.html#s:43"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:44"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_blockb"><span class="id" title="definition">exists_same_height_blockb</span></a> <a class="idref" href="Giskard.local.html#s:43"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:44"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#exists_same_height_blockb"><span class="id" title="definition">exists_same_height_blockb</span></a>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.local.html#exists_same_height_block_dec"><span class="id" title="definition">exists_same_height_block_dec</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab14"></a><h3 class="section">Prepare stage definitions</h3>

<div class="paragraph"> </div>

 Blocks in Giskard go through three stages: Prepare, Precommit and Commit.
The local definitions of these three stages are: 
<ul class="doclist">
<li> a block is in prepare stage in some local state s iff it has received quorum PrepareVote messages
  or a PrepareQC message in the current view or some previous view, and

</li>
<li> a block is in precommit stage in some local state s iff its child block is in prepare stage in s, and

</li>
<li> a block is in commit stage in some local state s iff its child block is in precommit stage in s. 
</li>
</ul>

<div class="paragraph"> </div>

 We can parameterize the definition of a block being in prepare stage by some view. 
<div class="paragraph"> </div>

 Processed PrepareVote messages in some view about some block: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="processed_PrepareVote_in_view_about_block" class="idref" href="#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> (<a id="s:45" class="idref" href="#s:45"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:46" class="idref" href="#view:46"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b:47" class="idref" href="#b:47"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:48" class="idref" href="#msg:48"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:48"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:48"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#b:47"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:48"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#view:46"><span class="id" title="variable">view</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:45"><span class="id" title="variable">s</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_quorum_in_view" class="idref" href="#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a id="s:49" class="idref" href="#s:49"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:50" class="idref" href="#view:50"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b:51" class="idref" href="#b:51"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> (<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> <a class="idref" href="Giskard.local.html#s:49"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:50"><span class="id" title="variable">view</span></a> <a class="idref" href="Giskard.local.html#b:51"><span class="id" title="variable">b</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="PrepareQC_in_view" class="idref" href="#PrepareQC_in_view"><span class="id" title="definition">PrepareQC_in_view</span></a> (<a id="s:52" class="idref" href="#s:52"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:53" class="idref" href="#view:53"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b:54" class="idref" href="#b:54"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:55" class="idref" href="#msg:55"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:55"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:52"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:55"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#view:53"><span class="id" title="variable">view</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:55"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#b:54"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:55"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_in_view" class="idref" href="#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a id="s:56" class="idref" href="#s:56"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:57" class="idref" href="#view:57"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b:58" class="idref" href="#b:58"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> <a class="idref" href="Giskard.local.html#s:56"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:57"><span class="id" title="variable">view</span></a> <a class="idref" href="Giskard.local.html#b:58"><span class="id" title="variable">b</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#PrepareQC_in_view"><span class="id" title="definition">PrepareQC_in_view</span></a> <a class="idref" href="Giskard.local.html#s:56"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:57"><span class="id" title="variable">view</span></a> <a class="idref" href="Giskard.local.html#b:58"><span class="id" title="variable">b</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_in_viewb" class="idref" href="#prepare_stage_in_viewb"><span class="id" title="definition">prepare_stage_in_viewb</span></a>  (<a id="s:59" class="idref" href="#s:59"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:60" class="idref" href="#view:60"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b:61" class="idref" href="#b:61"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorumb"><span class="id" title="definition">quorumb</span></a> (<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> <a class="idref" href="Giskard.local.html#s:59"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:60"><span class="id" title="variable">view</span></a> <a class="idref" href="Giskard.local.html#b:61"><span class="id" title="variable">b</span></a>) <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#existsb"><span class="id" title="definition">existsb</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:62" class="idref" href="#msg:62"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:62"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:62"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#view:60"><span class="id" title="variable">view</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:62"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#b:61"><span class="id" title="variable">b</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:59"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
We use this parameterized definition to define the general version of a block being
in prepare stage: A block has reached prepare stage in some state iff it has reached prepare
stage in some view that is less than or equal to the current view. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage" class="idref" href="#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a id="s:63" class="idref" href="#s:63"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:64" class="idref" href="#b:64"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="v':65" class="idref" href="#v':65"><span class="id" title="binder">v'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.local.html#v':65"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:63"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> <a class="idref" href="Giskard.local.html#s:63"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#v':65"><span class="id" title="variable">v'</span></a> <a class="idref" href="Giskard.local.html#b:64"><span class="id" title="variable">b</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab15"></a><h3 class="section">View change definitions</h3>

<div class="paragraph"> </div>

 Participating nodes in Giskard vote in units of time called views. Each view has the same
fixed set of participating nodes, which consists oof one block proposer for the view, and
validators. Participating nodes take turns to be the block proposer, and the identity of
the block proposer for any given view is known to all participating nodes. A view generally
proceeds as follows: at the beginning of the view, the block proposer proposes a fixed
number of blocks, which validators vote on. If all blocks receive quorum votes, the nodes
increment their local view and wait for new block proposals in the new view. Otherwise,
a timeout occurs, and nodes exchange messages to communicate their acknowledgement of the
timeout and determine the parent block for the first block of the new view. The end of a
view for a participating node is marked by either: 
<ul class="doclist">
<li> the last block proposed by the block proposer reaching prepare stage in its local state, or 

</li>
<li> the receipt of a ViewChangeQC message following a timeout.

</li>
</ul>

<div class="paragraph"> </div>

We call the former a normal view change, and the latter an abnormal view change.
Because we assume that all local clocks are synchronized, in the case of an abnormal
view change, all nodes timeout at once. However, because nodes process messages at
different speeds, blocks reach prepare stage at different speeds, and consequently,
in the case of a normal view change, nodes are not guaranteed to increment their
local view at the same time. 
<div class="paragraph"> </div>

 In the case of an abnormal view change, the timeout flag is simultaneously flipped
for all participating nodes, and each sends a ViewChange message containing their
local highest block at prepare stage. Nodes then enter a liminal stage in which only
three kinds of messages can be processed: PrepareQC, ViewChange and ViewChangeQC. 
<div class="paragraph"> </div>

 Nodes will ignore all block proposals and block votes during this stage. Upon
receiving quorum ViewChange messages, validator nodes increment their view and wait
for new blocks to be proposed. The new block proposer aggregates the max height
block from its received ViewChange messages, and uses it to produce new blocks
for the new view. 
<div class="paragraph"> </div>

 The following section contains definitions required for abnormal view changes. 
<div class="paragraph"> </div>

 Quorum ViewChange messages in some view: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="processed_ViewChange_in_view" class="idref" href="#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> (<a id="s:66" class="idref" href="#s:66"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:67" class="idref" href="#view:67"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:68" class="idref" href="#msg:68"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:68"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:68"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#view:67"><span class="id" title="variable">view</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:66"><span class="id" title="variable">s</span></a>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="processed_ViewChange_in_view_correct" class="idref" href="#processed_ViewChange_in_view_correct"><span class="id" title="lemma">processed_ViewChange_in_view_correct</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:69" class="idref" href="#s:69"><span class="id" title="binder">s</span></a> <a id="view:70" class="idref" href="#view:70"><span class="id" title="binder">view</span></a> <a id="msg:71" class="idref" href="#msg:71"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:71"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <a class="idref" href="Giskard.local.html#s:69"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:70"><span class="id" title="variable">view</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:71"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:69"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:71"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:71"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#view:70"><span class="id" title="variable">view</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">view</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_typeview</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeview</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeview</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="view_change_quorum_in_view" class="idref" href="#view_change_quorum_in_view"><span class="id" title="definition">view_change_quorum_in_view</span></a> (<a id="s:72" class="idref" href="#s:72"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:73" class="idref" href="#view:73"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <a class="idref" href="Giskard.local.html#s:72"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:73"><span class="id" title="variable">view</span></a>).<br/>

<br/>
</div>

<div class="doc">
Maximum height block from all processed ViewChange messages in view: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="highest_ViewChange_block_in_view" class="idref" href="#highest_ViewChange_block_in_view"><span class="id" title="definition">highest_ViewChange_block_in_view</span></a> (<a id="s:74" class="idref" href="#s:74"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:75" class="idref" href="#view:75"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#fold_right"><span class="id" title="definition">fold_right</span></a> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a>) (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <a class="idref" href="Giskard.local.html#s:74"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:75"><span class="id" title="variable">view</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="highest_ViewChange_block_height_in_view" class="idref" href="#highest_ViewChange_block_height_in_view"><span class="id" title="definition">highest_ViewChange_block_height_in_view</span></a> (<a id="s:76" class="idref" href="#s:76"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:77" class="idref" href="#view:77"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_block_in_view"><span class="id" title="definition">highest_ViewChange_block_in_view</span></a> <a class="idref" href="Giskard.local.html#s:76"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:77"><span class="id" title="variable">view</span></a>).<br/>

<br/>
</div>

<div class="doc">
The last block of each view is identifiable to each participating node:  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="last_block" class="idref" href="#last_block"><span class="id" title="definition">last_block</span></a> (<a id="b:78" class="idref" href="#b:78"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_last"><span class="id" title="definition">b_last</span></a> <a class="idref" href="Giskard.local.html#b:78"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
</div>

<div class="doc">
Because not every view is guaranteed to have a block in prepare stage,
the definition of <tt>highest_prepare_block_in_view</tt> must be able to recursively
search for the highest prepare block in all past views: 
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <a id="highest_prepare_block_in_view" class="idref" href="#highest_prepare_block_in_view"><span class="id" title="definition">highest_prepare_block_in_view</span></a> (<a id="s:79" class="idref" href="#s:79"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="view:80" class="idref" href="#view:80"><span class="id" title="binder">view</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Giskard.local.html#view:80"><span class="id" title="variable">view</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">view'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#fold_right"><span class="id" title="definition">fold_right</span></a> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#highest_prepare_block_in_view:81"><span class="id" title="definition">highest_prepare_block_in_view</span></a> <a class="idref" href="Giskard.local.html#s:79"><span class="id" title="variable">s</span></a> <span class="id" title="var">view'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:83" class="idref" href="#msg:83"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="Giskard.local.html#prepare_stage_in_viewb"><span class="id" title="definition">prepare_stage_in_viewb</span></a> <a class="idref" href="Giskard.local.html#s:79"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#view:80"><span class="id" title="variable">view</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:83"><span class="id" title="variable">msg</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:79"><span class="id" title="variable">s</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The following definition constructs the ViewChange message to be
sent by each participating node upon a timeout. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="highest_prepare_block_message" class="idref" href="#highest_prepare_block_message"><span class="id" title="definition">highest_prepare_block_message</span></a> (<a id="s:84" class="idref" href="#s:84"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:84"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:84"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#highest_prepare_block_in_view"><span class="id" title="definition">highest_prepare_block_in_view</span></a> <a class="idref" href="Giskard.local.html#s:84"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:84"><span class="id" title="variable">s</span></a>)) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab16"></a><h2 class="section">Message construction</h2>

<div class="paragraph"> </div>

 In Giskard, some message types "carry" other messages: 
<ul class="doclist">
<li> PrepareBlock messages for the first block in a view carry the PrepareQC
  message of its parent block, PrepareBlock messages for non-first blocks
  carry the PrepareQC of the parent block of the first block, and

</li>
<li> PrepareVote messages carry the PrepareQC message of its parent block, and

</li>
<li> ViewChange messages carry the PrepareQC message of the highest local
  prepare stage block. 
</li>
</ul>

<div class="paragraph"> </div>

 We do not model this at the type level (i.e., by having inductive message
type definitions), but rather simulate this behavior using pre- and post-conditions
in our local transitions. For example, a node only processes a PrepareBlock message
in the in message buffer if the PrepareQC message that is "piggybacked" onto has also
been received, and the transition effectively processes both of these messages in one step. 
<div class="paragraph"> </div>

 PrepareBlocks are computed from either: 
<ul class="doclist">
<li> the final PrepareVote/PrepareQC message of the previous round, or 

</li>
<li> the ViewChangeQC from the previous round. 

</li>
</ul>

<div class="paragraph"> </div>

The messages in both of these cases contain the parent block for the newly proposed blocks.
Note that because blocks are proposed in sequence, only the first PrepareBlock message carries
the parent block's PrepareQC message - the remaining blocks cannot do so because their parent
blocks have not reached prepare stage yet, and therefore their PrepareQC messages cannot exist.
Therefore, all PrepareBlock messages in a view carry the same PrepareQC message: that of
the first block's parent. 
<div class="paragraph"> </div>

 Note that although all PrepareBlock messages are produced and sent together in one
single transition, this does not mean that:
<ul class="doclist">
<li> they are processed at the same time, and

</li>
<li> we falsely enforce the discipline that the second proposed block contains the first
  block's PrepareQC when in fact it has not reached PrepareQC. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="make_PrepareBlocks" class="idref" href="#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> (<a id="s:85" class="idref" href="#s:85"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="previous_msg:86" class="idref" href="#previous_msg:86"><span class="id" title="binder">previous_msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[(</span></a><a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>)) <span class="comment">(*&nbsp;New&nbsp;block&nbsp;produced&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>) <span class="comment">(*&nbsp;PrepareQC&nbsp;of&nbsp;highest&nbsp;block&nbsp;from&nbsp;previous&nbsp;round&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>))) <span class="comment">(*&nbsp;New&nbsp;block&nbsp;produced&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>) <span class="comment">(*&nbsp;PrepareQC&nbsp;of&nbsp;highest&nbsp;block&nbsp;from&nbsp;previous&nbsp;round&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:85"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;particular,&nbsp;here&nbsp;we&nbsp;produce&nbsp;a&nbsp;block&nbsp;that&nbsp;is&nbsp;labeled&nbsp;as&nbsp;last&nbsp;block&nbsp;for&nbsp;the&nbsp;view&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_last_block"><span class="id" title="axiom">generate_last_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>)))) <span class="comment">(*&nbsp;New&nbsp;block&nbsp;produced&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#previous_msg:86"><span class="id" title="variable">previous_msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">)]</span></a>. <span class="comment">(*&nbsp;PrepareQC&nbsp;of&nbsp;highest&nbsp;block&nbsp;from&nbsp;previous&nbsp;round&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="make_PrepareBlocks_message_type" class="idref" href="#make_PrepareBlocks_message_type"><span class="id" title="lemma">make_PrepareBlocks_message_type</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:87" class="idref" href="#s:87"><span class="id" title="binder">s</span></a> <a id="msg0:88" class="idref" href="#msg0:88"><span class="id" title="binder">msg0</span></a> <a id="msg:89" class="idref" href="#msg:89"><span class="id" title="binder">msg</span></a>, <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:89"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> <a class="idref" href="Giskard.local.html#s:87"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg0:88"><span class="id" title="variable">msg0</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:89"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> | [<span class="id" title="var">H</span> | [<span class="id" title="var">H</span> | <span class="id" title="var">H</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A <tt>PrepareVote</tt> carries the <tt>PrepareQC</tt> of its parent, and can only be sent
after parent block reaches prepare stage, which means one of its inputs must be
either a <tt>PrepareVote</tt> or <tt>PrepareQC</tt>. 
<div class="paragraph"> </div>

 <tt>PrepareVote</tt>s are also computed from <tt>PrepareBlock</tt> messages,
which means another one of its inputs must be a <tt>PrepareBlock</tt> message. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="make_PrepareVote" class="idref" href="#make_PrepareVote"><span class="id" title="definition">make_PrepareVote</span></a> (<a id="s:90" class="idref" href="#s:90"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="quorum_msg:91" class="idref" href="#quorum_msg:91"><span class="id" title="binder">quorum_msg</span></a> <a id="prepareblock_msg:92" class="idref" href="#prepareblock_msg:92"><span class="id" title="binder">prepareblock_msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <span class="comment">(*&nbsp;message&nbsp;type&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:90"><span class="id" title="variable">s</span></a>) <span class="comment">(*&nbsp;view&nbsp;number&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:90"><span class="id" title="variable">s</span></a>) <span class="comment">(*&nbsp;node&nbsp;id&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#prepareblock_msg:92"><span class="id" title="variable">prepareblock_msg</span></a>) <span class="comment">(*&nbsp;block&nbsp;to&nbsp;vote&nbsp;for&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#quorum_msg:91"><span class="id" title="variable">quorum_msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
Nodes create <tt>PrepareVote</tt> messages upon receiving <tt>PrepareBlock</tt> messages
for each block, and "wait" to send it until the parent block reaches prepare stage.
This is modeled by constructing <tt>PrepareVote</tt> messages on-demand given that:
<ul class="doclist">
<li> the parent block has just reached prepare stage, and

</li>
<li> a <tt>PrepareBlock</tt> message exists for the child block.

<div class="paragraph"> </div>

 Constructing pending PrepareVote messages for child messages with existing PrepareBlocks. 
</li>
</ul>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="pending_PrepareVote" class="idref" href="#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> (<a id="s:93" class="idref" href="#s:93"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="quorum_msg:94" class="idref" href="#quorum_msg:94"><span class="id" title="binder">quorum_msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> (<span class="id" title="keyword">fun</span> <a id="prepare_block_msg:96" class="idref" href="#prepare_block_msg:96"><span class="id" title="binder">prepare_block_msg</span></a> =&gt; <a class="idref" href="Giskard.local.html#make_PrepareVote"><span class="id" title="definition">make_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:93"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#quorum_msg:94"><span class="id" title="variable">quorum_msg</span></a> <a class="idref" href="Giskard.local.html#prepare_block_msg:96"><span class="id" title="variable">prepare_block_msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:95" class="idref" href="#msg:95"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:95"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#quorum_msg:94"><span class="id" title="variable">quorum_msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="Giskard.local.html#exists_same_height_blockb"><span class="id" title="definition">exists_same_height_blockb</span></a> <a class="idref" href="Giskard.local.html#s:93"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:95"><span class="id" title="variable">msg</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#parent_ofb"><span class="id" title="axiom">parent_ofb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:95"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#quorum_msg:94"><span class="id" title="variable">quorum_msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:95"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:93"><span class="id" title="variable">s</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="pending_PrepareVote_correct" class="idref" href="#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:97" class="idref" href="#s:97"><span class="id" title="binder">s</span></a> <a id="msg0:98" class="idref" href="#msg0:98"><span class="id" title="binder">msg0</span></a> <a id="msg:99" class="idref" href="#msg:99"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:99"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:97"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg0:98"><span class="id" title="variable">msg0</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:99"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.local.html#msg:99"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:97"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:99"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:97"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_type'</span> <span class="id" title="var">H</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_type'</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#make_PrepareVote"><span class="id" title="definition">make_PrepareVote</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
PrepareQC messages carry nothing, and can only be sent after a quorum number of PrepareVotes,
which means its only input is a PrepareVote containing the relevant block. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="make_PrepareQC" class="idref" href="#make_PrepareQC"><span class="id" title="definition">make_PrepareQC</span></a> (<a id="s:100" class="idref" href="#s:100"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:101" class="idref" href="#msg:101"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:100"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:100"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:101"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>.<br/>

<br/>
</div>

<div class="doc">
ViewChange messages carry the <tt>PrepareQC</tt> message of the highest block to
reach prepare stage, and since they are triggered by timeouts, no input
message is required: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="make_ViewChange" class="idref" href="#make_ViewChange"><span class="id" title="definition">make_ViewChange</span></a> (<a id="s:102" class="idref" href="#s:102"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:102"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:102"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#highest_prepare_block_in_view"><span class="id" title="definition">highest_prepare_block_in_view</span></a> <a class="idref" href="Giskard.local.html#s:102"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:102"><span class="id" title="variable">s</span></a>))<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>.<br/>

<br/>
</div>

<div class="doc">
Upon receiving quorum <tt>ViewChange</tt> messages, the block proposer for the new
view aggregates the max height block from all the <tt>ViewChange</tt> messages and
sends a <tt>ViewChangeQC</tt> containing this block, alongside a <tt>PrepareQC</tt> message
evidencing its prepare stage. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="make_ViewChangeQC" class="idref" href="#make_ViewChangeQC"><span class="id" title="definition">make_ViewChangeQC</span></a> (<a id="s:103" class="idref" href="#s:103"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="highest_msg:104" class="idref" href="#highest_msg:104"><span class="id" title="binder">highest_msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:103"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:103"><span class="id" title="variable">s</span></a>) <br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#highest_msg:104"><span class="id" title="variable">highest_msg</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab17"></a><h2 class="section">Local state transitions</h2>

<div class="paragraph"> </div>

 Nodes are responsible for processing messages and updating their local state;
broadcasting outgoing messages is handled by the network. 
<div class="paragraph"> </div>

 In the following section, Giskard local state transitions are organized
according to the type of message being processed. 
<div class="paragraph"> </div>

<a id="lab18"></a><h3 class="section">Message type-agnostic actions</h3>

<div class="paragraph"> </div>

 Block proposal-related definitions: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="GenesisBlock_message" class="idref" href="#GenesisBlock_message"><span class="id" title="definition">GenesisBlock_message</span></a> (<a id="s:105" class="idref" href="#s:105"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a><br/>
&nbsp;&nbsp;0<br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:105"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="propose_block_init" class="idref" href="#propose_block_init"><span class="id" title="definition">propose_block_init</span></a> (<a id="s:106" class="idref" href="#s:106"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:107" class="idref" href="#msg:107"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':108" class="idref" href="#s':108"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:109" class="idref" href="#lm:109"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':108"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#GenesisBlock_message"><span class="id" title="definition">GenesisBlock_message</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:109"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#GenesisBlock_message"><span class="id" title="definition">GenesisBlock_message</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#NState_init"><span class="id" title="definition">NState_init</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a>) 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:106"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>

<br/>
</div>

<div class="doc">
When the timeout happens, nodes enter a liminal phase where they are only allowed
to process the following kinds of messages: 
<ul class="doclist">
<li> ViewChange from other nodes

</li>
<li> ViewChangeQC 

</li>
<li> PrepareQC 
</li>
</ul>

<div class="paragraph"> </div>

 Upon timeout, nodes send a ViewChange message containing the highest block to reach
Prepare stage in its current view, and the PrepareQC message attesting to that block's Prepare stage. 
</div>
<div class="code">
<span class="comment">(*&nbsp;It&nbsp;does&nbsp;not&nbsp;increment&nbsp;the&nbsp;view&nbsp;yet&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="process_timeout" class="idref" href="#process_timeout"><span class="id" title="definition">process_timeout</span></a> (<a id="s:110" class="idref" href="#s:110"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:111" class="idref" href="#msg:111"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':112" class="idref" href="#s':112"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:113" class="idref" href="#lm:113"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':112"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="Giskard.local.html#make_ViewChange"><span class="id" title="definition">make_ViewChange</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="Giskard.local.html#highest_prepare_block_message"><span class="id" title="definition">highest_prepare_block_message</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:113"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="Giskard.local.html#make_ViewChange"><span class="id" title="definition">make_ViewChange</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="Giskard.local.html#highest_prepare_block_message"><span class="id" title="definition">highest_prepare_block_message</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:110"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
</div>

<div class="doc">
An expired message - discard and do not process. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="discard_view_invalid" class="idref" href="#discard_view_invalid"><span class="id" title="definition">discard_view_invalid</span></a> (<a id="s:114" class="idref" href="#s:114"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:115" class="idref" href="#msg:115"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':116" class="idref" href="#s':116"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:117" class="idref" href="#lm:117"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':116"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#discard"><span class="id" title="definition">discard</span></a> <a class="idref" href="Giskard.local.html#s:114"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:115"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:117"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:114"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:115"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:114"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:114"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:115"><span class="id" title="variable">msg</span></a>.<br/>
<span class="comment">(*&nbsp;At&nbsp;this&nbsp;point&nbsp;it&nbsp;doesn't&nbsp;matter&nbsp;whether&nbsp;timeout&nbsp;has&nbsp;occurred&nbsp;or&nbsp;not&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<a id="lab19"></a><h3 class="section">PrepareBlock message-related actions</h3>

<div class="paragraph"> </div>

 If a same height block has been seen - discard the message: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareBlock_duplicate" class="idref" href="#process_PrepareBlock_duplicate"><span class="id" title="definition">process_PrepareBlock_duplicate</span></a> (<a id="s:118" class="idref" href="#s:118"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:119" class="idref" href="#msg:119"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':120" class="idref" href="#s':120"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:121" class="idref" href="#lm:121"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':120"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#discard"><span class="id" title="definition">discard</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:119"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:121"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:119"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:119"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:119"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#exists_same_height_PrepareBlock"><span class="id" title="definition">exists_same_height_PrepareBlock</span></a> <a class="idref" href="Giskard.local.html#s:118"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:119"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
Parent block has not reached Prepare - "add its PrepareVote to pending buffer" by simply
processing the PrepareBlock message and waiting for parent block to reach quorum: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareBlock_pending_vote" class="idref" href="#process_PrepareBlock_pending_vote"><span class="id" title="definition">process_PrepareBlock_pending_vote</span></a> (<a id="s:122" class="idref" href="#s:122"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:123" class="idref" href="#msg:123"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':124" class="idref" href="#s':124"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:125" class="idref" href="#lm:125"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':124"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:125"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;PrepareBlocks&nbsp;cannot&nbsp;be&nbsp;processed&nbsp;during&nbsp;timeout&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_PrepareBlock"><span class="id" title="definition">exists_same_height_PrepareBlock</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Parent&nbsp;block&nbsp;has&nbsp;not&nbsp;reached&nbsp;Prepare&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <a class="idref" href="Giskard.local.html#s:122"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:123"><span class="id" title="variable">msg</span></a>)).<br/>

<br/>
</div>

<div class="doc">
Parent block has reached QC - send PrepareVote for the block in that message and record in out buffer: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareBlock_vote" class="idref" href="#process_PrepareBlock_vote"><span class="id" title="definition">process_PrepareBlock_vote</span></a> (<a id="s:126" class="idref" href="#s:126"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:127" class="idref" href="#msg:127"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':128" class="idref" href="#s':128"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:129" class="idref" href="#lm:129"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':128"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="comment">(*&nbsp;Record&nbsp;outgoing&nbsp;PrepareVote&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:129"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;PrepareBlocks&nbsp;cannot&nbsp;be&nbsp;processed&nbsp;during&nbsp;timeout&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <a class="idref" href="Giskard.local.html#s:126"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:127"><span class="id" title="variable">msg</span></a>)).<br/>

<br/>
</div>

<div class="doc">
<a id="lab20"></a><h3 class="section">PrepareVote message-related actions</h3>

<div class="paragraph"> </div>

 Block has not reached prepare stage - wait to send PrepareVote messages for child: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareVote_wait" class="idref" href="#process_PrepareVote_wait"><span class="id" title="definition">process_PrepareVote_wait</span></a> (<a id="s:130" class="idref" href="#s:130"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:131" class="idref" href="#msg:131"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':132" class="idref" href="#s':132"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:133" class="idref" href="#lm:133"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':132"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:133"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;PrepareVotes&nbsp;cannot&nbsp;be&nbsp;processed&nbsp;during&nbsp;timeout&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:130"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:131"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
Block is about to reach QC - send PrepareVote messages for child block if it exists and send PrepareQC: 
</div>
<div class="code">
<span class="comment">(*&nbsp;vote_quorum&nbsp;means&nbsp;quorum&nbsp;PrepareVote&nbsp;messages&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="process_PrepareVote_vote" class="idref" href="#process_PrepareVote_vote"><span class="id" title="definition">process_PrepareVote_vote</span></a> (<a id="s:134" class="idref" href="#s:134"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:135" class="idref" href="#msg:135"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':136" class="idref" href="#s':136"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:137" class="idref" href="#lm:137"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':136"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_PrepareQC"><span class="id" title="definition">make_PrepareQC</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:137"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_PrepareQC"><span class="id" title="definition">make_PrepareQC</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;PrepareVotes&nbsp;cannot&nbsp;be&nbsp;processed&nbsp;during&nbsp;timeout&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:134"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:135"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab21"></a><h3 class="section">PrepareQC message-related actions</h3>

<div class="paragraph"> </div>

 PrepareQC messages are considered equivalent to a quorum of PrepareVote messages. 
PrepareQC messages can be processed after timeout, so we do not require that timeout
has not occurred. 
<div class="paragraph"> </div>

 The PrepareQC message suffices to directly quorum a block, even if it has not received
enough PrepareVote messages, 
<div class="paragraph"> </div>

 Last block in view for to-be block proposer undergoing normal view change process:
<ul class="doclist">
<li> increment view, and

</li>
<li> propose block at height <tt>(S n)</tt>. 
</li>
</ul>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="process_PrepareQC_last_block_new_proposer" class="idref" href="#process_PrepareQC_last_block_new_proposer"><span class="id" title="definition">process_PrepareQC_last_block_new_proposer</span></a> (<a id="s:138" class="idref" href="#s:138"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:139" class="idref" href="#msg:139"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':140" class="idref" href="#s':140"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:141" class="idref" href="#lm:141"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Increment&nbsp;the&nbsp;view;&nbsp;propose&nbsp;next&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':140"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;All&nbsp;to-propose&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;block&nbsp;generating&nbsp;function&nbsp;starts&nbsp;at&nbsp;the&nbsp;input&nbsp;block&nbsp;height&nbsp;plus&nbsp;one&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> (<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a>)) <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:141"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="comment">(*&nbsp;Send&nbsp;all&nbsp;block&nbsp;proposals&nbsp;for&nbsp;the&nbsp;new&nbsp;view&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> (<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a>)) <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Here&nbsp;we&nbsp;don't&nbsp;need&nbsp;for&nbsp;timeout&nbsp;to&nbsp;be&nbsp;false&nbsp;because&nbsp;apparently&nbsp;we&nbsp;can&nbsp;still<br/>
&nbsp;&nbsp;&nbsp;&nbsp;process&nbsp;PrepareQC&nbsp;messages&nbsp;in&nbsp;the&nbsp;timeout&nbsp;period&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:139"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:138"><span class="id" title="variable">s</span></a>)).<br/>

<br/>
</div>

<div class="doc">
Last block in the view for to-be validator - increment view: 
</div>
<div class="code">
<span class="comment">(*&nbsp;No&nbsp;child&nbsp;blocks&nbsp;can&nbsp;exist,&nbsp;so&nbsp;we&nbsp;don't&nbsp;need&nbsp;to&nbsp;send&nbsp;anything&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="process_PrepareQC_last_block" class="idref" href="#process_PrepareQC_last_block"><span class="id" title="definition">process_PrepareQC_last_block</span></a> (<a id="s:142" class="idref" href="#s:142"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:143" class="idref" href="#msg:143"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':144" class="idref" href="#s':144"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:145" class="idref" href="#lm:145"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':144"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:143"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:145"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:143"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:143"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:143"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Here&nbsp;we&nbsp;don't&nbsp;need&nbsp;for&nbsp;timeout&nbsp;to&nbsp;be&nbsp;false&nbsp;because&nbsp;apparently<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;can&nbsp;still&nbsp;process&nbsp;PrepareQC&nbsp;messages&nbsp;in&nbsp;the&nbsp;timeout&nbsp;period&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:143"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:142"><span class="id" title="variable">s</span></a>)).<br/>

<br/>
</div>

<div class="doc">
Not-the-last block in the view - send PrepareVote messages for child block and wait: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareQC_non_last_block" class="idref" href="#process_PrepareQC_non_last_block"><span class="id" title="definition">process_PrepareQC_non_last_block</span></a> (<a id="s:146" class="idref" href="#s:146"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:147" class="idref" href="#msg:147"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':148" class="idref" href="#s':148"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:149" class="idref" href="#lm:149"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':148"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a>)) <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:149"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#timeout"><span class="id" title="projection">timeout</span></a> <a class="idref" href="Giskard.local.html#s:146"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:147"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab22"></a><h3 class="section">ViewChange message-related actions</h3>

<div class="paragraph"> </div>

 ViewChange messages can be processed after timeout, so we do not require that timeout has not occurred. 
<div class="paragraph"> </div>

 Process ViewChange at quorum for to-be block proposer:
<ul class="doclist">
<li> send highest PrepareQC message,

</li>
<li> send ViewChangeQC message,

</li>
<li> increment view, and

</li>
<li> propose new block according to highest block in all quorum ViewChange messages. 
</li>
</ul>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="higher_message" class="idref" href="#higher_message"><span class="id" title="definition">higher_message</span></a> (<a id="msg1:150" class="idref" href="#msg1:150"><span class="id" title="binder">msg1</span></a> <a id="msg2:151" class="idref" href="#msg2:151"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg1:150"><span class="id" title="variable">msg1</span></a>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg1:150"><span class="id" title="variable">msg1</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg2:151"><span class="id" title="variable">msg2</span></a>)))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="Giskard.local.html#msg1:150"><span class="id" title="variable">msg1</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="Giskard.local.html#msg2:151"><span class="id" title="variable">msg2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="highest_message_in_list" class="idref" href="#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> (<a id="n:152" class="idref" href="#n:152"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="t:153" class="idref" href="#t:153"><span class="id" title="binder">t</span></a> : <a class="idref" href="Giskard.structures.html#message_type"><span class="id" title="inductive">message_type</span></a>) (<a id="lm:154" class="idref" href="#lm:154"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> := <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#fold_right"><span class="id" title="definition">fold_right</span></a> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.local.html#t:153"><span class="id" title="variable">t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#n:152"><span class="id" title="variable">n</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:154"><span class="id" title="variable">lm</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="about_highest_message_in_list" class="idref" href="#about_highest_message_in_list"><span class="id" title="lemma">about_highest_message_in_list</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:155" class="idref" href="#n:155"><span class="id" title="binder">n</span></a> <a id="t:156" class="idref" href="#t:156"><span class="id" title="binder">t</span></a> <a id="lm:157" class="idref" href="#lm:157"><span class="id" title="binder">lm</span></a> <a id="msg:158" class="idref" href="#msg:158"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:158"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.local.html#lm:157"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:158"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <a class="idref" href="Giskard.local.html#n:155"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.local.html#t:156"><span class="id" title="variable">t</span></a> <a class="idref" href="Giskard.local.html#lm:157"><span class="id" title="variable">lm</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">lm</span>; <span class="id" title="tactic">intros</span>; [<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>|].<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)))); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hlt</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_lt"><span class="id" title="lemma">Nat.ltb_lt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#block_eq_dec"><span class="id" title="definition">block_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>)); [|<span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)))); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)))); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHlm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>))); [<span class="id" title="var">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHlm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)))); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHlm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">case_eq</span> ((<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">lm</span>)))); [<span class="id" title="var">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHlm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="highest_ViewChange_message" class="idref" href="#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a id="s:159" class="idref" href="#s:159"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:159"><span class="id" title="variable">s</span></a>) <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <a class="idref" href="Giskard.local.html#s:159"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:159"><span class="id" title="variable">s</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="highest_ViewChange_message_type_eq_ViewChange" class="idref" href="#highest_ViewChange_message_type_eq_ViewChange"><span class="id" title="lemma">highest_ViewChange_message_type_eq_ViewChange</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:160" class="idref" href="#s:160"><span class="id" title="binder">s</span></a>, <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> <a class="idref" href="Giskard.local.html#s:160"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intro</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a>.<br/>
<span class="id" title="tactic">assert</span> (<span class="id" title="keyword">forall</span> <a id="msg:162" class="idref" href="#msg:162"><span class="id" title="binder">msg</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:161"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:161"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#processed_ViewChange_in_view_correct"><span class="id" title="lemma">processed_ViewChange_in_view_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="var">revert</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)).<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <span class="id" title="var">s</span>).<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; [<span class="id" title="tactic">reflexivity</span>|].<br/>
<span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">intro</span> <span class="id" title="var">Ht</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a>.<br/>
<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <span class="id" title="var">l</span>)))).<br/>
- <span class="id" title="tactic">apply</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
- <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">right</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="get_view_highest_ViewChange_message_node_view" class="idref" href="#get_view_highest_ViewChange_message_node_view"><span class="id" title="lemma">get_view_highest_ViewChange_message_node_view</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:163" class="idref" href="#s:163"><span class="id" title="binder">s</span></a> <a id="msg:164" class="idref" href="#msg:164"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:164"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:164"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:163"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:164"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:163"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> <a class="idref" href="Giskard.local.html#s:163"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:163"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a>.<br/>
<span class="id" title="tactic">assert</span> (<span class="id" title="keyword">forall</span> <a id="msg:166" class="idref" href="#msg:166"><span class="id" title="binder">msg</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:165"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:165"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#processed_ViewChange_in_view_correct"><span class="id" title="lemma">processed_ViewChange_in_view_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In_split"><span class="id" title="abbreviation">In_split</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#eq_sym"><span class="id" title="lemma">eq_sym</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_refl"><span class="id" title="lemma">Nat.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a>); <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span> <span class="id" title="var">H0</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="var">revert</span> <span class="id" title="var">H2</span> <span class="id" title="var">H3</span>.<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)).<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <span class="id" title="var">s</span>).<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; [<span class="id" title="tactic">congruence</span>|].<br/>
<span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">H3</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a>.<br/>
<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <span class="id" title="var">l</span>)))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>).<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_lt"><span class="id" title="lemma">Nat.ltb_lt</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradict</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_nlt"><span class="id" title="lemma">Nat.ltb_nlt</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#GenesisBlock_height"><span class="id" title="axiom">GenesisBlock_height</span></a>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#block_eq_dec"><span class="id" title="definition">block_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>)); [|<span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">congruence</span>.<br/>
- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="get_view_highest_ViewChange_message_in_counting_messages" class="idref" href="#get_view_highest_ViewChange_message_in_counting_messages"><span class="id" title="lemma">get_view_highest_ViewChange_message_in_counting_messages</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="s:167" class="idref" href="#s:167"><span class="id" title="binder">s</span></a> <a id="msg:168" class="idref" href="#msg:168"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:168"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:168"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:167"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:168"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:167"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> <a class="idref" href="Giskard.local.html#s:167"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:167"><span class="id" title="variable">s</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a>.<br/>
<span class="id" title="tactic">assert</span> (<span class="id" title="keyword">forall</span> <a id="msg:170" class="idref" href="#msg:170"><span class="id" title="binder">msg</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:169"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:169"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#processed_ViewChange_in_view_correct"><span class="id" title="lemma">processed_ViewChange_in_view_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In_split"><span class="id" title="abbreviation">In_split</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#eq_sym"><span class="id" title="lemma">eq_sym</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_refl"><span class="id" title="lemma">Nat.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a>); <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span>.<br/>
<span class="id" title="var">revert</span> <span class="id" title="var">H2</span> <span class="id" title="var">H3</span>.<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> <span class="id" title="var">s</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>)).<br/>
<span class="id" title="tactic">generalize</span> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <span class="id" title="var">s</span>).<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; [<span class="id" title="tactic">congruence</span>|].<br/>
<span class="id" title="tactic">simpl</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">clear</span> <span class="id" title="var">H3</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#higher_message"><span class="id" title="definition">higher_message</span></a>.<br/>
<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <span class="id" title="var">n</span> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <span class="id" title="var">l</span>)))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#higher_block"><span class="id" title="definition">higher_block</span></a>.<br/>
<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>).<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_lt"><span class="id" title="lemma">Nat.ltb_lt</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradict</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_nlt"><span class="id" title="lemma">Nat.ltb_nlt</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#GenesisBlock_height"><span class="id" title="axiom">GenesisBlock_height</span></a>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#block_eq_dec"><span class="id" title="definition">block_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">a</span>)); [|<span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">congruence</span>.<br/>
- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="process_ViewChange_quorum_new_proposer" class="idref" href="#process_ViewChange_quorum_new_proposer"><span class="id" title="definition">process_ViewChange_quorum_new_proposer</span></a><br/>
&nbsp;(<a id="s:171" class="idref" href="#s:171"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:172" class="idref" href="#msg:172"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':173" class="idref" href="#s':173"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:174" class="idref" href="#lm:174"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':173"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="comment">(*&nbsp;Record&nbsp;new&nbsp;blocks&nbsp;after&nbsp;incrementing&nbsp;view&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> (<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;input&nbsp;has&nbsp;to&nbsp;include&nbsp;the&nbsp;current&nbsp;ViewChange&nbsp;message,&nbsp;just&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;that&nbsp;is&nbsp;the&nbsp;one&nbsp;which&nbsp;contains&nbsp;the&nbsp;highest&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="comment">(*&nbsp;PrepareQC&nbsp;of&nbsp;highest&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;ViewChangeQC&nbsp;containing&nbsp;highest&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_ViewChangeQC"><span class="id" title="definition">make_ViewChangeQC</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;block&nbsp;proposals&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> (<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:174"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="comment">(*&nbsp;Send&nbsp;ViewChangeQC&nbsp;message&nbsp;before&nbsp;incrementing&nbsp;view&nbsp;to&nbsp;ensure&nbsp;the&nbsp;others&nbsp;can&nbsp;process&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_ViewChangeQC"><span class="id" title="definition">make_ViewChangeQC</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Send&nbsp;PrepareBlock&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.local.html#make_PrepareBlocks"><span class="id" title="definition">make_PrepareBlocks</span></a> (<a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;condition&nbsp;is&nbsp;necessary&nbsp;given&nbsp;ViewChange&nbsp;sending&nbsp;behavior&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>))) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;ViewChange&nbsp;messages&nbsp;can&nbsp;be&nbsp;processed&nbsp;during&nbsp;timeout&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;It&nbsp;is&nbsp;important&nbsp;that&nbsp;the&nbsp;parameter&nbsp;here&nbsp;is&nbsp;(process&nbsp;s&nbsp;msg)&nbsp;and&nbsp;not&nbsp;simply&nbsp;s&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_change_quorum_in_view"><span class="id" title="definition">view_change_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:172"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:171"><span class="id" title="variable">s</span></a>)).<br/>

<br/>
</div>

<div class="doc">
Process ViewChange before quorum - keep and wait for QC: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_ViewChange_pre_quorum" class="idref" href="#process_ViewChange_pre_quorum"><span class="id" title="definition">process_ViewChange_pre_quorum</span></a> (<a id="s:175" class="idref" href="#s:175"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:176" class="idref" href="#msg:176"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':177" class="idref" href="#s':177"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:178" class="idref" href="#lm:178"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':177"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:178"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#view_change_quorum_in_view"><span class="id" title="definition">view_change_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:176"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:175"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab23"></a><h3 class="section">ViewChangeQC message-related actions</h3>

<div class="paragraph"> </div>

 Process highest PrepareQC message, process ViewChangeQC, then increment view. 
<div class="paragraph"> </div>

 Critically, this is where we enforce that the PrepareQC of the max height block
is processed before view change occurs, otherwise nodes can get stuck during view change. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_ViewChangeQC_single" class="idref" href="#process_ViewChangeQC_single"><span class="id" title="definition">process_ViewChangeQC_single</span></a> (<a id="s:179" class="idref" href="#s:179"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:180" class="idref" href="#msg:180"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':181" class="idref" href="#s':181"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:182" class="idref" href="#lm:182"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':181"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#increment_view"><span class="id" title="definition">increment_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)) <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:182"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:180"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab24"></a><h3 class="section">Timeout</h3>

<div class="paragraph"> </div>

 When timeout is triggered, send ViewChange with the highest prepare stage block.
Given the new definition of prepare stage, this block might not be from the current view at all. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="flip_timeout" class="idref" href="#flip_timeout"><span class="id" title="definition">flip_timeout</span></a> (<a id="s:183" class="idref" href="#s:183"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#mkNState"><span class="id" title="constructor">mkNState</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:183"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:183"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#in_messages"><span class="id" title="projection">in_messages</span></a> <a class="idref" href="Giskard.local.html#s:183"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:183"><span class="id" title="variable">s</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s:183"><span class="id" title="variable">s</span></a>)  <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab25"></a><h3 class="section">Malicious node actions</h3>

<div class="paragraph"> </div>

 Malicious nodes can ignore messages: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="malicious_ignore" class="idref" href="#malicious_ignore"><span class="id" title="definition">malicious_ignore</span></a> (<a id="s:184" class="idref" href="#s:184"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:185" class="idref" href="#msg:185"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':186" class="idref" href="#s':186"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:187" class="idref" href="#lm:187"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':186"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#discard"><span class="id" title="definition">discard</span></a> <a class="idref" href="Giskard.local.html#s:184"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:185"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:187"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:184"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:185"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:184"><span class="id" title="variable">s</span></a>).<br/>

<br/>
</div>

<div class="doc">
Malicious nodes can double vote for two blocks of the same height: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="process_PrepareBlock_malicious_vote" class="idref" href="#process_PrepareBlock_malicious_vote"><span class="id" title="definition">process_PrepareBlock_malicious_vote</span></a> (<a id="s:188" class="idref" href="#s:188"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:189" class="idref" href="#msg:189"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="s':190" class="idref" href="#s':190"><span class="id" title="binder">s'</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="lm:191" class="idref" href="#lm:191"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#s':190"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#lm:191"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#received"><span class="id" title="definition">received</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#exists_same_height_block"><span class="id" title="definition">exists_same_height_block</span></a> <a class="idref" href="Giskard.local.html#s:188"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:189"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab26"></a><h2 class="section">Protocol transition type definitions</h2>

<div class="paragraph"> </div>

 Valid Giskard transitions can be defined as a finite set/type of relations on pre-state,
post-state, processed message and outgoing message(s), constrained by protocol rules. 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <a id="NState_transition_type" class="idref" href="#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a> :=<br/>
| <a id="propose_block_init_type" class="idref" href="#propose_block_init_type"><span class="id" title="constructor">propose_block_init_type</span></a><br/>
| <a id="discard_view_invalid_type" class="idref" href="#discard_view_invalid_type"><span class="id" title="constructor">discard_view_invalid_type</span></a> <br/>
| <a id="process_PrepareBlock_duplicate_type" class="idref" href="#process_PrepareBlock_duplicate_type"><span class="id" title="constructor">process_PrepareBlock_duplicate_type</span></a><br/>
| <a id="process_PrepareBlock_pending_vote_type" class="idref" href="#process_PrepareBlock_pending_vote_type"><span class="id" title="constructor">process_PrepareBlock_pending_vote_type</span></a> <br/>
| <a id="process_PrepareBlock_vote_type" class="idref" href="#process_PrepareBlock_vote_type"><span class="id" title="constructor">process_PrepareBlock_vote_type</span></a><br/>
| <a id="process_PrepareVote_vote_type" class="idref" href="#process_PrepareVote_vote_type"><span class="id" title="constructor">process_PrepareVote_vote_type</span></a><br/>
| <a id="process_PrepareVote_wait_type" class="idref" href="#process_PrepareVote_wait_type"><span class="id" title="constructor">process_PrepareVote_wait_type</span></a><br/>
| <a id="process_PrepareQC_last_block_new_proposer_type" class="idref" href="#process_PrepareQC_last_block_new_proposer_type"><span class="id" title="constructor">process_PrepareQC_last_block_new_proposer_type</span></a><br/>
| <a id="process_PrepareQC_last_block_type" class="idref" href="#process_PrepareQC_last_block_type"><span class="id" title="constructor">process_PrepareQC_last_block_type</span></a><br/>
| <a id="process_PrepareQC_non_last_block_type" class="idref" href="#process_PrepareQC_non_last_block_type"><span class="id" title="constructor">process_PrepareQC_non_last_block_type</span></a><br/>
| <a id="process_ViewChange_quorum_new_proposer_type" class="idref" href="#process_ViewChange_quorum_new_proposer_type"><span class="id" title="constructor">process_ViewChange_quorum_new_proposer_type</span></a><br/>
| <a id="process_ViewChange_pre_quorum_type" class="idref" href="#process_ViewChange_pre_quorum_type"><span class="id" title="constructor">process_ViewChange_pre_quorum_type</span></a><br/>
| <a id="process_ViewChangeQC_single_type" class="idref" href="#process_ViewChangeQC_single_type"><span class="id" title="constructor">process_ViewChangeQC_single_type</span></a><br/>
| <a id="process_PrepareBlock_malicious_vote_type" class="idref" href="#process_PrepareBlock_malicious_vote_type"><span class="id" title="constructor">process_PrepareBlock_malicious_vote_type</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="get_transition" class="idref" href="#get_transition"><span class="id" title="definition">get_transition</span></a> (<a id="t:194" class="idref" href="#t:194"><span class="id" title="binder">t</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>) : (<a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Giskard.local.html#t:194"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#propose_block_init_type"><span class="id" title="constructor">propose_block_init_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#propose_block_init"><span class="id" title="definition">propose_block_init</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#discard_view_invalid_type"><span class="id" title="constructor">discard_view_invalid_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#discard_view_invalid"><span class="id" title="definition">discard_view_invalid</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareBlock_duplicate_type"><span class="id" title="constructor">process_PrepareBlock_duplicate_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareBlock_duplicate"><span class="id" title="definition">process_PrepareBlock_duplicate</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareBlock_pending_vote_type"><span class="id" title="constructor">process_PrepareBlock_pending_vote_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareBlock_pending_vote"><span class="id" title="definition">process_PrepareBlock_pending_vote</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareBlock_vote_type"><span class="id" title="constructor">process_PrepareBlock_vote_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareBlock_pending_vote"><span class="id" title="definition">process_PrepareBlock_pending_vote</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareQC_last_block_new_proposer_type"><span class="id" title="constructor">process_PrepareQC_last_block_new_proposer_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareQC_last_block_new_proposer"><span class="id" title="definition">process_PrepareQC_last_block_new_proposer</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareQC_last_block_type"><span class="id" title="constructor">process_PrepareQC_last_block_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareQC_last_block"><span class="id" title="definition">process_PrepareQC_last_block</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareQC_non_last_block_type"><span class="id" title="constructor">process_PrepareQC_non_last_block_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareQC_non_last_block"><span class="id" title="definition">process_PrepareQC_non_last_block</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareVote_vote_type"><span class="id" title="constructor">process_PrepareVote_vote_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareVote_vote"><span class="id" title="definition">process_PrepareVote_vote</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_PrepareVote_wait_type"><span class="id" title="constructor">process_PrepareVote_wait_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareVote_wait"><span class="id" title="definition">process_PrepareVote_wait</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_ViewChange_quorum_new_proposer_type"><span class="id" title="constructor">process_ViewChange_quorum_new_proposer_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_ViewChange_quorum_new_proposer"><span class="id" title="definition">process_ViewChange_quorum_new_proposer</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_ViewChange_pre_quorum_type"><span class="id" title="constructor">process_ViewChange_pre_quorum_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_ViewChange_pre_quorum"><span class="id" title="definition">process_ViewChange_pre_quorum</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Giskard.local.html#process_ViewChangeQC_single_type"><span class="id" title="constructor">process_ViewChangeQC_single_type</span></a> =&gt; <a class="idref" href="Giskard.local.html#process_ViewChangeQC_single"><span class="id" title="definition">process_ViewChangeQC_single</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">process_PrepareBlock_malicious_PrepareVote_type</span> =&gt; <a class="idref" href="Giskard.local.html#process_PrepareBlock_malicious_vote"><span class="id" title="definition">process_PrepareBlock_malicious_vote</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab27"></a><h2 class="section">Facts about local state transitions</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="out_messages_local_monotonic" class="idref" href="#out_messages_local_monotonic"><span class="id" title="lemma">out_messages_local_monotonic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s1:196" class="idref" href="#s1:196"><span class="id" title="binder">s1</span></a> <a id="s2:197" class="idref" href="#s2:197"><span class="id" title="binder">s2</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:198" class="idref" href="#msg:198"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="lm:199" class="idref" href="#lm:199"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="t:200" class="idref" href="#t:200"><span class="id" title="binder">t</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#get_transition"><span class="id" title="definition">get_transition</span></a> <a class="idref" href="Giskard.local.html#t:200"><span class="id" title="variable">t</span></a>) <a class="idref" href="Giskard.local.html#s1:196"><span class="id" title="variable">s1</span></a> <a class="idref" href="Giskard.local.html#msg:198"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.local.html#s2:197"><span class="id" title="variable">s2</span></a> <a class="idref" href="Giskard.local.html#lm:199"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg0:201" class="idref" href="#msg0:201"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:201"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s1:196"><span class="id" title="variable">s1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:201"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s2:197"><span class="id" title="variable">s2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">msg</span> <span class="id" title="var">lm</span> <span class="id" title="var">t</span> <span class="id" title="var">H_step</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_subst</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">right</span>; <span class="id" title="tactic">assumption</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<span class="id" title="var">pending_messages_about_block</span> <span class="id" title="var">s1</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <span class="id" title="var">s1</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step_copy</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>]]]]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">right</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="counting_messages_same_view_monotonic" class="idref" href="#counting_messages_same_view_monotonic"><span class="id" title="lemma">counting_messages_same_view_monotonic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s1:202" class="idref" href="#s1:202"><span class="id" title="binder">s1</span></a> <a id="s2:203" class="idref" href="#s2:203"><span class="id" title="binder">s2</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:204" class="idref" href="#msg:204"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="lm:205" class="idref" href="#lm:205"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="t:206" class="idref" href="#t:206"><span class="id" title="binder">t</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#get_transition"><span class="id" title="definition">get_transition</span></a> <a class="idref" href="Giskard.local.html#t:206"><span class="id" title="variable">t</span></a>) <a class="idref" href="Giskard.local.html#s1:202"><span class="id" title="variable">s1</span></a> <a class="idref" href="Giskard.local.html#msg:204"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.local.html#s2:203"><span class="id" title="variable">s2</span></a> <a class="idref" href="Giskard.local.html#lm:205"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s1:202"><span class="id" title="variable">s1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s2:203"><span class="id" title="variable">s2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg0:207" class="idref" href="#msg0:207"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:207"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s1:202"><span class="id" title="variable">s1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:207"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s2:203"><span class="id" title="variable">s2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">msg</span> <span class="id" title="var">lm</span> <span class="id" title="var">t</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_view</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_subst</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_subst</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">assumption</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">right</span>; <span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<span class="id" title="var">pending_messages_about_block</span> <span class="id" title="var">s1</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <span class="id" title="var">s1</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="counting_messages_local_monotonic" class="idref" href="#counting_messages_local_monotonic"><span class="id" title="lemma">counting_messages_local_monotonic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s1:208" class="idref" href="#s1:208"><span class="id" title="binder">s1</span></a> <a id="s2:209" class="idref" href="#s2:209"><span class="id" title="binder">s2</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:210" class="idref" href="#msg:210"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="lm:211" class="idref" href="#lm:211"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="t:212" class="idref" href="#t:212"><span class="id" title="binder">t</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#get_transition"><span class="id" title="definition">get_transition</span></a> <a class="idref" href="Giskard.local.html#t:212"><span class="id" title="variable">t</span></a>) <a class="idref" href="Giskard.local.html#s1:208"><span class="id" title="variable">s1</span></a> <a class="idref" href="Giskard.local.html#msg:210"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.local.html#s2:209"><span class="id" title="variable">s2</span></a> <a class="idref" href="Giskard.local.html#lm:211"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg0:213" class="idref" href="#msg0:213"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:213"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s1:208"><span class="id" title="variable">s1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:213"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s2:209"><span class="id" title="variable">s2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">msg</span> <span class="id" title="var">lm</span> <span class="id" title="var">t</span> <span class="id" title="var">H_step</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_subst</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">right</span>; <span class="id" title="tactic">assumption</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<span class="id" title="var">pending_messages_about_block</span> <span class="id" title="var">s1</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg0</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <span class="id" title="var">s1</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step_copy</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>]]]]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">right</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="about_local_out_messages" class="idref" href="#about_local_out_messages"><span class="id" title="lemma">about_local_out_messages</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s1:214" class="idref" href="#s1:214"><span class="id" title="binder">s1</span></a> <a id="s2:215" class="idref" href="#s2:215"><span class="id" title="binder">s2</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="msg:216" class="idref" href="#msg:216"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="lm:217" class="idref" href="#lm:217"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="p:218" class="idref" href="#p:218"><span class="id" title="binder">p</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#get_transition"><span class="id" title="definition">get_transition</span></a> <a class="idref" href="Giskard.local.html#p:218"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.local.html#s1:214"><span class="id" title="variable">s1</span></a> <a class="idref" href="Giskard.local.html#msg:216"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.local.html#s2:215"><span class="id" title="variable">s2</span></a> <a class="idref" href="Giskard.local.html#lm:217"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg0:219" class="idref" href="#msg0:219"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:219"><span class="id" title="variable">msg0</span></a> <a class="idref" href="Giskard.local.html#lm:217"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg0:219"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.local.html#s2:215"><span class="id" title="variable">s2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">msg</span> <span class="id" title="var">lm</span> <span class="id" title="var">p</span> <span class="id" title="var">H_step</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">_</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;cases&nbsp;where&nbsp;lm&nbsp;=&nbsp;<span class="inlinecode"></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_nil"><span class="id" title="lemma">in_nil</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | [<span class="id" title="var">H_in</span> | [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="not_prepare_stage" class="idref" href="#not_prepare_stage"><span class="id" title="lemma">not_prepare_stage</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s:220" class="idref" href="#s:220"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:221" class="idref" href="#b:221"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <a class="idref" href="Giskard.local.html#s:220"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:221"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> <a class="idref" href="Giskard.local.html#s:220"><span class="id" title="variable">s</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:220"><span class="id" title="variable">s</span></a>) <a class="idref" href="Giskard.local.html#b:221"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg:222" class="idref" href="#msg:222"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.local.html#msg:222"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.local.html#s:220"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.local.html#msg:222"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.local.html#b:221"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.local.html#msg:222"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <a class="idref" href="Giskard.local.html#s:220"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.local.html#msg:222"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span> <span class="id" title="var">H_not</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_not2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H_not</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>). <span class="id" title="tactic">split</span>. <span class="id" title="var">lia</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H_not</span>. <span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> <span class="id" title="var">s</span>); <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>. <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_record_agnostic" class="idref" href="#prepare_stage_record_agnostic"><span class="id" title="lemma">prepare_stage_record_agnostic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s:223" class="idref" href="#s:223"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:224" class="idref" href="#b:224"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="msg:225" class="idref" href="#msg:225"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="Giskard.local.html#record"><span class="id" title="definition">record</span></a> <a class="idref" href="Giskard.local.html#s:223"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:225"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#b:224"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <a class="idref" href="Giskard.local.html#s:223"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:224"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span> <span class="id" title="var">msg</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_record_plural_agnostic" class="idref" href="#prepare_stage_record_plural_agnostic"><span class="id" title="lemma">prepare_stage_record_plural_agnostic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s:226" class="idref" href="#s:226"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:227" class="idref" href="#b:227"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="lm:228" class="idref" href="#lm:228"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> <a class="idref" href="Giskard.local.html#s:226"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#lm:228"><span class="id" title="variable">lm</span></a>) <a class="idref" href="Giskard.local.html#b:227"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <a class="idref" href="Giskard.local.html#s:226"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#b:227"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_process_record_plural_agnostic" class="idref" href="#prepare_stage_process_record_plural_agnostic"><span class="id" title="lemma">prepare_stage_process_record_plural_agnostic</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="s:229" class="idref" href="#s:229"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) (<a id="b:230" class="idref" href="#b:230"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="lm:231" class="idref" href="#lm:231"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="msg:232" class="idref" href="#msg:232"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="Giskard.local.html#record_plural"><span class="id" title="definition">record_plural</span></a> <a class="idref" href="Giskard.local.html#s:229"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#lm:231"><span class="id" title="variable">lm</span></a>) <a class="idref" href="Giskard.local.html#msg:232"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#b:230"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> <a class="idref" href="Giskard.local.html#s:229"><span class="id" title="variable">s</span></a> <a class="idref" href="Giskard.local.html#msg:232"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.local.html#b:230"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">b</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr">coqdoc</a> and improved with <a href="https://github.com/palmskog/coqdocjs">CoqdocJS</a> as adapted for <a href="https://github.com/coq-community">coq-community</a>
</div>
</div>
</body>

</html>
