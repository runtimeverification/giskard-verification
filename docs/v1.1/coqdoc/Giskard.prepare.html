<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="./../../..">Project Website</a>
      <a href="./indexpage.html">Index</a>
      <a href="./toc.html">Table of Contents</a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Giskard</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Giskard.lib.html#"><span class="id" title="library">lib</span></a> <a class="idref" href="Giskard.structures.html#"><span class="id" title="library">structures</span></a> <a class="idref" href="Giskard.local.html#"><span class="id" title="library">local</span></a> <a class="idref" href="Giskard.global.html#"><span class="id" title="library">global</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab33"></a><h1 class="section">Safety property one: Prepare stage height injectivity</h1>

<div class="paragraph"> </div>

<a id="lab34"></a><h2 class="section">Prepare stage height injectivity definition</h2>

<div class="paragraph"> </div>

 Recall that a block is in prepare stage in some local state iff it has
received quorum PrepareVote messages or a PrepareQC message in the current
view or some previous view. 
<div class="paragraph"> </div>

 The first safety property states that no two same height blocks can be
at prepare stage in the same view, i.e., prepare stage block height is injective
in the same view. The first safety property differs from the following two in that
it contains an additional premise restricting the view during which the two blocks
reached prepare stage. This is important because it is possible for multiple blocks
at the same height to reach prepare stage across different views in the case of
abnormal view changes. 
<div class="paragraph"> </div>

 In any global state i in a valid protocol trace tr that begins with the initial
state and respects the protocol transition rules, if there are two participating
nodes n and m, and two blocks b1 b2, such that b1 and b2 have the same height,
and both reach prepare stage for n and m's local state respectively in some view p,
but are not equal, then we can prove a contradiction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_same_view_height_injective_statement" class="idref" href="#prepare_stage_same_view_height_injective_statement"><span class="id" title="definition">prepare_stage_same_view_height_injective_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:1" class="idref" href="#tr:1"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:1"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:2" class="idref" href="#i:2"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:3" class="idref" href="#n:3"><span class="id" title="binder">n</span></a> <a id="m:4" class="idref" href="#m:4"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b1:5" class="idref" href="#b1:5"><span class="id" title="binder">b1</span></a> <a id="b2:6" class="idref" href="#b2:6"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="p:7" class="idref" href="#p:7"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:3"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#m:4"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#b1:5"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.prepare.html#b2:6"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:1"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:2"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:3"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.prepare.html#p:7"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.prepare.html#b1:5"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:1"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:2"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#m:4"><span class="id" title="variable">m</span></a>) <a class="idref" href="Giskard.prepare.html#p:7"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.prepare.html#b2:6"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a>      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.prepare.html#b1:5"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.prepare.html#b2:6"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab35"></a><h2 class="section">Reducing the proof</h2>

<div class="paragraph"> </div>

 Intuitively, the proof of this property follows directly from the definition of
non-Byzantine/honest voting behavior: honest nodes cannot vote for two conflicting
blocks during the same view. If two conflicting blocks reach prepare stage in the
same view, then two quorums of at least 2/3 validators voted for each block.
By the pigeonhole principle, there must exist a set of at least 1/3 validators who
voted for both conflicting blocks and are therefore Byzantine/dishonest. By assumption,
there are no more than 1/3 Byzantine/dishonest blocks. Therefore, we reach a contradiction. 
<div class="paragraph"> </div>

 The formal proof proceeds by identifying a series of conditions that can both prove
that there exist more than 1/3 dishonest nodes (bottom-up) and be proven from the
node-local premises (top-down), and leverages the global broadcast message buffer,
which can be viewed as a ghost variable. Starting with the bottom-up direciton, we
first identify the most obvious sufficient condition for a node to be dishonest:
a node n is dishonest if there exist two equivocating messages in its own local
out-message buffer. 
<div class="paragraph"> </div>

 Local evidence of malice. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="equivocating_in_state" class="idref" href="#equivocating_in_state"><span class="id" title="definition">equivocating_in_state</span></a> (<a id="s:8" class="idref" href="#s:8"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg1:9" class="idref" href="#msg1:9"><span class="id" title="binder">msg1</span></a> <a id="msg2:10" class="idref" href="#msg2:10"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:9"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.prepare.html#s:8"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:10"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> <a class="idref" href="Giskard.prepare.html#s:8"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg1:9"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg2:10"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg1:9"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg2:10"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:9"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:10"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:9"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:10"><span class="id" title="variable">msg2</span></a>).<br/>

<br/>
</div>

<div class="doc">
However, it turns out that this obvious definition of local evidence of malice is
not the weakest precondition for a node being dishonest: there is a sufficient condition
yet for local evidence of malice. Giskard's transition rules forbid nodes from processing
PrepareBlock messages for conflicting blocks. This in turn prevents nodes from sending
PrepareVote messages for conflicting blocks at the get-go: nodes can only send a PrepareVote
message for a block if they have received the corresponding PrepareBlock message for that
block. Therefore, a malicious node can be detected by the presence of two conflicting
PrepareBlock messages in its processed message buffer. 
<div class="paragraph"> </div>

 If a node has sent a PrepareVote message for some block, then it must have
processed a PrepareBlock message for that block in the same view. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="sent_PrepareVote_means_received_PrepareBlock" class="idref" href="#sent_PrepareVote_means_received_PrepareBlock"><span class="id" title="lemma">sent_PrepareVote_means_received_PrepareBlock</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:11" class="idref" href="#tr:11"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:11"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:12" class="idref" href="#n:12"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:13" class="idref" href="#i:13"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:14" class="idref" href="#msg:14"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:12"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg:14"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:11"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:13"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:12"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg:14"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg':15" class="idref" href="#msg':15"><span class="id" title="binder">msg'</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg':15"><span class="id" title="variable">msg'</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:11"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:13"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:12"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg':15"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg':15"><span class="id" title="variable">msg'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg:14"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg':15"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg:14"><span class="id" title="variable">msg</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_sent</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>]; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_sent</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_old</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Establishing&nbsp;that&nbsp;n&nbsp;must&nbsp;be&nbsp;in&nbsp;lm0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg</span> <span class="id" title="var">lm0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="Giskard.global.html#out_messages_change_means_sent"><span class="id" title="lemma">out_messages_change_means_sent</span></a> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H_in0</span> <span class="id" title="var">H_deliver</span> <span class="id" title="var">H_step</span> <span class="id" title="var">_</span> <span class="id" title="var">H_part</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H_in0</span> <span class="id" title="var">H_deliver</span> <span class="id" title="var">H_step</span> <span class="id" title="var">n</span> <span class="id" title="var">H_part</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;analysis&nbsp;on&nbsp;transition&nbsp;made&nbsp;from&nbsp;i&nbsp;~~&gt;&nbsp;S&nbsp;i&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_broadcast</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_broadcast</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_inv"><span class="id" title="lemma">in_inv</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;cases&nbsp;that&nbsp;do&nbsp;not&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#make_PrepareBlocks_message_type"><span class="id" title="lemma">make_PrepareBlocks_message_type</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">discriminate</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> | <span class="id" title="var">H</span>]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>; <span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;three&nbsp;cases&nbsp;where&nbsp;voting&nbsp;actually&nbsp;occurs,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;existential&nbsp;witness&nbsp;is&nbsp;in&nbsp;H&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_about_msg'</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> <span class="id" title="var">H_about_msg'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">H_type'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view'</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">easy</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_about_msg'</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> <span class="id" title="var">H_about_msg'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">H_type'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view'</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">easy</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_about_msg'</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> <span class="id" title="var">H_about_msg'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about_msg'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about_msg'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">H_type'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_view'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view'</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">easy</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Thus, the following condition is sufficient to show local evidence of malice:
we say that a node is "pre-equivocating" if it has processed two PrepareBlock
messages for two different blocks of the same height in the same view. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="pre_equivocating_in_state" class="idref" href="#pre_equivocating_in_state"><span class="id" title="definition">pre_equivocating_in_state</span></a> (<a id="s:16" class="idref" href="#s:16"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.structures.html#NState"><span class="id" title="record">NState</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg1:17" class="idref" href="#msg1:17"><span class="id" title="binder">msg1</span></a> <a id="msg2:18" class="idref" href="#msg2:18"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:17"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.prepare.html#s:16"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:18"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> <a class="idref" href="Giskard.prepare.html#s:16"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg1:17"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg2:18"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg1:17"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg2:18"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:17"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:18"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:17"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:18"><span class="id" title="variable">msg2</span></a>).<br/>

<br/>
</div>

<div class="doc">
"Pre-equivocation" is a weaker notion than "equivocation". 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="pre_local_means_local_evidence_of_equivocation" class="idref" href="#pre_local_means_local_evidence_of_equivocation"><span class="id" title="lemma">pre_local_means_local_evidence_of_equivocation</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:19" class="idref" href="#tr:19"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:19"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:20" class="idref" href="#n:20"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:21" class="idref" href="#i:21"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:20"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#equivocating_in_state"><span class="id" title="definition">equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:19"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:21"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:20"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#pre_equivocating_in_state"><span class="id" title="definition">pre_equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:19"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:21"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:20"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> [<span class="id" title="var">msg1</span> [<span class="id" title="var">msg2</span> [<span class="id" title="var">H_sent1</span><br/>
&nbsp;&nbsp;&nbsp;[<span class="id" title="var">H_sent2</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_type1</span> [<span class="id" title="var">H_type2</span> [<span class="id" title="var">H_neq</span> <span class="id" title="var">H_height_eq</span>]]]]]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_received1</span> := @<a class="idref" href="Giskard.prepare.html#sent_PrepareVote_means_received_PrepareBlock"><span class="id" title="lemma">sent_PrepareVote_means_received_PrepareBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_received2</span> := @<a class="idref" href="Giskard.prepare.html#sent_PrepareVote_means_received_PrepareBlock"><span class="id" title="lemma">sent_PrepareVote_means_received_PrepareBlock</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_sent2</span> <span class="id" title="var">H_type2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_received1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg1'</span> [<span class="id" title="var">H_processed1'</span><br/>
&nbsp;&nbsp;&nbsp;[<span class="id" title="var">H_type1'</span> [<span class="id" title="var">H_block1'</span> <span class="id" title="var">H_view1'</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_received2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg2'</span> [<span class="id" title="var">H_processed2'</span><br/>
&nbsp;&nbsp;&nbsp;[<span class="id" title="var">H_type2'</span> [<span class="id" title="var">H_block2'</span> <span class="id" title="var">H_view2'</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg1'</span>, <span class="id" title="var">msg2'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view1'</span>, <span class="id" title="var">H_view2'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block1'</span>, <span class="id" title="var">H_block2'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block1'</span>, <span class="id" title="var">H_block2'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Therefore, if we can prove dishonesty from pre-equivocation, then we can
prove dishonesty from equivocation. In other words, we must show the following: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="pre_local_evidence_of_equivocation_statement" class="idref" href="#pre_local_evidence_of_equivocation_statement"><span class="id" title="definition">pre_local_evidence_of_equivocation_statement</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:22" class="idref" href="#tr:22"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:22"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:23" class="idref" href="#n:23"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:24" class="idref" href="#i:24"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:23"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#pre_equivocating_in_state"><span class="id" title="definition">pre_equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:22"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:24"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:23"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:23"><span class="id" title="variable">n</span></a>.<br/>

<br/>
</div>

<div class="doc">
The proof of the above proceeds by induction, which requires the following two cases: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="pre_local_evidence_of_equivocation_middle_case" class="idref" href="#pre_local_evidence_of_equivocation_middle_case"><span class="id" title="lemma">pre_local_evidence_of_equivocation_middle_case</span></a> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:25" class="idref" href="#tr:25"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:25"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:26" class="idref" href="#n:26"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:27" class="idref" href="#i:27"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg1:28" class="idref" href="#msg1:28"><span class="id" title="binder">msg1</span></a> <a id="msg2:29" class="idref" href="#msg2:29"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:25"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.prepare.html#i:27"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:25"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.prepare.html#i:27"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:29"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:25"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:27"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:28"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:25"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:27"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:26"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_sent2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H_view</span> <span class="id" title="var">H_type1</span> <span class="id" title="var">H_type2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_height_eq</span> <span class="id" title="var">H_false</span> <span class="id" title="var">H_old2</span> <span class="id" title="var">H_new1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_message_different_tells_receiver"><span class="id" title="lemma">counting_message_different_tells_receiver</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_contra</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_new1</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;cases&nbsp;that&nbsp;do&nbsp;not&nbsp;process&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;cases&nbsp;where&nbsp;n&nbsp;is&nbsp;not&nbsp;honest&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>]);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_contra</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_PrepareBlock"><span class="id" title="definition">exists_same_height_PrepareBlock</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg1</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H_contra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg2</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>).<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_contra</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#exists_same_height_PrepareBlock"><span class="id" title="definition">exists_same_height_PrepareBlock</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg1</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H_contra</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg2</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="pre_local_evidence_of_equivocation_last_case" class="idref" href="#pre_local_evidence_of_equivocation_last_case"><span class="id" title="lemma">pre_local_evidence_of_equivocation_last_case</span></a> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:30" class="idref" href="#tr:30"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:30"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:31" class="idref" href="#n:31"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:32" class="idref" href="#i:32"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg1:33" class="idref" href="#msg1:33"><span class="id" title="binder">msg1</span></a> <a id="msg2:34" class="idref" href="#msg2:34"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:30"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.prepare.html#i:32"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:30"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.prepare.html#i:32"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:34"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:30"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:32"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:33"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:30"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:32"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:31"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_sent2</span> <span class="id" title="var">H_view</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">H_type1</span> <span class="id" title="var">H_type2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_height_eq</span> <span class="id" title="var">H_false</span> <span class="id" title="var">H_new2</span> <span class="id" title="var">H_new1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_message_different_tells_receiver"><span class="id" title="lemma">counting_message_different_tells_receiver</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_contra</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_new1</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;cases&nbsp;that&nbsp;do&nbsp;not&nbsp;process&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;cases&nbsp;where&nbsp;n&nbsp;is&nbsp;not&nbsp;honest&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>, <span class="id" title="var">H_sent2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent2</span> | <span class="id" title="var">H_sent2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>, &lt;- <span class="id" title="var">H_sent2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_neq</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>, <span class="id" title="var">H_sent2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent2</span> | <span class="id" title="var">H_sent2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>, &lt;- <span class="id" title="var">H_sent2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_neq</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>. <span class="id" title="var">contradiction</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent2</span> | <span class="id" title="var">H_sent2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent2</span> | <span class="id" title="var">H_sent2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Finally, we can show that evidence of "pre-equivocation" is sufficient
to show that a node is dishonest: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="pre_local_evidence_of_equivocation" class="idref" href="#pre_local_evidence_of_equivocation"><span class="id" title="lemma">pre_local_evidence_of_equivocation</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:35" class="idref" href="#tr:35"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:35"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:36" class="idref" href="#n:36"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:37" class="idref" href="#i:37"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:36"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#pre_equivocating_in_state"><span class="id" title="definition">pre_equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:35"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:37"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:36"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:36"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> [<span class="id" title="var">msg1</span> [<span class="id" title="var">msg2</span> [<span class="id" title="var">H_sent1</span> [<span class="id" title="var">H_sent2</span><br/>
&nbsp;&nbsp;&nbsp;[<span class="id" title="var">H_view</span> [<span class="id" title="var">H_type1</span> [<span class="id" title="var">H_type2</span> [<span class="id" title="var">H_neq</span> <span class="id" title="var">H_height_eq</span>]]]]]]]] <span class="id" title="var">H_false</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg2</span> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old2</span> | <span class="id" title="var">H_new2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg1</span> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old1</span> | <span class="id" title="var">H_new1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#pre_local_evidence_of_equivocation_middle_case"><span class="id" title="lemma">pre_local_evidence_of_equivocation_middle_case</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg1</span> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old1</span> | <span class="id" title="var">H_new1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#pre_local_evidence_of_equivocation_middle_case"><span class="id" title="lemma">pre_local_evidence_of_equivocation_middle_case</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg2</span> <span class="id" title="var">msg1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H_eq</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_eq</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#pre_local_evidence_of_equivocation_last_case"><span class="id" title="lemma">pre_local_evidence_of_equivocation_last_case</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
And therefore, we can prove dishonesty from equivocation by weakning the premise: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="local_evidence_of_equivocation" class="idref" href="#local_evidence_of_equivocation"><span class="id" title="lemma">local_evidence_of_equivocation</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:38" class="idref" href="#tr:38"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:38"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:39" class="idref" href="#n:39"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:40" class="idref" href="#i:40"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:39"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#equivocating_in_state"><span class="id" title="definition">equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:38"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:40"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:39"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:39"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#pre_local_means_local_evidence_of_equivocation"><span class="id" title="lemma">pre_local_means_local_evidence_of_equivocation</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_equiv</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#pre_local_evidence_of_equivocation"><span class="id" title="lemma">pre_local_evidence_of_equivocation</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Continuing to identify conditions from the bottom up, we have established that
in order to show that more than 1/3 participating nodes are dishonest, we must show
that more than 1/3 participating nodes show local evidence of malice. In order to
show local evidence of malice, it suffices to show global evidence of malice. 
<div class="paragraph"> </div>

 Global evidence of malice. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="equivocating_in_global_state" class="idref" href="#equivocating_in_global_state"><span class="id" title="definition">equivocating_in_global_state</span></a> (<a id="s:41" class="idref" href="#s:41"><span class="id" title="binder">s</span></a> : <a class="idref" href="Giskard.global.html#GState"><span class="id" title="definition">GState</span></a>) (<a id="n:42" class="idref" href="#n:42"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) := <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg1:43" class="idref" href="#msg1:43"><span class="id" title="binder">msg1</span></a> <a id="msg2:44" class="idref" href="#msg2:44"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Giskard.prepare.html#s:41"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="Giskard.prepare.html#s:41"><span class="id" title="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.prepare.html#n:42"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.prepare.html#n:42"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg1:43"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg2:44"><span class="id" title="variable">msg2</span></a>).<br/>

<br/>
</div>

<div class="doc">
Proving that global evidence of malice is indeed a sufficient condition
for local evidence of malice: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="global_equivocating_local" class="idref" href="#global_equivocating_local"><span class="id" title="lemma">global_equivocating_local</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:45" class="idref" href="#tr:45"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:45"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:46" class="idref" href="#n:46"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:47" class="idref" href="#i:47"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:46"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#equivocating_in_global_state"><span class="id" title="definition">equivocating_in_global_state</span></a> (<a class="idref" href="Giskard.prepare.html#tr:45"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:47"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:46"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#equivocating_in_state"><span class="id" title="definition">equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:45"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:47"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:46"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_global</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_global</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg1</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">H_global</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg1</span>, <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>; <span class="id" title="tactic">tauto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We identify yet another sufficient condition for global evidence of malice:
there exist two vote quorums for b1 and b2 in the global broadcast message buffer.
We show that this is indeed a sufficient condition by completing the following
chain of reasoning:
<ul class="doclist">
<li> we have two global vote quorums, which implies

</li>
<li> more than one third global evidence of malice, which implies

</li>
<li> more than one third local evidence of malice, which implies

</li>
<li> more than one third of nodes are dishonest. 

</li>
</ul>
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="vote_quorum_same_view_global_injective" class="idref" href="#vote_quorum_same_view_global_injective"><span class="id" title="lemma">vote_quorum_same_view_global_injective</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:48" class="idref" href="#tr:48"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:48"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:49" class="idref" href="#i:49"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="b1:50" class="idref" href="#b1:50"><span class="id" title="binder">b1</span></a> <a id="b2:51" class="idref" href="#b2:51"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="p:52" class="idref" href="#p:52"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#b1:50"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.prepare.html#b2:51"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:48"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:49"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.prepare.html#b1:50"><span class="id" title="variable">b1</span></a> <a class="idref" href="Giskard.prepare.html#p:52"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:48"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:49"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.prepare.html#b2:51"><span class="id" title="variable">b2</span></a> <a class="idref" href="Giskard.prepare.html#p:52"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a>      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.prepare.html#b1:50"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.prepare.html#b2:51"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>, <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.structures.html#intersection_property"><span class="id" title="axiom">intersection_property</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>, <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> (<a class="idref" href="Giskard.global.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">p</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> (<a class="idref" href="Giskard.global.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span>)) <span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l_inter</span> [<span class="id" title="var">H_inter</span> <span class="id" title="var">H_subset</span>]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;All&nbsp;overlapping&nbsp;nodes&nbsp;are&nbsp;participants&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_part</span> : <span class="id" title="keyword">forall</span> <a id="n:54" class="idref" href="#n:54"><span class="id" title="binder">n</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:53"><span class="id" title="variable">n</span></a> <span class="id" title="var">l_inter</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:53"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_subset</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_subset</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_sender</span> <span class="id" title="var">H_global</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_global</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;All&nbsp;overlapping&nbsp;nodes&nbsp;are&nbsp;equivocating&nbsp;in&nbsp;global&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step1</span> : <span class="id" title="keyword">forall</span> <a id="n:56" class="idref" href="#n:56"><span class="id" title="binder">n</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:55"><span class="id" title="variable">n</span></a> <span class="id" title="var">l_inter</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.prepare.html#equivocating_in_global_state"><span class="id" title="definition">equivocating_in_global_state</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <a class="idref" href="Giskard.prepare.html#n:55"><span class="id" title="variable">n</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_subset</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_subset</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in1</span> <span class="id" title="var">H_in2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg1</span> [<span class="id" title="var">H_sender1</span>  <span class="id" title="var">H_sent1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg2</span> [<span class="id" title="var">H_sender2</span> <span class="id" title="var">H_sent2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> <span class="id" title="var">H_rest1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type1</span> <span class="id" title="var">H_view1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type1</span> <span class="id" title="var">H_block1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent2</span> <span class="id" title="var">H_rest2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type2</span> <span class="id" title="var">H_view2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type2</span> <span class="id" title="var">H_block2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg1</span>, <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="var">easy</span>). }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;All&nbsp;overlapping&nbsp;nodes&nbsp;are&nbsp;equivocating&nbsp;in&nbsp;their&nbsp;local&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step2</span> : <span class="id" title="keyword">forall</span> <a id="n:58" class="idref" href="#n:58"><span class="id" title="binder">n</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:57"><span class="id" title="variable">n</span></a> <span class="id" title="var">l_inter</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.prepare.html#equivocating_in_state"><span class="id" title="definition">equivocating_in_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <a class="idref" href="Giskard.prepare.html#n:57"><span class="id" title="variable">n</span></a>)).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_step1</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#global_equivocating_local"><span class="id" title="lemma">global_equivocating_local</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_subset</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_subset</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_sender</span> <span class="id" title="var">H_global</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_global</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;All&nbsp;nodes&nbsp;equivocating&nbsp;in&nbsp;their&nbsp;local&nbsp;state&nbsp;are&nbsp;malicious&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step3</span> : <span class="id" title="keyword">forall</span> <a id="n:60" class="idref" href="#n:60"><span class="id" title="binder">n</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:59"><span class="id" title="variable">n</span></a> <span class="id" title="var">l_inter</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.prepare.html#n:59"><span class="id" title="variable">n</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_part</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_step2</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#local_evidence_of_equivocation"><span class="id" title="lemma">local_evidence_of_equivocation</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#evil_participants"><span class="id" title="axiom">evil_participants</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#minority_subset"><span class="id" title="axiom">minority_subset</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">l_inter</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#negb_true_iff"><span class="id" title="lemma">negb_true_iff</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H_step3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<a class="idref" href="Giskard.structures.html#honest_nodeb"><span class="id" title="axiom">honest_nodeb</span></a> <span class="id" title="var">n</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#honest_nodeb_correct"><span class="id" title="axiom">honest_nodeb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Finally, we close the gap from the top down direction by showing that from
our node-local <code>prepare_stage_in_view</code> assumption, we can prove the existence
of vote quorum in the global broadcast message buffer. There are two cases 
of <code>prepare_stage_in_view</code>, either a vote quorum in the local processed
message buffer, or a PrepareQC message in the local processed message buffer.
We show the first case: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="vote_quorum_local_means_vote_quorum_global" class="idref" href="#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:61" class="idref" href="#tr:61"><span class="id" title="binder">tr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:61"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:62" class="idref" href="#i:62"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:63" class="idref" href="#n:63"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b1:64" class="idref" href="#b1:64"><span class="id" title="binder">b1</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="p:65" class="idref" href="#p:65"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:63"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:61"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:62"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:63"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.prepare.html#p:65"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.prepare.html#b1:64"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:61"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:62"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.prepare.html#b1:64"><span class="id" title="variable">b1</span></a> <a class="idref" href="Giskard.prepare.html#p:65"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b1</span> <span class="id" title="var">p</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">p</span> <span class="id" title="var">b1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>; <br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_typeblockview</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="vote_quorum_in_view_step_global" class="idref" href="#vote_quorum_in_view_step_global"><span class="id" title="lemma">vote_quorum_in_view_step_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:66" class="idref" href="#tr:66"><span class="id" title="binder">tr</span></a> <a id="i:67" class="idref" href="#i:67"><span class="id" title="binder">i</span></a> <a id="b:68" class="idref" href="#b:68"><span class="id" title="binder">b</span></a> <a id="p:69" class="idref" href="#p:69"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:66"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:66"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:67"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.prepare.html#b:68"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.prepare.html#p:69"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:66"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.prepare.html#i:67"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#b:68"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.prepare.html#p:69"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.global.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="witnessed_quorum_global" class="idref" href="#witnessed_quorum_global"><span class="id" title="lemma">witnessed_quorum_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:70" class="idref" href="#tr:70"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:70"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:71" class="idref" href="#i:71"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:72" class="idref" href="#msg:72"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#msg:72"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.prepare.html#tr:70"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:71"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.prepare.html#msg:72"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:70"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:71"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.prepare.html#msg:72"><span class="id" title="variable">msg</span></a>) (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.prepare.html#msg:72"><span class="id" title="variable">msg</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;-  <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#vote_quorum_in_view_global_step"><span class="id" title="lemma">vote_quorum_in_view_global_step</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_in_copy</span> := <span class="id" title="var">H_in</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;all&nbsp;cases&nbsp;that&nbsp;do&nbsp;not&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;all&nbsp;cases&nbsp;that&nbsp;send&nbsp;messages&nbsp;of&nbsp;the&nbsp;wrong&nbsp;type&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#make_PrepareBlocks_message_type"><span class="id" title="lemma">make_PrepareBlocks_message_type</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>; <span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;three&nbsp;cases&nbsp;that&nbsp;actually&nbsp;do&nbsp;send&nbsp;PrepareQC&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**  <span class="comment">(*&nbsp;In&nbsp;the&nbsp;PrepareVote&nbsp;vote&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_if</span> : <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>)) <span class="id" title="var">n0</span>) (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_extract</span> : <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_extract</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> | <span class="id" title="var">H_in'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_if</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view_eq</span> : <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view_eq</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="comment">(*&nbsp;In&nbsp;the&nbsp;ViewChange&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;to&nbsp;show&nbsp;that&nbsp;the&nbsp;block&nbsp;contained&nbsp;in&nbsp;the&nbsp;highest&nbsp;ViewChange&nbsp;message<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;has&nbsp;reached&nbsp;vote_quorum&nbsp;globally&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> := <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> := <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> := <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> := <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a> := <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#delivered_means_sent_global"><span class="id" title="lemma">delivered_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#vote_quorum_in_view_global_step"><span class="id" title="lemma">vote_quorum_in_view_global_step</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view_eq</span> : <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view_eq</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
And the second case, with some help from the two lemmas above: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="PrepareQC_local_means_vote_quorum_global" class="idref" href="#PrepareQC_local_means_vote_quorum_global"><span class="id" title="lemma">PrepareQC_local_means_vote_quorum_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:73" class="idref" href="#tr:73"><span class="id" title="binder">tr</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.prepare.html#tr:73"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:74" class="idref" href="#i:74"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:75" class="idref" href="#n:75"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b1:76" class="idref" href="#b1:76"><span class="id" title="binder">b1</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="p:77" class="idref" href="#p:77"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.prepare.html#n:75"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#PrepareQC_in_view"><span class="id" title="definition">PrepareQC_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.prepare.html#tr:73"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:74"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.prepare.html#n:75"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.prepare.html#p:77"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.prepare.html#b1:76"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.prepare.html#tr:73"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.prepare.html#i:74"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.prepare.html#b1:76"><span class="id" title="variable">b1</span></a> <a class="idref" href="Giskard.prepare.html#p:77"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b1</span> <span class="id" title="var">p</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.prepare.html#witnessed_quorum_global"><span class="id" title="lemma">witnessed_quorum_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_local</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_processed</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_block</span> <span class="id" title="var">H_type</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_block</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab36"></a><h2 class="section">Proof of prepare stage height injectivity</h2>

<div class="paragraph"> </div>

 Finally, we are ready to string everything together to prove the statement
of the first safety theorem: 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a id="prepare_stage_same_view_height_injective" class="idref" href="#prepare_stage_same_view_height_injective"><span class="id" title="lemma">prepare_stage_same_view_height_injective</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.prepare.html#prepare_stage_same_view_height_injective_statement"><span class="id" title="definition">prepare_stage_same_view_height_injective_statement</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span> <span class="id" title="var">H_part1</span> <span class="id" title="var">H_part2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>, <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_vote1</span> | <span class="id" title="var">H_QC1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_vote2</span> | <span class="id" title="var">H_QC2</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_same_view_global_injective"><span class="id" title="lemma">vote_quorum_same_view_global_injective</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#PrepareQC_local_means_vote_quorum_global"><span class="id" title="lemma">PrepareQC_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_QC2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_same_view_global_injective"><span class="id" title="lemma">vote_quorum_same_view_global_injective</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_local_means_vote_quorum_global"><span class="id" title="lemma">vote_quorum_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#PrepareQC_local_means_vote_quorum_global"><span class="id" title="lemma">PrepareQC_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_QC1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_same_view_global_injective"><span class="id" title="lemma">vote_quorum_same_view_global_injective</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#PrepareQC_local_means_vote_quorum_global"><span class="id" title="lemma">PrepareQC_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_QC1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#PrepareQC_local_means_vote_quorum_global"><span class="id" title="lemma">PrepareQC_local_means_vote_quorum_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_QC2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#vote_quorum_same_view_global_injective"><span class="id" title="lemma">vote_quorum_same_view_global_injective</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr">coqdoc</a> and improved with <a href="https://github.com/palmskog/coqdocjs">CoqdocJS</a> as adapted for <a href="https://github.com/coq-community">coq-community</a>
</div>
</div>
</body>

</html>
