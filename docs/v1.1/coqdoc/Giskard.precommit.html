<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="./../../..">Project Website</a>
      <a href="./indexpage.html">Index</a>
      <a href="./toc.html">Table of Contents</a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Logic.Classical.html#"><span class="id" title="library">Classical</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Giskard</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Giskard.lib.html#"><span class="id" title="library">lib</span></a> <a class="idref" href="Giskard.structures.html#"><span class="id" title="library">structures</span></a> <a class="idref" href="Giskard.local.html#"><span class="id" title="library">local</span></a> <a class="idref" href="Giskard.global.html#"><span class="id" title="library">global</span></a> <a class="idref" href="Giskard.prepare.html#"><span class="id" title="library">prepare</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab37"></a><h1 class="section">Safety property two: Precommit stage height injectivity</h1>

<div class="paragraph"> </div>

<a id="lab38"></a><h2 class="section">Precommit stage definition</h2>

<div class="paragraph"> </div>

 We say that a block is in precommit stage in some local state iff it is in
prepare stage, and its child block is in prepare stage, i.e., it has received
quorum PrepareVote messages or a PrepareQC message in the current view or
some previous view. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="precommit_stage" class="idref" href="#precommit_stage"><span class="id" title="definition">precommit_stage</span></a> (<a id="tr:1" class="idref" href="#tr:1"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:2" class="idref" href="#i:2"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:3" class="idref" href="#n:3"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b:4" class="idref" href="#b:4"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b_child:5" class="idref" href="#b_child:5"><span class="id" title="binder">b_child</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b_child:5"><span class="id" title="variable">b_child</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:4"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:1"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:2"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:3"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:4"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:1"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:2"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:3"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b_child:5"><span class="id" title="variable">b_child</span></a>.<br/>

<br/>
</div>

<div class="doc">
Before we formally state the second safety property, we first motivate
the definition of precommit stage and establish some facts about the relationship
between prepare stage and precommit stage. 
<div class="paragraph"> </div>

 In particular, for a block to be in precommit stage we require that it is
in prepare stage in that local state. In other words, the definition must satisfy
that local precommit stage implies local prepare stage: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="precommit_means_prepare" class="idref" href="#precommit_means_prepare"><span class="id" title="lemma">precommit_means_prepare</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:6" class="idref" href="#tr:6"><span class="id" title="binder">tr</span></a> <a id="i:7" class="idref" href="#i:7"><span class="id" title="binder">i</span></a> <a id="b:8" class="idref" href="#b:8"><span class="id" title="binder">b</span></a> <a id="n:9" class="idref" href="#n:9"><span class="id" title="binder">n</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:6"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:9"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage"><span class="id" title="definition">precommit_stage</span></a> <a class="idref" href="Giskard.precommit.html#tr:6"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:7"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:9"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b:8"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:6"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:7"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:9"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:8"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">n</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_precommit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child</span> [<span class="id" title="var">H_parent</span> [<span class="id" title="var">H_prepare_parent</span> <span class="id" title="var">H_prepare_child</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare_child</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare_child</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We motivate this requirement below. Consider the following statement: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_parent_prepare_stage" class="idref" href="#prepare_stage_parent_prepare_stage"><span class="id" title="definition">prepare_stage_parent_prepare_stage</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:10" class="idref" href="#tr:10"><span class="id" title="binder">tr</span></a> <a id="i:11" class="idref" href="#i:11"><span class="id" title="binder">i</span></a> <a id="n:12" class="idref" href="#n:12"><span class="id" title="binder">n</span></a> <a id="b:13" class="idref" href="#b:13"><span class="id" title="binder">b</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:10"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:12"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:10"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:11"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:12"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:13"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:10"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:11"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:12"><span class="id" title="variable">n</span></a>) (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b:13"><span class="id" title="variable">b</span></a>).<br/>

<br/>
</div>

<div class="doc">
While seemingly innocuous, this statement is false. This is evidenced by the following
counterexample:
<ul class="doclist">
<li> A, B, C and D are participating in the protocol, and blocks b1, b2 and b3 have been proposed.

</li>
<li> A, B and C receive PrepareBlock messages for b1, and broadcast PrepareVote messages for b1.

</li>
<li> A, B and C receive one another's PrepareVote(_, b1) messages, and respectively witness quorums
  for b1, broadcasting PrepareQC(_, b1) and PrepareVote(_, b2).

</li>
<li> A receives PrepareVote(B, b2) and PrepareVote(C, b2) first, and alongside its own PrepareVote(A, b2),
  it witnesses a quorum for b2 and broadcasts PrepareQC (A, b2).

</li>
</ul>

<div class="paragraph"> </div>

At this point, node D's input message buffer contains PrepareVote messages for b1 and b2, PrepareQC
messages for b1, and PrepareQC(A, b1). In the case that D processes PrepareQC(A, b2) first, block
b2 reaches prepare stage in D's local state, but b2's parent block, b1, has not reached prepare
stage in D's local state, nor has D himself voted for either b1 or b2. 
<div class="paragraph"> </div>

 This counterexample further illustrates that the prepare stage status of a block in a local
view is *independent of* whether the node has personally cast a vote for the block - if there
are enough nodes in the protocol to form a quorum, a laggy node (e.g. node D in the example above)
can simply sit idle and receive votes from others to enter blocks into prepare stage locally. 
<div class="paragraph"> </div>

 The converse, however, holds: if an honest node has personally cast a vote for some block,
then the parent block must be at prepare stage locally: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="sent_PrepareVote_means_parent_block_prepare_local" class="idref" href="#sent_PrepareVote_means_parent_block_prepare_local"><span class="id" title="lemma">sent_PrepareVote_means_parent_block_prepare_local</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:14" class="idref" href="#tr:14"><span class="id" title="binder">tr</span></a> <a id="i:15" class="idref" href="#i:15"><span class="id" title="binder">i</span></a> <a id="n:16" class="idref" href="#n:16"><span class="id" title="binder">n</span></a> <a id="b:17" class="idref" href="#b:17"><span class="id" title="binder">b</span></a> <a id="p:18" class="idref" href="#p:18"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:14"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:16"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#honest_node"><span class="id" title="axiom">honest_node</span></a> <a class="idref" href="Giskard.precommit.html#n:16"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Node&nbsp;n&nbsp;has&nbsp;sent&nbsp;a&nbsp;PrepareVote&nbsp;for&nbsp;block&nbsp;b&nbsp;in&nbsp;view&nbsp;p&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="Giskard.precommit.html#p:18"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#n:16"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b:17"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>) (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:14"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:15"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:16"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;parent&nbsp;of&nbsp;block&nbsp;b&nbsp;must&nbsp;be&nbsp;in&nbsp;prepare&nbsp;stage,&nbsp;i.e.&nbsp;have&nbsp;received&nbsp;enough<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;votes&nbsp;in&nbsp;the&nbsp;current&nbsp;or&nbsp;some&nbsp;past&nbsp;view.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:14"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:15"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:16"><span class="id" title="variable">n</span></a>) (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b:17"><span class="id" title="variable">b</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_honest</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view</span> := <a class="idref" href="Giskard.global.html#view_same_or_plus_one"><span class="id" title="lemma">view_same_or_plus_one</span></a> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p'</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">p'</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#prepare_in_view_persistent"><span class="id" title="lemma">prepare_in_view_persistent</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_sender</span> : <span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_sender</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;PrepareVote&nbsp;vote&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;PrepareBlock&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">pb_msg</span> [<span class="id" title="var">H_eq</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_about</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_about</span> <span class="id" title="var">H_type</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_about</span> <span class="id" title="var">H_parent</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#parent_ofb_correct"><span class="id" title="axiom">parent_ofb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_parent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#make_PrepareVote"><span class="id" title="definition">make_PrepareVote</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span> <span class="id" title="var">pb_msg</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f_equal"><span class="id" title="lemma">f_equal</span></a>. <span class="id" title="var">easy</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prepare</span> : <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;PrepareQC&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote"><span class="id" title="definition">pending_PrepareVote</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">pb_msg</span> [<span class="id" title="var">H_eq</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_about</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_about</span> <span class="id" title="var">H_type</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_about</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_about</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_about</span> <span class="id" title="var">H_parent</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#parent_ofb_correct"><span class="id" title="axiom">parent_ofb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_parent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#make_PrepareVote"><span class="id" title="definition">make_PrepareVote</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span> <span class="id" title="var">pb_msg</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.structures.html#mkMessage"><span class="id" title="constructor">mkMessage</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f_equal"><span class="id" title="lemma">f_equal</span></a>. <span class="id" title="var">easy</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>)) <span class="id" title="var">n</span>)). <span class="id" title="tactic">split</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg0</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;PrepareBlock&nbsp;malicious&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
However, the prepare stage status of blocks and the prepare stage status of
their parent blocks are not unrelated - Giskard's criterion for voting states that
nodes can only vote for blocks whose parent block has reached prepare stage.
In other words, the criterion for voting in Giskard concerns what messages have
been received, i.e., sent globally, but not what messages have been sent locally. 
<div class="paragraph"> </div>

 We can show that if a block is in prepare stage in some local state, then its
parent block is in prepare stage in the global state, meaning that a quorum of
votes must have been cast by all participating nodes, if not by itself. In the
example above, when D processes PrepareQC(A, b2), it is certainly true that the
global state has witnessed a quorum of PrepareVote messages for b1, even though
D's local state has not. We formalize this notion of global prepare stage as follows. 
<div class="paragraph"> </div>

 Similar to <span class="inlinecode"><a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a></span>, we first define a version of the global
prepare stage definition which takes a particular view as a parameter. While
local prepare stage definitions reason about local counting_message buffers,
e.g., <code>counting_messages (fst (tr i) n)</code>, global prepare stage definitions
reason about the global message buffer <code>snd (tr i)</code>: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="PrepareVote_about_block_in_view_global" class="idref" href="#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> (<a id="tr:19" class="idref" href="#tr:19"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) <a id="i:20" class="idref" href="#i:20"><span class="id" title="binder">i</span></a> <a id="b:21" class="idref" href="#b:21"><span class="id" title="binder">b</span></a> <a id="p:22" class="idref" href="#p:22"><span class="id" title="binder">p</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="msg:23" class="idref" href="#msg:23"><span class="id" title="binder">msg</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:23"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#block_eqb"><span class="id" title="axiom">block_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:23"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#b:21"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:23"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:22"><span class="id" title="variable">p</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:19"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:20"><span class="id" title="variable">i</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vote_quorum_in_view_global" class="idref" href="#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a id="tr:24" class="idref" href="#tr:24"><span class="id" title="binder">tr</span></a> <a id="i:25" class="idref" href="#i:25"><span class="id" title="binder">i</span></a> <a id="b:26" class="idref" href="#b:26"><span class="id" title="binder">b</span></a> <a id="p:27" class="idref" href="#p:27"><span class="id" title="binder">p</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> (<a class="idref" href="Giskard.precommit.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:24"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:25"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:26"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:27"><span class="id" title="variable">p</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="PrepareQC_in_view_global" class="idref" href="#PrepareQC_in_view_global"><span class="id" title="definition">PrepareQC_in_view_global</span></a> (<a id="tr:28" class="idref" href="#tr:28"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) <a id="i:29" class="idref" href="#i:29"><span class="id" title="binder">i</span></a> <a id="b:30" class="idref" href="#b:30"><span class="id" title="binder">b</span></a> <a id="p:31" class="idref" href="#p:31"><span class="id" title="binder">p</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:32" class="idref" href="#msg:32"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:32"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:28"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:29"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:32"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:31"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:32"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:30"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:32"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>.<br/>

<br/>
</div>

<div class="doc">
Similar to local prepare stage <span class="inlinecode"><a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a></span>, we define global
prepare stage in some view as the disjunction of the two cases: in that
view, either the block has received a quorum of PrepareVote messages,
or it has received a PrepareQC message: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_in_view_global" class="idref" href="#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a id="tr:33" class="idref" href="#tr:33"><span class="id" title="binder">tr</span></a> <a id="i:34" class="idref" href="#i:34"><span class="id" title="binder">i</span></a> <a id="b:35" class="idref" href="#b:35"><span class="id" title="binder">b</span></a> <a id="p:36" class="idref" href="#p:36"><span class="id" title="binder">p</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:33"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:34"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:35"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:36"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#PrepareQC_in_view_global"><span class="id" title="definition">PrepareQC_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:33"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:34"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:35"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:36"><span class="id" title="variable">p</span></a>.<br/>

<br/>
</div>

<div class="doc">
The property of being in local prepare stage is persistent: once a block
reaches prepare stage in some local state, it remains in prepare stage for
all future states of that node: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_persistent" class="idref" href="#prepare_stage_persistent"><span class="id" title="lemma">prepare_stage_persistent</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:37" class="idref" href="#tr:37"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:37"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:38" class="idref" href="#n:38"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:39" class="idref" href="#i:39"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:38"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b:40" class="idref" href="#b:40"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:37"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:39"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:38"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:40"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="j:41" class="idref" href="#j:41"><span class="id" title="binder">j</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>, <a class="idref" href="Giskard.precommit.html#i:39"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#j:41"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:37"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:41"><span class="id" title="variable">j</span></a>) <a class="idref" href="Giskard.precommit.html#n:38"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:40"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prepare</span> <span class="id" title="var">j</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past'</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v'</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.global.html#view_state_morphism"><span class="id" title="lemma">view_state_morphism</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">n</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_past</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#prepare_in_view_persistent"><span class="id" title="lemma">prepare_in_view_persistent</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">i</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can prove a similar fact for <span class="inlinecode"><a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_in_view_step_global" class="idref" href="#prepare_stage_in_view_step_global"><span class="id" title="lemma">prepare_stage_in_view_step_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:42" class="idref" href="#tr:42"><span class="id" title="binder">tr</span></a> <a id="i:43" class="idref" href="#i:43"><span class="id" title="binder">i</span></a> <a id="b:44" class="idref" href="#b:44"><span class="id" title="binder">b</span></a> <a id="p:45" class="idref" href="#p:45"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:42"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:42"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:43"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:44"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:45"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:42"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:43"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#b:44"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:45"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_vote</span> | <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.precommit.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.precommit.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H1</span> [<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_in_view_persistent_global" class="idref" href="#prepare_stage_in_view_persistent_global"><span class="id" title="lemma">prepare_stage_in_view_persistent_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:46" class="idref" href="#tr:46"><span class="id" title="binder">tr</span></a> <a id="i:47" class="idref" href="#i:47"><span class="id" title="binder">i</span></a> <a id="j:48" class="idref" href="#j:48"><span class="id" title="binder">j</span></a> <a id="b:49" class="idref" href="#b:49"><span class="id" title="binder">b</span></a> <a id="p:50" class="idref" href="#p:50"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:46"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#i:47"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.precommit.html#j:48"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:46"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:47"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:49"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:50"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:46"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:48"><span class="id" title="variable">j</span></a> <a class="idref" href="Giskard.precommit.html#b:49"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:50"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_vote</span> | <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.precommit.html#vote_quorum_in_view_global"><span class="id" title="definition">vote_quorum_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.precommit.html#PrepareVote_about_block_in_view_global"><span class="id" title="definition">PrepareVote_about_block_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic"><span class="id" title="lemma">global_messages_monotonic</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H1</span> [<span class="id" title="var">H2</span> <span class="id" title="var">H3</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic"><span class="id" title="lemma">global_messages_monotonic</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">i</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The following fact follows directly from the definition
of <span class="inlinecode"><a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a></span>: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_in_view_means_PrepareVote_PrepareQC_exists_global" class="idref" href="#prepare_in_view_means_PrepareVote_PrepareQC_exists_global"><span class="id" title="lemma">prepare_in_view_means_PrepareVote_PrepareQC_exists_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:51" class="idref" href="#tr:51"><span class="id" title="binder">tr</span></a> <a id="i:52" class="idref" href="#i:52"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:51"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b:53" class="idref" href="#b:53"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="x:54" class="idref" href="#x:54"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:51"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:52"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:53"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#x:54"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg1:55" class="idref" href="#msg1:55"><span class="id" title="binder">msg1</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:55"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:51"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:52"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:55"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#x:54"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:55"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:53"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:55"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:55"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_quorum</span> | <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#empty_has_no_two_thirds'"><span class="id" title="axiom">empty_has_no_two_thirds'</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_quorum</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n</span> <span class="id" title="var">H_in</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_sender</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_typeblockview</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">andb_true_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblockview</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblockview</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_typeblock</span> <span class="id" title="var">H_view</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblock</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> <span class="id" title="var">H_block</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can then define <span class="inlinecode"><a class="idref" href="Giskard.precommit.html#prepare_stage_global"><span class="id" title="definition">prepare_stage_global</span></a></span> using <span class="inlinecode"><a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a></span>,
similar to how we defined <span class="inlinecode"><a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a></span> using <span class="inlinecode"><a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a></span>: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_global" class="idref" href="#prepare_stage_global"><span class="id" title="definition">prepare_stage_global</span></a> <a id="tr:56" class="idref" href="#tr:56"><span class="id" title="binder">tr</span></a> <a id="i:57" class="idref" href="#i:57"><span class="id" title="binder">i</span></a> <a id="b:58" class="idref" href="#b:58"><span class="id" title="binder">b</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="p:59" class="idref" href="#p:59"><span class="id" title="binder">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:56"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:57"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:58"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:59"><span class="id" title="variable">p</span></a>.<br/>

<br/>
</div>

<div class="doc">
We can easily establish the relationship between local and global prepare
stages through the relationship between local <code>out_messages</code> buffers and the
global message buffer. One is strictly stronger: we can prove global from local,
but not vice versa: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_in_view_means_prepare_stage_in_view_global" class="idref" href="#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:60" class="idref" href="#tr:60"><span class="id" title="binder">tr</span></a> <a id="i:61" class="idref" href="#i:61"><span class="id" title="binder">i</span></a> <a id="n:62" class="idref" href="#n:62"><span class="id" title="binder">n</span></a> <a id="b:63" class="idref" href="#b:63"><span class="id" title="binder">b</span></a> <a id="p:64" class="idref" href="#p:64"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:60"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:62"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:60"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:61"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:62"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#p:64"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#b:63"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:60"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:61"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:63"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:64"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_local</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_vote</span> | <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">p</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in0</span> <span class="id" title="var">H_rest0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_means_prepare_stage_global" class="idref" href="#prepare_stage_means_prepare_stage_global"><span class="id" title="lemma">prepare_stage_means_prepare_stage_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:65" class="idref" href="#tr:65"><span class="id" title="binder">tr</span></a> <a id="i:66" class="idref" href="#i:66"><span class="id" title="binder">i</span></a> <a id="n:67" class="idref" href="#n:67"><span class="id" title="binder">n</span></a> <a id="b:68" class="idref" href="#b:68"><span class="id" title="binder">b</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:65"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:67"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:65"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:66"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:67"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#b:68"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_global"><span class="id" title="definition">prepare_stage_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:65"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:66"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:68"><span class="id" title="variable">b</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_local</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past</span> [<span class="id" title="var">H_vote</span> | <span class="id" title="var">H_qc</span>]]];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_vote</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">v'</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in0</span> <span class="id" title="var">H_rest0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab39"></a><h2 class="section">Precommit stage height injectivity statement</h2>

<div class="paragraph"> </div>

 We are now ready to state the second safety property. 
<div class="paragraph"> </div>

 The second safety property states that no two same height blocks can be at
precommit stage, i.e., precommit stage block height is injective. The second safety
property does not require that the two blocks reach precommit stage in the same view. 
<div class="paragraph"> </div>

 More formally, in any global state i in a valid protocol trace tr that begins
with the initial state and respects the protocol transition rules, if there are
two participating nodes n and m, and two blocks b1 b2, such that b1 and b2 have
the same height, and are both in precommit stage in n and m's local state respectively,
but are not equal, then we can prove a contradiction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="precommit_stage_height_injective_statement" class="idref" href="#precommit_stage_height_injective_statement"><span class="id" title="definition">precommit_stage_height_injective_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:69" class="idref" href="#tr:69"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:69"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:70" class="idref" href="#i:70"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:71" class="idref" href="#n:71"><span class="id" title="binder">n</span></a> <a id="m:72" class="idref" href="#m:72"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b1:73" class="idref" href="#b1:73"><span class="id" title="binder">b1</span></a> <a id="b2:74" class="idref" href="#b2:74"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:71"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:72"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:73"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:74"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage"><span class="id" title="definition">precommit_stage</span></a> <a class="idref" href="Giskard.precommit.html#tr:69"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:70"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:71"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:73"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage"><span class="id" title="definition">precommit_stage</span></a> <a class="idref" href="Giskard.precommit.html#tr:69"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:70"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:72"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:74"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:73"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:74"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>

<br/>
</div>

<div class="doc">
In order to gain a better understanding of the case analysis required of
this proof, we show the following fact: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="precommit_stage_means_prepare_stage_global" class="idref" href="#precommit_stage_means_prepare_stage_global"><span class="id" title="lemma">precommit_stage_means_prepare_stage_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:75" class="idref" href="#tr:75"><span class="id" title="binder">tr</span></a> <a id="i:76" class="idref" href="#i:76"><span class="id" title="binder">i</span></a> <a id="n:77" class="idref" href="#n:77"><span class="id" title="binder">n</span></a> <a id="b:78" class="idref" href="#b:78"><span class="id" title="binder">b</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:77"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage"><span class="id" title="definition">precommit_stage</span></a> <a class="idref" href="Giskard.precommit.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:76"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:77"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b:78"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b_child:79" class="idref" href="#b_child:79"><span class="id" title="binder">b_child</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b_child:79"><span class="id" title="variable">b_child</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:78"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="v:80" class="idref" href="#v:80"><span class="id" title="binder">v</span></a> <a id="v':81" class="idref" href="#v':81"><span class="id" title="binder">v'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:76"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:78"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#v:80"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:75"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:76"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b_child:79"><span class="id" title="variable">b_child</span></a> <a class="idref" href="Giskard.precommit.html#v':81"><span class="id" title="variable">v'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_precommit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child</span> [<span class="id" title="var">H_parent</span> [<span class="id" title="var">H_prepare</span> <span class="id" title="var">H_prepare_child</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">b_child</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v</span> [<span class="id" title="var">H_past</span> <span class="id" title="var">H_prepare</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare_child</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v'</span> [<span class="id" title="var">H_past_child</span> <span class="id" title="var">H_prepare_child</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v</span>, <span class="id" title="var">v'</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
From the lemma above, we know that we have at least four views:
let v1, v1' be the views during which b1 and b1's child reach global prepare stage,
and let v2, v2' be the views during which b2 and b2's child reach global prepare stage.
The first layer of case analysis proceeds on v1 and v2: 
<ul class="doclist">
<li> In the case that v1 = v2, we have already proven this in the process of 
  proving <code>prepare_stage_same_view_height_injective_statement</code>.

</li>
<li> In the case that v1 &lt;&gt; v2, we have two symmetric cases. Without loss of generality,
  suppose v1 &lt; v2. Globally, a child block must reach prepare stage after its parent
  block, i.e. v1 &lt;= v1'. By further case analysis on v1' and v2':
<ul class="doclist">
<li> In the case that v1 = v1', either
<ul class="doclist">
<li> v2 = v2', or

</li>
<li> v2 &lt; v2'.

</li>
</ul>

</li>
<li> In the case that v1 &lt; v1', either
<ul class="doclist">
<li> v1 &lt; v2 &lt;= v2' &lt; v1', or

</li>
<li> v1 &lt; v1' &lt; v2 &lt;= v2', or

</li>
<li> v1 &lt; v2 &lt; v1' &lt; v2'. 
</li>
</ul>

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

 It comes as no surprise that some of these cases are vacuous according to
the protocol. It should also be evidence that the complexity of this second
safety proof towers over that of the first safety proof, by virtue of the
number of cases we must analyze based on four views. 
<div class="paragraph"> </div>

 We break down this proof into more manageable chunks by first considering
the special case in which the block and its child reach prepare stage in the
same view that is also the current view. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="precommit_stage_now" class="idref" href="#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> (<a id="tr:82" class="idref" href="#tr:82"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:83" class="idref" href="#i:83"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:84" class="idref" href="#n:84"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b:85" class="idref" href="#b:85"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b_child:86" class="idref" href="#b_child:86"><span class="id" title="binder">b_child</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b_child:86"><span class="id" title="variable">b_child</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:85"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:82"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:83"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:84"><span class="id" title="variable">n</span></a>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:82"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:83"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:84"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Giskard.precommit.html#b:85"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:82"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:83"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:84"><span class="id" title="variable">n</span></a>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:82"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:83"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:84"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Giskard.precommit.html#b_child:86"><span class="id" title="variable">b_child</span></a>.<br/>

<br/>
</div>

<div class="doc">
We can reorganize our cases into those for which v1 = v1' and v2= v2' and
v1 &lt; v2, and those for which this is not the case. The statement of the safety
property for the former cases is as follows, whereby v1 = v (fst (tr i) n) and
v2 = v (fst (tr i) m): 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="precommit_stage_now_height_injective_statement" class="idref" href="#precommit_stage_now_height_injective_statement"><span class="id" title="definition">precommit_stage_now_height_injective_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:87" class="idref" href="#tr:87"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:87"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:88" class="idref" href="#i:88"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:89" class="idref" href="#n:89"><span class="id" title="binder">n</span></a> <a id="m:90" class="idref" href="#m:90"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="b1:91" class="idref" href="#b1:91"><span class="id" title="binder">b1</span></a> <a id="b2:92" class="idref" href="#b2:92"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:89"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:90"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:87"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:88"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:89"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:87"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:88"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#m:90"><span class="id" title="variable">m</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:91"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:92"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:87"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:88"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:89"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:91"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:87"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:88"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:90"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:92"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:91"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:92"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab40"></a><h2 class="section">Reducing the proof</h2>

<div class="paragraph"> </div>

 We first provide intuition on the key properties of Giskard that this statement
relies on. In order to do so, we first require the following definitions of maximum
and minimum height prepare stage blocks in a given view: 
<div class="paragraph"> </div>

 Instead of defining "the highest block to reach prepare stage globally in any
view for any node" computationally, we define it propositionally and then prove
its existence: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="is_max_prepare_height_global" class="idref" href="#is_max_prepare_height_global"><span class="id" title="definition">is_max_prepare_height_global</span></a> (<a id="tr:93" class="idref" href="#tr:93"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:94" class="idref" href="#i:94"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="h:95" class="idref" href="#h:95"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:96" class="idref" href="#b:96"><span class="id" title="binder">b</span></a> <a id="p:97" class="idref" href="#p:97"><span class="id" title="binder">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:93"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:94"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:96"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:97"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:96"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:95"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b:98" class="idref" href="#b:98"><span class="id" title="binder">b</span></a> <a id="p:99" class="idref" href="#p:99"><span class="id" title="binder">p</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:93"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:94"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:98"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:99"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:98"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:95"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_max_prepare_height_in_view_global" class="idref" href="#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> (<a id="tr:100" class="idref" href="#tr:100"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:101" class="idref" href="#i:101"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="h:102" class="idref" href="#h:102"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:103" class="idref" href="#p:103"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:104" class="idref" href="#b:104"><span class="id" title="binder">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:100"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:101"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:104"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:103"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:104"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:102"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b:105" class="idref" href="#b:105"><span class="id" title="binder">b</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:100"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:101"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:105"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:103"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:105"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:102"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_max_prepare_height_in_view" class="idref" href="#is_max_prepare_height_in_view"><span class="id" title="definition">is_max_prepare_height_in_view</span></a> (<a id="tr:106" class="idref" href="#tr:106"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:107" class="idref" href="#i:107"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:108" class="idref" href="#n:108"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="h:109" class="idref" href="#h:109"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:110" class="idref" href="#p:110"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:108"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:106"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:107"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:108"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:111" class="idref" href="#b:111"><span class="id" title="binder">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:106"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:107"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:108"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#b:111"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:111"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:109"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b':112" class="idref" href="#b':112"><span class="id" title="binder">b'</span></a>, <a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:106"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:107"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:108"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#p:110"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#b':112"><span class="id" title="variable">b'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b':112"><span class="id" title="variable">b'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:109"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="exists_max_prepare_height_in_view_global" class="idref" href="#exists_max_prepare_height_in_view_global"><span class="id" title="definition">exists_max_prepare_height_in_view_global</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:113" class="idref" href="#tr:113"><span class="id" title="binder">tr</span></a> <a id="i:114" class="idref" href="#i:114"><span class="id" title="binder">i</span></a> <a id="p:115" class="idref" href="#p:115"><span class="id" title="binder">p</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:113"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:116" class="idref" href="#b:116"><span class="id" title="binder">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:113"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:114"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:116"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:115"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="h:117" class="idref" href="#h:117"><span class="id" title="binder">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:113"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:114"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h:117"><span class="id" title="variable">h</span></a> <a class="idref" href="Giskard.precommit.html#p:115"><span class="id" title="variable">p</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="local_leq_global" class="idref" href="#local_leq_global"><span class="id" title="lemma">local_leq_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:118" class="idref" href="#tr:118"><span class="id" title="binder">tr</span></a> <a id="i:119" class="idref" href="#i:119"><span class="id" title="binder">i</span></a> <a id="h:120" class="idref" href="#h:120"><span class="id" title="binder">h</span></a> <a id="p:121" class="idref" href="#p:121"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:118"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:118"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:119"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h:120"><span class="id" title="variable">h</span></a> <a class="idref" href="Giskard.precommit.html#p:121"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:122" class="idref" href="#n:122"><span class="id" title="binder">n</span></a> <a id="h_local:123" class="idref" href="#h_local:123"><span class="id" title="binder">h_local</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view"><span class="id" title="definition">is_max_prepare_height_in_view</span></a> <a class="idref" href="Giskard.precommit.html#tr:118"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:119"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:122"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#h_local:123"><span class="id" title="variable">h_local</span></a> <a class="idref" href="Giskard.precommit.html#p:121"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#h_local:123"><span class="id" title="variable">h_local</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:120"><span class="id" title="variable">h</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">h</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_global</span> <span class="id" title="var">n</span> <span class="id" title="var">h_local</span> <span class="id" title="var">H_local</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.Compare_dec.html#le_dec"><span class="id" title="lemma">le_dec</span></a> <span class="id" title="var">h_local</span> <span class="id" title="var">h</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_goal</span> | <span class="id" title="var">H_false</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Now&nbsp;we&nbsp;prove&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">h_local</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <span class="id" title="var">h</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_global</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_gprepare</span> <span class="id" title="var">H_ghighest</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_local</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_part</span> [<span class="id" title="var">H_lview</span> [<span class="id" title="var">H_lprepare</span> <span class="id" title="var">H_lhighest</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_lprepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b</span> [<span class="id" title="var">H_lprepare</span> <span class="id" title="var">H_lheight</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_ghighest</span> <span class="id" title="var">b</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_ghighest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_lprepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_left</span> | <span class="id" title="var">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#quorum_subset"><span class="id" title="axiom">quorum_subset</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#processed_PrepareVote_in_view_about_block"><span class="id" title="definition">processed_PrepareVote_in_view_about_block</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">p</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_typeblock</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblock</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_typeblock</span> <span class="id" title="var">H_view</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblock</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> <span class="id" title="var">H_block</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">andb_true_iff</span></a>; <span class="id" title="tactic">split</span>); <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_right</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_in</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_block</span> <span class="id" title="var">H_type</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_lhighest</span> <span class="id" title="var">b</span> <span class="id" title="var">H_lprepare</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_min_prepare_height_global" class="idref" href="#is_min_prepare_height_global"><span class="id" title="definition">is_min_prepare_height_global</span></a> (<a id="tr:124" class="idref" href="#tr:124"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:125" class="idref" href="#i:125"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="h:126" class="idref" href="#h:126"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:127" class="idref" href="#b:127"><span class="id" title="binder">b</span></a> <a id="p:128" class="idref" href="#p:128"><span class="id" title="binder">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:124"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:125"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:127"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:128"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:127"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:126"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b:129" class="idref" href="#b:129"><span class="id" title="binder">b</span></a> <a id="p:130" class="idref" href="#p:130"><span class="id" title="binder">p</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:124"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:125"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:129"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:130"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:129"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:126"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_min_prepare_height_in_view_global" class="idref" href="#is_min_prepare_height_in_view_global"><span class="id" title="definition">is_min_prepare_height_in_view_global</span></a> (<a id="tr:131" class="idref" href="#tr:131"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:132" class="idref" href="#i:132"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="h:133" class="idref" href="#h:133"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:134" class="idref" href="#p:134"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:135" class="idref" href="#b:135"><span class="id" title="binder">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:131"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:132"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:135"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:134"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:135"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:133"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b:136" class="idref" href="#b:136"><span class="id" title="binder">b</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:131"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:132"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:136"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:134"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:136"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:133"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="is_min_prepare_height_in_view" class="idref" href="#is_min_prepare_height_in_view"><span class="id" title="definition">is_min_prepare_height_in_view</span></a> (<a id="tr:137" class="idref" href="#tr:137"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:138" class="idref" href="#i:138"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:139" class="idref" href="#n:139"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="h:140" class="idref" href="#h:140"><span class="id" title="binder">h</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:141" class="idref" href="#p:141"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:139"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:137"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:138"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:139"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:141"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b:142" class="idref" href="#b:142"><span class="id" title="binder">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:137"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:138"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:139"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#p:141"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#b:142"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:142"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:140"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="b':143" class="idref" href="#b':143"><span class="id" title="binder">b'</span></a>, <a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:137"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:138"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:139"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#p:141"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#b':143"><span class="id" title="variable">b'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b':143"><span class="id" title="variable">b'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:140"><span class="id" title="variable">h</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
The first key property states that for every lowest prepare stage block in a view,
its parent block must be either the highest or second-highest prepare stage block of
a past view. Intuitively, this is because there are three cases of view change:
<ul class="doclist">
<li> normal view change, last and highest block reaches prepare stage, and

</li>
<li> abnormal view change, highest prepare block is contained in ViewChangeQC message, and

</li>
<li> abnormal view change, second highest prepare block is contained in ViewChangeQC message. 

</li>
</ul>
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_first_parent_highest_or_second_global" class="idref" href="#prepare_stage_first_parent_highest_or_second_global"><span class="id" title="definition">prepare_stage_first_parent_highest_or_second_global</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:144" class="idref" href="#tr:144"><span class="id" title="binder">tr</span></a> <a id="i:145" class="idref" href="#i:145"><span class="id" title="binder">i</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:144"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b1:146" class="idref" href="#b1:146"><span class="id" title="binder">b1</span></a> <a id="v1:147" class="idref" href="#v1:147"><span class="id" title="binder">v1</span></a>, <a class="idref" href="Giskard.precommit.html#is_min_prepare_height_in_view_global"><span class="id" title="definition">is_min_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:144"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:145"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:146"><span class="id" title="variable">b1</span></a>) <a class="idref" href="Giskard.precommit.html#v1:147"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="v':148" class="idref" href="#v':148"><span class="id" title="binder">v'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#v':148"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#v1:147"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:144"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:145"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b1:146"><span class="id" title="variable">b1</span></a>)) <a class="idref" href="Giskard.precommit.html#v':148"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:144"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:145"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b1:146"><span class="id" title="variable">b1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1) <a class="idref" href="Giskard.precommit.html#v':148"><span class="id" title="variable">v'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
The second key property states that prepare stage block height increases as view
increments. Intuitively, this is because new blocks are proposed on top of a block
carried over from the previous round, either through normal or abnormal view change. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_height_view_morphism_global" class="idref" href="#prepare_stage_height_view_morphism_global"><span class="id" title="definition">prepare_stage_height_view_morphism_global</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:149" class="idref" href="#tr:149"><span class="id" title="binder">tr</span></a> <a id="i:150" class="idref" href="#i:150"><span class="id" title="binder">i</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:149"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b1:151" class="idref" href="#b1:151"><span class="id" title="binder">b1</span></a> <a id="b2:152" class="idref" href="#b2:152"><span class="id" title="binder">b2</span></a> <a id="v1:153" class="idref" href="#v1:153"><span class="id" title="binder">v1</span></a> <a id="v2:154" class="idref" href="#v2:154"><span class="id" title="binder">v2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:149"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:150"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b1:151"><span class="id" title="variable">b1</span></a> <a class="idref" href="Giskard.precommit.html#v1:153"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:149"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:150"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b2:152"><span class="id" title="variable">b2</span></a> <a class="idref" href="Giskard.precommit.html#v2:154"><span class="id" title="variable">v2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#v1:153"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#v2:154"><span class="id" title="variable">v2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:151"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:152"><span class="id" title="variable">b2</span></a>.<br/>

<br/>
</div>

<div class="doc">
The third key property specializes the lemma above and states that non-last prepare
stage block height strictly increases as view increments. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_height_view_morphism_global_non_last" class="idref" href="#prepare_stage_height_view_morphism_global_non_last"><span class="id" title="definition">prepare_stage_height_view_morphism_global_non_last</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:155" class="idref" href="#tr:155"><span class="id" title="binder">tr</span></a> <a id="i:156" class="idref" href="#i:156"><span class="id" title="binder">i</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:155"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b1:157" class="idref" href="#b1:157"><span class="id" title="binder">b1</span></a> <a id="b2:158" class="idref" href="#b2:158"><span class="id" title="binder">b2</span></a> <a id="v1:159" class="idref" href="#v1:159"><span class="id" title="binder">v1</span></a> <a id="v2:160" class="idref" href="#v2:160"><span class="id" title="binder">v2</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:155"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:156"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b1:157"><span class="id" title="variable">b1</span></a> <a class="idref" href="Giskard.precommit.html#v1:159"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:155"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:156"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b2:158"><span class="id" title="variable">b2</span></a> <a class="idref" href="Giskard.precommit.html#v2:160"><span class="id" title="variable">v2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> <a class="idref" href="Giskard.precommit.html#b1:157"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#v1:159"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#v2:160"><span class="id" title="variable">v2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:157"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:158"><span class="id" title="variable">b2</span></a>.<br/>

<br/>
</div>

<div class="doc">
Finally, a block that has a child block in prepare stage in the same view cannot
be the last block of the view. Intuitively, this is true by construction. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="prepare_stage_child_non_last" class="idref" href="#prepare_stage_child_non_last"><span class="id" title="definition">prepare_stage_child_non_last</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:161" class="idref" href="#tr:161"><span class="id" title="binder">tr</span></a> <a id="i:162" class="idref" href="#i:162"><span class="id" title="binder">i</span></a> <a id="n:163" class="idref" href="#n:163"><span class="id" title="binder">n</span></a> <a id="v:164" class="idref" href="#v:164"><span class="id" title="binder">v</span></a> <a id="b:165" class="idref" href="#b:165"><span class="id" title="binder">b</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:161"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:163"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:161"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:162"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:163"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#v:164"><span class="id" title="variable">v</span></a> <a class="idref" href="Giskard.precommit.html#b:165"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="b_child:166" class="idref" href="#b_child:166"><span class="id" title="binder">b_child</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <a class="idref" href="Giskard.precommit.html#b_child:166"><span class="id" title="variable">b_child</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:165"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#prepare_stage_in_view"><span class="id" title="definition">prepare_stage_in_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:161"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:162"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:163"><span class="id" title="variable">n</span></a>) <a class="idref" href="Giskard.precommit.html#v:164"><span class="id" title="variable">v</span></a> <a class="idref" href="Giskard.precommit.html#b_child:166"><span class="id" title="variable">b_child</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> <a class="idref" href="Giskard.precommit.html#b:165"><span class="id" title="variable">b</span></a>.<br/>

<br/>
</div>

<div class="doc">
We now show how we can use the four key properties above to prove our
desired safety result: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="precommit_height_injective_symmetric" class="idref" href="#precommit_height_injective_symmetric"><span class="id" title="lemma">precommit_height_injective_symmetric</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_first_parent_highest_or_second_global"><span class="id" title="definition">prepare_stage_first_parent_highest_or_second_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_height_view_morphism_global"><span class="id" title="definition">prepare_stage_height_view_morphism_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_height_view_morphism_global_non_last"><span class="id" title="definition">prepare_stage_height_view_morphism_global_non_last</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_child_non_last"><span class="id" title="definition">prepare_stage_child_non_last</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:167" class="idref" href="#tr:167"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:167"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:168" class="idref" href="#i:168"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:169" class="idref" href="#n:169"><span class="id" title="binder">n</span></a> <a id="m:170" class="idref" href="#m:170"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:169"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:170"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b1:171" class="idref" href="#b1:171"><span class="id" title="binder">b1</span></a> <a id="b2:172" class="idref" href="#b2:172"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:171"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:172"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:167"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:168"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:169"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:171"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:167"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:168"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:170"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:172"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:171"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:172"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_useful1</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">H_useful4</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_part_n</span> <span class="id" title="var">H_part_m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child1</span> [<span class="id" title="var">H_height1</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare_child1</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child2</span> [<span class="id" title="var">H_height2</span> [<span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_prepare_child2</span>]]].<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">m</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="var">v1</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_lt</span> | [<span class="id" title="var">H_eq</span> | <span class="id" title="var">H_gt</span>]].<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> <span class="id" title="var">b1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">v1</span> <span class="id" title="var">b1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span> <span class="id" title="var">H_prepare1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">b_child1</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">assumption</span>. } <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#prepare_stage_same_view_height_injective"><span class="id" title="lemma">prepare_stage_same_view_height_injective</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <span class="id" title="var">b_child1</span>) (<a class="idref" href="Giskard.structures.html#parent_of"><span class="id" title="axiom">parent_of</span></a> <span class="id" title="var">b_child2</span>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">m</span>)); <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.local.html#last_block"><span class="id" title="definition">last_block</span></a> <span class="id" title="var">b2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">m</span> <span class="id" title="var">v2</span> <span class="id" title="var">b2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span> <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful4</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">b_child2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">assumption</span>. }  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">b2</span> <span class="id" title="var">b1</span> <span class="id" title="var">v2</span> <span class="id" title="var">v1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now that we have walked through one possible and relatively intuitive proof by
identifying and assuming certain key lemmas, we proceed to break down the proof
piecewise. We start by proving facts about view changes - a feature that is absent
from the first safety proof, which only deals with behaviors within the same view. 
<div class="paragraph"> </div>

 Based on Giskard's view change process, we know that a view change is triggered either
normally or abnormally. In the normal case, the last block of the previous view must have
reached prepare stage, as evidenced by the existence of a PrepareQC message for it in
the global message buffer. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="normal_trigger_message_global" class="idref" href="#normal_trigger_message_global"><span class="id" title="definition">normal_trigger_message_global</span></a> (<a id="tr:173" class="idref" href="#tr:173"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:174" class="idref" href="#i:174"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:175" class="idref" href="#p:175"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:176" class="idref" href="#msg:176"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;view&nbsp;change&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:176"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:175"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_last"><span class="id" title="definition">b_last</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:176"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:176"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:173"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:174"><span class="id" title="variable">i</span></a>))).<br/>

<br/>
</div>

<div class="doc">
In the abnormal case, there must be a ViewChangeQC message in the global message buffer. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="timeout_trigger_message_global" class="idref" href="#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> (<a id="tr:177" class="idref" href="#tr:177"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:178" class="idref" href="#i:178"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:179" class="idref" href="#p:179"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:180" class="idref" href="#msg:180"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;view&nbsp;change&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:180"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:180"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:179"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:180"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:177"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:178"><span class="id" title="variable">i</span></a>))).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="timeout_trigger_message_global_dec" class="idref" href="#timeout_trigger_message_global_dec"><span class="id" title="definition">timeout_trigger_message_global_dec</span></a> : <span class="id" title="keyword">forall</span> (<a id="tr:181" class="idref" href="#tr:181"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:182" class="idref" href="#i:182"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:183" class="idref" href="#p:183"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:184" class="idref" href="#msg:184"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">{</span></a> <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:181"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:182"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:183"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:184"><span class="id" title="variable">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">{</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:181"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:182"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:183"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:184"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#87727981cdc1579fef00b9d9c1d3b9da"><span class="id" title="notation">}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">intros</span>.<br/>
<span class="id" title="tactic">case</span> (<a class="idref" href="Giskard.structures.html#message_type_eq_dec"><span class="id" title="definition">message_type_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a>); <span class="id" title="tactic">intros</span>.<br/>
- <span class="id" title="tactic">case</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eq_dec"><span class="id" title="lemma">Nat.eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">p</span>); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">case</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
- <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="trigger_message_global" class="idref" href="#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> (<a id="tr:185" class="idref" href="#tr:185"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:186" class="idref" href="#i:186"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="p:187" class="idref" href="#p:187"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:188" class="idref" href="#msg:188"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#normal_trigger_message_global"><span class="id" title="definition">normal_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:185"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:186"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:187"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:188"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:185"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:186"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:187"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:188"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
</div>

<div class="doc">
If a view change occurs locally from <code>i ~&gt; S i</code> for node <code>n</code>, there must exist
a trigger message signed with <code>i</code>'s view in global state <code>(S i)</code>'s message buffer. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="view_increment_exists_trigger_message_global" class="idref" href="#view_increment_exists_trigger_message_global"><span class="id" title="lemma">view_increment_exists_trigger_message_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:189" class="idref" href="#tr:189"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:189"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n:190" class="idref" href="#n:190"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="i:191" class="idref" href="#i:191"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:190"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:189"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:191"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:190"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:189"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:191"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.precommit.html#n:190"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:192" class="idref" href="#msg:192"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:189"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:191"><span class="id" title="variable">i</span></a>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:189"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:191"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:190"><span class="id" title="variable">n</span></a>)) <a class="idref" href="Giskard.precommit.html#msg:192"><span class="id" title="variable">msg</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_incr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Establishing&nbsp;that&nbsp;n0&nbsp;=&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := @<a class="idref" href="Giskard.global.html#view_different_tells_receiver"><span class="id" title="lemma">view_different_tells_receiver</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">p0</span> <span class="id" title="var">n0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">H_part</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;cases&nbsp;of&nbsp;PrepareQC&nbsp;last&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">msg0</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#delivered_means_sent_global"><span class="id" title="lemma">delivered_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;ViewChange&nbsp;quorum&nbsp;received&nbsp;by&nbsp;the&nbsp;new&nbsp;proposer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.local.html#make_ViewChangeQC"><span class="id" title="definition">make_ViewChangeQC</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span>))); <span class="id" title="tactic">right</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span>, <span class="id" title="var">H_out</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">tauto</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;ViewChangeQC&nbsp;received&nbsp;by&nbsp;validators&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">msg0</span>; <span class="id" title="tactic">right</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#delivered_means_sent_global"><span class="id" title="lemma">delivered_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Any global broadcast message buffer must contain trigger messages for all its past views,
from the view of a particular participant. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="past_view_exists_trigger_message_global" class="idref" href="#past_view_exists_trigger_message_global"><span class="id" title="lemma">past_view_exists_trigger_message_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:193" class="idref" href="#tr:193"><span class="id" title="binder">tr</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:193"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:194" class="idref" href="#n:194"><span class="id" title="binder">n</span></a> <a id="i:195" class="idref" href="#i:195"><span class="id" title="binder">i</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:194"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v_past:196" class="idref" href="#v_past:196"><span class="id" title="binder">v_past</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#v_past:196"><span class="id" title="variable">v_past</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:193"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:195"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:194"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg:197" class="idref" href="#msg:197"><span class="id" title="binder">msg</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:193"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:195"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#v_past:196"><span class="id" title="variable">v_past</span></a> <a class="idref" href="Giskard.precommit.html#msg:197"><span class="id" title="variable">msg</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part</span> <span class="id" title="var">v_past</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_past</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view</span> := @<a class="idref" href="Giskard.global.html#view_same_or_plus_one"><span class="id" title="lemma">view_same_or_plus_one</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_view</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_same</span> | <span class="id" title="var">H_incr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;no&nbsp;view&nbsp;change&nbsp;occurred&nbsp;from&nbsp;i&nbsp;~&gt;&nbsp;S&nbsp;i&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> <span class="id" title="var">H_trigger</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_normal</span> | <span class="id" title="var">H_abnormal</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_normal</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_abnormal</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_abnormal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_out</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;a&nbsp;view&nbsp;change&nbsp;occurred&nbsp;from&nbsp;i&nbsp;~&gt;&nbsp;S&nbsp;i&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">v_past</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>)) <span class="id" title="var">n</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">v_past</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>)) <span class="id" title="var">n</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_lt</span> | <span class="id" title="var">H_eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> <span class="id" title="var">H_trigger</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_normal</span> | <span class="id" title="var">H_abnormal</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_normal</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_abnormal</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;This&nbsp;is&nbsp;the&nbsp;tricky&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view</span> : <span class="id" title="var">v_past</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_eq</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#view_increment_exists_trigger_message_global"><span class="id" title="lemma">view_increment_exists_trigger_message_global</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Trigger messages that exist in global state (S i) exist in global state i as long as
the sender of the message did not make the transition from i ~&gt; S i: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_global_backwards_persistent_verbose" class="idref" href="#trigger_message_global_backwards_persistent_verbose"><span class="id" title="lemma">trigger_message_global_backwards_persistent_verbose</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:198" class="idref" href="#tr:198"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:199" class="idref" href="#i:199"><span class="id" title="binder">i</span></a> <a id="p:200" class="idref" href="#p:200"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:201" class="idref" href="#n:201"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:201"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg:202" class="idref" href="#msg:202"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:202"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="n0:203" class="idref" href="#n0:203"><span class="id" title="binder">n0</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="p0:204" class="idref" href="#p0:204"><span class="id" title="binder">p0</span></a> : <a class="idref" href="Giskard.local.html#NState_transition_type"><span class="id" title="inductive">NState_transition_type</span></a>) (<a id="msg0:205" class="idref" href="#msg0:205"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>) (<a id="lm0:206" class="idref" href="#lm0:206"><span class="id" title="binder">lm0</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.local.html#get_transition"><span class="id" title="definition">get_transition</span></a> <a class="idref" href="Giskard.precommit.html#p0:204"><span class="id" title="variable">p0</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a>) <a class="idref" href="Giskard.precommit.html#msg0:205"><span class="id" title="variable">msg0</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a>) <a class="idref" href="Giskard.precommit.html#lm0:206"><span class="id" title="variable">lm0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.global.html#broadcast_messages"><span class="id" title="definition">broadcast_messages</span></a> (<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a>)) <a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a>) <a class="idref" href="Giskard.precommit.html#lm0:206"><span class="id" title="variable">lm0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#n0:203"><span class="id" title="variable">n0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.precommit.html#msg:202"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:198"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:199"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:200"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:202"><span class="id" title="variable">msg</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">H_part</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_trigger</span> <span class="id" title="var">n0</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span> <span class="id" title="var">H_in0</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span> <span class="id" title="var">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_normal</span> | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_normal</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_normal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_in</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_false</span> | <span class="id" title="var">H_goal</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.global.html#delivered_means_sender_made_transition"><span class="id" title="lemma">delivered_means_sender_made_transition</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">n0</span> <span class="id" title="var">lm0</span> <span class="id" title="var">H_false</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">right</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_timeout</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_timeout</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_false</span> | <span class="id" title="var">H_goal</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.global.html#delivered_means_sender_made_transition"><span class="id" title="lemma">delivered_means_sender_made_transition</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">n0</span> <span class="id" title="var">lm0</span> <span class="id" title="var">H_false</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Finally, an important property of trigger messages is that their blocks are in
global prepare stage in the current view. In the normal trigger message case, this
is direct by definition: PrepareQC suffices to enter a block into prepare stage.
In the abnormal trigger message case, we require a few supplementary facts: 
<div class="paragraph"> </div>

 The block contained in ViewChange messages is at global prepare stage: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="ViewChange_message_block_prepare_stage_global" class="idref" href="#ViewChange_message_block_prepare_stage_global"><span class="id" title="lemma">ViewChange_message_block_prepare_stage_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:207" class="idref" href="#tr:207"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:208" class="idref" href="#i:208"><span class="id" title="binder">i</span></a> <a id="p:209" class="idref" href="#p:209"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:210" class="idref" href="#msg:210"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:207"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:210"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:210"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:209"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:210"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:207"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:208"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:207"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:208"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:210"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:209"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_abnormal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_abnormal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_step_global"><span class="id" title="lemma">prepare_stage_in_view_step_global</span></a>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The block contained in timeout trigger messages is at global prepare stage: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="timeout_trigger_message_block_prepare_stage_global" class="idref" href="#timeout_trigger_message_block_prepare_stage_global"><span class="id" title="lemma">timeout_trigger_message_block_prepare_stage_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:211" class="idref" href="#tr:211"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:212" class="idref" href="#i:212"><span class="id" title="binder">i</span></a> <a id="p:213" class="idref" href="#p:213"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:214" class="idref" href="#msg:214"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:211"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:214"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#ViewChangeQC"><span class="id" title="constructor">ViewChangeQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:214"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:213"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:214"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:211"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:212"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:211"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:212"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:214"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:213"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_abnormal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_abnormal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_step_global"><span class="id" title="lemma">prepare_stage_in_view_step_global</span></a>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;ViewChange&nbsp;quorum&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#ViewChange_message_block_prepare_stage_global"><span class="id" title="lemma">ViewChange_message_block_prepare_stage_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>) <span class="id" title="var">p</span> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>)) <span class="id" title="var">H_prot_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;the&nbsp;message&nbsp;type&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#highest_ViewChange_message_type_eq_ViewChange"><span class="id" title="lemma">highest_ViewChange_message_type_eq_ViewChange</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;the&nbsp;view&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_goal</span> := <a class="idref" href="Giskard.local.html#get_view_highest_ViewChange_message_node_view"><span class="id" title="lemma">get_view_highest_ViewChange_message_node_view</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span> <span class="id" title="var">msg0</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_goal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;the&nbsp;membership&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_goal</span> := <a class="idref" href="Giskard.local.html#get_view_highest_ViewChange_message_in_counting_messages"><span class="id" title="lemma">get_view_highest_ViewChange_message_in_counting_messages</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>) <span class="id" title="var">msg0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_goal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_goal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The block contained in trigger messages is at global prepare stage: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_block_prepare_stage_global" class="idref" href="#trigger_message_block_prepare_stage_global"><span class="id" title="lemma">trigger_message_block_prepare_stage_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:215" class="idref" href="#tr:215"><span class="id" title="binder">tr</span></a> <a id="i:216" class="idref" href="#i:216"><span class="id" title="binder">i</span></a> <a id="p:217" class="idref" href="#p:217"><span class="id" title="binder">p</span></a> <a id="msg:218" class="idref" href="#msg:218"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:215"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:215"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:216"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:217"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:218"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:215"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:216"><span class="id" title="variable">i</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:218"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:217"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_normal</span> | <span class="id" title="var">H_abnormal</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_normal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_block_prepare_stage_global"><span class="id" title="lemma">timeout_trigger_message_block_prepare_stage_global</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
These global trigger messages are significant because the blocks contained in serve as:
<ul class="doclist">
<li> strict lower bounds for prepare stage blocks in the next view, and

</li>
<li> non-strict upper bounds for prepare stage blocks in the current view.

</li>
</ul>

<div class="paragraph"> </div>

 We establish these two useful qualities about global trigger message blocks in turn. 
<div class="paragraph"> </div>

<a id="lab41"></a><h2 class="section">Global trigger message blocks as lower bounds</h2>

<div class="paragraph"> </div>

 First, we show that the height of the block contained in the trigger message
for a view is the lowest height of all blocks that reach prepare stage in the next view. 
<div class="paragraph"> </div>

 More formally, we wish to establish the following: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="past_view_trigger_message_lowest_block_global_statement" class="idref" href="#past_view_trigger_message_lowest_block_global_statement"><span class="id" title="definition">past_view_trigger_message_lowest_block_global_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:219" class="idref" href="#tr:219"><span class="id" title="binder">tr</span></a> <a id="i:220" class="idref" href="#i:220"><span class="id" title="binder">i</span></a> <a id="n:221" class="idref" href="#n:221"><span class="id" title="binder">n</span></a> <a id="p:222" class="idref" href="#p:222"><span class="id" title="binder">p</span></a> <a id="msg:223" class="idref" href="#msg:223"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:219"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:221"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:219"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:220"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:222"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:223"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b:224" class="idref" href="#b:224"><span class="id" title="binder">b</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:219"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:220"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:224"><span class="id" title="variable">b</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#p:222"><span class="id" title="variable">p</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:224"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:223"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
We prove this by showing that the trigger message for a view carries the piggyback
block for all PrepareBlock messages sent in the next view. Because the height of
piggyback block in any PrepareBlock message is lower than the height of the proposed
block, and all prepare stage blocks must have a PrepareBlock message, the trigger message
block must be lower than the proposed block/prepare stage block. The proof of the statement
above therefore requires the following ingredients:
<ul class="doclist">
<li> all blocks that reach prepare stage in some view must have a PrepareBlock message
  in the global message buffer in that view, and

</li>
<li> the piggyback block of PrepareBlock messages in some view is equal to the trigger
  message block from the previous view, and

</li>
<li> all PrepareBlock messages have a lower piggyback block than proposed block. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab42"></a><h3 class="section">Ingredient one: All blocks that reach prepare stage in some view must have a PrepareBlock message in the global message buffer in that view.</h3>

<div class="paragraph"> </div>

 We prove the first ingredient by case analysis on blocks being in prepare stage in some
view: we must prove the existence of a global PrepareBlock message from the existence of a
global PrepareVote and PrepareQC message respectively. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_means_PrepareVote_PrepareQC_exists_global" class="idref" href="#prepare_means_PrepareVote_PrepareQC_exists_global"><span class="id" title="lemma">prepare_means_PrepareVote_PrepareQC_exists_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:225" class="idref" href="#tr:225"><span class="id" title="binder">tr</span></a> <a id="i:226" class="idref" href="#i:226"><span class="id" title="binder">i</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:225"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b:227" class="idref" href="#b:227"><span class="id" title="binder">b</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>) (<a id="x:228" class="idref" href="#x:228"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:225"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:226"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:227"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#x:228"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg1:229" class="idref" href="#msg1:229"><span class="id" title="binder">msg1</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:229"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:225"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:226"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:229"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#x:228"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:229"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#b:227"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:229"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:229"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_quorum</span> | <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#empty_has_no_two_thirds'"><span class="id" title="axiom">empty_has_no_two_thirds'</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_quorum</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n</span> <span class="id" title="var">H_in</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> [<span class="id" title="var">H_sender</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> <span class="id" title="var">H_typeblockview</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">andb_true_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblockview</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblockview</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_typeblock</span> <span class="id" title="var">H_view</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_typeblock</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_typeblock</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> <span class="id" title="var">H_block</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_qc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg</span> <span class="id" title="var">H_qc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We use the above fact to break down the proof that all prepare stage blocks must have a
PrepareBlock message. Taking the left disjunct of <span class="inlinecode"><a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a></span>, we first
show that if a PrepareVote message for a block exists in the global message buffer, then a
PrepareBlock message must exist for that block in the same view. This lemma belongs to
a class of lemmas that we prove using the same proof pattern: by first showing the local
version using induction on protocol traces, and then strengthening and weakening the
premise and conclusion respectively to obtain the global version. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="PrepareVote_sent_means_PrepareBlock_processed_local" class="idref" href="#PrepareVote_sent_means_PrepareBlock_processed_local"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_processed_local</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:230" class="idref" href="#tr:230"><span class="id" title="binder">tr</span></a> <a id="i:231" class="idref" href="#i:231"><span class="id" title="binder">i</span></a> <a id="n:232" class="idref" href="#n:232"><span class="id" title="binder">n</span></a> <a id="msg1:233" class="idref" href="#msg1:233"><span class="id" title="binder">msg1</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:230"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:232"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:233"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:230"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:231"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:232"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:233"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg2:234" class="idref" href="#msg2:234"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:234"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:233"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:234"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:233"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:234"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:234"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:230"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:231"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:232"><span class="id" title="variable">n</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg1</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">IH_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg1</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#make_PrepareBlocks_message_type"><span class="id" title="lemma">make_PrepareBlocks_message_type</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type1</span> | <span class="id" title="var">H_type1</span>]; <span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;three&nbsp;remaining&nbsp;cases&nbsp;that&nbsp;send&nbsp;PrepareVote&nbsp;messages,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_sent1_copy</span> := <span class="id" title="var">H_sent1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_in'</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_received'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_sent1_copy</span> := <span class="id" title="var">H_sent1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_in'</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_received'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_sent1_copy</span> := <span class="id" title="var">H_sent1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_eq'</span> <span class="id" title="var">H_in'</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_received'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq'</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="PrepareVote_sent_means_PrepareBlock_sent_global" class="idref" href="#PrepareVote_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_sent_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:235" class="idref" href="#tr:235"><span class="id" title="binder">tr</span></a> <a id="i:236" class="idref" href="#i:236"><span class="id" title="binder">i</span></a> <a id="msg1:237" class="idref" href="#msg1:237"><span class="id" title="binder">msg1</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:235"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:237"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:235"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:236"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:237"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg2:238" class="idref" href="#msg2:238"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:238"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:237"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:238"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:237"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:238"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:238"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:235"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:236"><span class="id" title="variable">i</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#PrepareVote_sent_means_PrepareBlock_processed_local"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_processed_local</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg1</span>) <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">H_rest</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg1</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The right disjunct states that if a PrepareQC message for a block exists in the
global message buffer, then a PrepareBlock message must exist for that block in
the same view. 
<div class="paragraph"> </div>

 However, the proof structure here differs due to the following
statement being untrue. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="PrepareQC_sent_means_exists_PrepareBlock_processed_local" class="idref" href="#PrepareQC_sent_means_exists_PrepareBlock_processed_local"><span class="id" title="definition">PrepareQC_sent_means_exists_PrepareBlock_processed_local</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:239" class="idref" href="#tr:239"><span class="id" title="binder">tr</span></a> <a id="i:240" class="idref" href="#i:240"><span class="id" title="binder">i</span></a> <a id="n:241" class="idref" href="#n:241"><span class="id" title="binder">n</span></a> <a id="msg1:242" class="idref" href="#msg1:242"><span class="id" title="binder">msg1</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:239"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:241"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:242"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:239"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:240"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:241"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:242"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg2:243" class="idref" href="#msg2:243"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:243"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:242"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:243"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:242"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:243"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:243"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:239"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:240"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:241"><span class="id" title="variable">n</span></a>)).<br/>

<br/>
</div>

<div class="doc">
The reason why this is untrue is in the case of sending PrepareQC messages
alongside ViewChangeQC messages - it is then no longer the case that the sender
of the PrepareQC message has personally seen a PrepareBlock for that block,
because it could have reached quorum votes independently of its participation. 
<div class="paragraph"> </div>

 Instead, we prove this by reverting back to global reasoning. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a id="PrepareQC_sent_means_exists_PrepareVote_processed_local" class="idref" href="#PrepareQC_sent_means_exists_PrepareVote_processed_local"><span class="id" title="lemma">PrepareQC_sent_means_exists_PrepareVote_processed_local</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:244" class="idref" href="#tr:244"><span class="id" title="binder">tr</span></a> <a id="i:245" class="idref" href="#i:245"><span class="id" title="binder">i</span></a> <a id="n:246" class="idref" href="#n:246"><span class="id" title="binder">n</span></a> <a id="msg1:247" class="idref" href="#msg1:247"><span class="id" title="binder">msg1</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:244"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:246"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:247"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:244"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:245"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:246"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:247"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="n':248" class="idref" href="#n':248"><span class="id" title="binder">n'</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="msg2:249" class="idref" href="#msg2:249"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n':248"><span class="id" title="variable">n'</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:249"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:247"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:249"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:247"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:249"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:249"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="Giskard.structures.html#counting_messages"><span class="id" title="projection">counting_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:244"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:245"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n':248"><span class="id" title="variable">n'</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">msg1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>]; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg1</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_type1</span> <span class="id" title="var">n</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_old</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">IH_prot</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n'</span>, <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg1</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#make_PrepareBlocks_message_type"><span class="id" title="lemma">make_PrepareBlocks_message_type</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type1</span> | <span class="id" title="var">H_type1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent1</span> | <span class="id" title="var">H_sent1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type1</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>; <span class="id" title="var">easy</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;PrepareQC&nbsp;is&nbsp;sent&nbsp;by&nbsp;the&nbsp;node&nbsp;itself&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_quorum</span> : <a class="idref" href="Giskard.local.html#vote_quorum_in_view"><span class="id" title="definition">vote_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#empty_has_no_two_thirds'"><span class="id" title="axiom">empty_has_no_two_thirds'</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_quorum</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> <span class="id" title="var">H_sender'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_map_iff"><span class="id" title="lemma">in_map_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sender'</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sender'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_sender'</span> <span class="id" title="var">H_sent'</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n</span>, <span class="id" title="var">msg'</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_rest'</span> <span class="id" title="var">H_view'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type'</span> <span class="id" title="var">H_block'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">Nat.eqb_eq</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#block_eqb_correct"><span class="id" title="axiom">block_eqb_correct</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">easy</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;PrepareQC&nbsp;is&nbsp;aggregated&nbsp;and&nbsp;from&nbsp;some&nbsp;other&nbsp;node&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#node_eq_dec"><span class="id" title="definition">node_eq_dec</span></a> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>) <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> := <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> := <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> := <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> := <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>)) <span class="id" title="var">msg0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a> := <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#delivered_means_sent_global"><span class="id" title="lemma">delivered_means_sent_global</span></a> <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_part'</span> [<span class="id" title="var">H_type'</span> [<span class="id" title="var">H_view'</span> [<span class="id" title="var">H_block'</span> <span class="id" title="var">H_processed</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n'</span>, <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view'</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> := <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> := <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> := <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> := <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a> := <a class="idref" href="Giskard.structures.html#GenesisBlock"><span class="id" title="axiom">GenesisBlock</span></a> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Participation&nbsp;rights&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights"><span class="id" title="lemma">participation_rights</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Participation&nbsp;rights&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights"><span class="id" title="lemma">participation_rights</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">i</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#delivered_means_sent_global"><span class="id" title="lemma">delivered_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_part'</span> [<span class="id" title="var">H_type'</span> [<span class="id" title="var">H_view'</span> [<span class="id" title="var">H_block'</span> <span class="id" title="var">H_processed</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n'</span>, <span class="id" title="var">msg'</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view'</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent1</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#counting_messages_monotonic"><span class="id" title="lemma">counting_messages_monotonic</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="PrepareQC_sent_means_PrepareVote_sent_global" class="idref" href="#PrepareQC_sent_means_PrepareVote_sent_global"><span class="id" title="lemma">PrepareQC_sent_means_PrepareVote_sent_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:250" class="idref" href="#tr:250"><span class="id" title="binder">tr</span></a> <a id="i:251" class="idref" href="#i:251"><span class="id" title="binder">i</span></a> <a id="msg1:252" class="idref" href="#msg1:252"><span class="id" title="binder">msg1</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:250"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:252"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:250"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:251"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:252"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg2:253" class="idref" href="#msg2:253"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:253"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareVote"><span class="id" title="constructor">PrepareVote</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:252"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:253"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:252"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:253"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:253"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:250"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:251"><span class="id" title="variable">i</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#PrepareQC_sent_means_exists_PrepareVote_processed_local"><span class="id" title="lemma">PrepareQC_sent_means_exists_PrepareVote_processed_local</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg1</span>) <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg2</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n'</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="PrepareQC_sent_means_PrepareBlock_sent_global" class="idref" href="#PrepareQC_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareQC_sent_means_PrepareBlock_sent_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:254" class="idref" href="#tr:254"><span class="id" title="binder">tr</span></a> <a id="i:255" class="idref" href="#i:255"><span class="id" title="binder">i</span></a> <a id="msg1:256" class="idref" href="#msg1:256"><span class="id" title="binder">msg1</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:254"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg1:256"><span class="id" title="variable">msg1</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:254"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:255"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg1:256"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareQC"><span class="id" title="constructor">PrepareQC</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg2:257" class="idref" href="#msg2:257"><span class="id" title="binder">msg2</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg2:257"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg1:256"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg2:257"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:256"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:257"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg2:257"><span class="id" title="variable">msg2</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:254"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:255"><span class="id" title="variable">i</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_sent1</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#PrepareQC_sent_means_exists_PrepareVote_processed_local"><span class="id" title="lemma">PrepareQC_sent_means_exists_PrepareVote_processed_local</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg1</span>) <span class="id" title="var">msg1</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_type1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">n'</span> [<span class="id" title="var">msg2</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;have&nbsp;established&nbsp;that&nbsp;n'&nbsp;has&nbsp;sent&nbsp;a&nbsp;PrepareVote&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful2</span> := <a class="idref" href="Giskard.precommit.html#PrepareVote_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_sent_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n'</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg0</span> <span class="id" title="var">H_about0</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg0</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg2</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg0</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg2</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We combine the four proofs above in the following global fact which concludes
our proof of the first ingredient: we have shown that any block in global prepare
stage in some view must have a PrepareBlock message in the global message buffer
in that view. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="prepare_stage_in_view_means_PrepareBlock_sent_global" class="idref" href="#prepare_stage_in_view_means_PrepareBlock_sent_global"><span class="id" title="lemma">prepare_stage_in_view_means_PrepareBlock_sent_global</span></a> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:258" class="idref" href="#tr:258"><span class="id" title="binder">tr</span></a> <a id="i:259" class="idref" href="#i:259"><span class="id" title="binder">i</span></a> <a id="b:260" class="idref" href="#b:260"><span class="id" title="binder">b</span></a> <a id="p:261" class="idref" href="#p:261"><span class="id" title="binder">p</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:258"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:258"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:259"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:260"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:261"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="msg:262" class="idref" href="#msg:262"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:262"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#p:261"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:262"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b:260"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:262"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:262"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:258"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:259"><span class="id" title="variable">i</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_means_PrepareVote_PrepareQC_exists_global"><span class="id" title="lemma">prepare_means_PrepareVote_PrepareQC_exists_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg1</span> [<span class="id" title="var">H_sent</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_block</span> [<span class="id" title="var">H_type1</span> | <span class="id" title="var">H_type1</span>]]]]];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_block</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareVote_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_sent_global</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareQC_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareQC_sent_means_PrepareBlock_sent_global</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab43"></a><h3 class="section">Ingredient two: The piggyback block of PrepareBlock messages in some view is equal to the trigger message block from the previous view.</h3>

<div class="paragraph"> </div>

 We formalize the second ingredient as follows: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="trigger_message_next_view_PrepareBlock_same_block_global" class="idref" href="#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:263" class="idref" href="#tr:263"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="H_prot:264" class="idref" href="#H_prot:264"><span class="id" title="binder">H_prot</span></a> : <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:263"><span class="id" title="variable">tr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="i:265" class="idref" href="#i:265"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="msg:266" class="idref" href="#msg:266"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a id="v:267" class="idref" href="#v:267"><span class="id" title="binder">v</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:263"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:265"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#v:267"><span class="id" title="variable">v</span></a> <a class="idref" href="Giskard.precommit.html#msg:266"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="pb_msg:268" class="idref" href="#pb_msg:268"><span class="id" title="binder">pb_msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#pb_msg:268"><span class="id" title="variable">pb_msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#pb_msg:268"><span class="id" title="variable">pb_msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#v:267"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#pb_msg:268"><span class="id" title="variable">pb_msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:263"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:265"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a> <a class="idref" href="Giskard.precommit.html#pb_msg:268"><span class="id" title="variable">pb_msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:266"><span class="id" title="variable">msg</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab44"></a><h3 class="section">Ingredient three: All PrepareBlock messages have a lower piggyback block than proposed block</h3>

<div class="paragraph"> </div>

 We show this height relation between piggyback and proposed blocks in
PrepareBlock messages directly using induction on protocol traces - it
is true by construction of PrepareBlock messages. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="PrepareBlock_block_height_geq" class="idref" href="#PrepareBlock_block_height_geq"><span class="id" title="lemma">PrepareBlock_block_height_geq</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:269" class="idref" href="#tr:269"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:269"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:270" class="idref" href="#i:270"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:271" class="idref" href="#msg:271"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:271"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:269"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:270"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:271"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:271"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:271"><span class="id" title="variable">msg</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H_prot_copy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#node_eq_dec"><span class="id" title="definition">node_eq_dec</span></a> <span class="id" title="var">n0</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_true</span> | <span class="id" title="var">H_false</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_deliver</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>]; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a>, <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_generate_new_block"><span class="id" title="lemma">about_generate_new_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#GenesisBlock_height"><span class="id" title="axiom">GenesisBlock_height</span></a>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_generate_last_block"><span class="id" title="axiom">about_generate_last_block</span></a>; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a>, <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> (<a class="idref" href="Giskard.structures.html#about_generate_last_block"><span class="id" title="axiom">about_generate_last_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="var">msg0</span>)) <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_generate_new_block"><span class="id" title="lemma">about_generate_new_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a>, <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> (<a class="idref" href="Giskard.structures.html#about_generate_last_block"><span class="id" title="axiom">about_generate_last_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>)) <span class="id" title="var">msg0</span>)))) <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_generate_new_block"><span class="id" title="lemma">about_generate_new_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_piggyback_block"><span class="id" title="projection">get_piggyback_block</span></a>, <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> (<a class="idref" href="Giskard.structures.html#about_generate_last_block"><span class="id" title="axiom">about_generate_last_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> (<a class="idref" href="Giskard.structures.html#generate_new_block"><span class="id" title="axiom">generate_new_block</span></a> <span class="id" title="var">_</span> ))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_generate_new_block"><span class="id" title="lemma">about_generate_new_block</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*  <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;n0&nbsp;is&nbsp;not&nbsp;the&nbsp;sender,&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.global.html#delivered_means_sender_made_transition"><span class="id" title="lemma">delivered_means_sender_made_transition</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot_copy</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">n0</span> <span class="id" title="var">lm0</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab45"></a><h3 class="section">Proof of the lower bound</h3>

<div class="paragraph"> </div>

 With the three ingredients at hand, we are ready to prove our lower bound. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="past_view_trigger_message_lowest_block_global" class="idref" href="#past_view_trigger_message_lowest_block_global"><span class="id" title="lemma">past_view_trigger_message_lowest_block_global</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:272" class="idref" href="#tr:272"><span class="id" title="binder">tr</span></a> <a id="i:273" class="idref" href="#i:273"><span class="id" title="binder">i</span></a> <a id="n:274" class="idref" href="#n:274"><span class="id" title="binder">n</span></a> <a id="p:275" class="idref" href="#p:275"><span class="id" title="binder">p</span></a> <a id="msg:276" class="idref" href="#msg:276"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:272"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:274"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:272"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:273"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:275"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:276"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b:277" class="idref" href="#b:277"><span class="id" title="binder">b</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:272"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:273"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:277"><span class="id" title="variable">b</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#p:275"><span class="id" title="variable">p</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:277"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:276"><span class="id" title="variable">msg</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_trigger</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Enter&nbsp;ingredient&nbsp;one:&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful1</span> := <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_PrepareBlock_sent_global"><span class="id" title="lemma">prepare_stage_in_view_means_PrepareBlock_sent_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful1</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">p</span>) <span class="id" title="var">H_prot</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">prepare_msg</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_block</span> <span class="id" title="var">H_sent</span>]]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Enter&nbsp;ingredient&nbsp;two:&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">p</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">prepare_msg</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_sent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_useful2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Enter&nbsp;ingredient&nbsp;three:&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful3</span> := <a class="idref" href="Giskard.precommit.html#PrepareBlock_block_height_geq"><span class="id" title="lemma">PrepareBlock_block_height_geq</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">prepare_msg</span> <span class="id" title="var">H_sent</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab46"></a><h2 class="section">Global trigger message blocks as upper bounds</h2>

<div class="paragraph"> </div>

 Second, we show that the height of the block contained in the trigger message
for a view is the highest or second highest of all blocks that reach prepare stage
in the present view. 
<div class="paragraph"> </div>

 We know that trigger messages are either PrepareQC messages for the last proposed
block, in the case of normal view change, or ViewChangeQC messages for the max height
block, in the case of abnormal view change. 
<div class="paragraph"> </div>

 Therefore, we must show this height property for each case. 
<div class="paragraph"> </div>

 The normal view change case. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="normal_trigger_message_highest_global_statement" class="idref" href="#normal_trigger_message_highest_global_statement"><span class="id" title="definition">normal_trigger_message_highest_global_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:278" class="idref" href="#tr:278"><span class="id" title="binder">tr</span></a> <a id="i:279" class="idref" href="#i:279"><span class="id" title="binder">i</span></a> <a id="p:280" class="idref" href="#p:280"><span class="id" title="binder">p</span></a> <a id="msg:281" class="idref" href="#msg:281"><span class="id" title="binder">msg</span></a> <a id="h_max:282" class="idref" href="#h_max:282"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:278"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#normal_trigger_message_global"><span class="id" title="definition">normal_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:278"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:279"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:280"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:281"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:278"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:279"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:282"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:280"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:281"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:282"><span class="id" title="variable">h_max</span></a>.<br/>

<br/>
</div>

<div class="doc">
In the abnormal view change case: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="timeout_trigger_message_highest_or_second_highest_global_statement" class="idref" href="#timeout_trigger_message_highest_or_second_highest_global_statement"><span class="id" title="definition">timeout_trigger_message_highest_or_second_highest_global_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:283" class="idref" href="#tr:283"><span class="id" title="binder">tr</span></a> <a id="i:284" class="idref" href="#i:284"><span class="id" title="binder">i</span></a> <a id="p:285" class="idref" href="#p:285"><span class="id" title="binder">p</span></a> <a id="msg:286" class="idref" href="#msg:286"><span class="id" title="binder">msg</span></a> <a id="h_max:287" class="idref" href="#h_max:287"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:283"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:283"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:284"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:285"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:286"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:283"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:284"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:287"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:285"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:286"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:287"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:286"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:287"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>

<br/>
</div>

<div class="doc">
The two cases amount to the following: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="trigger_message_highest_or_second_highest_global_statement" class="idref" href="#trigger_message_highest_or_second_highest_global_statement"><span class="id" title="definition">trigger_message_highest_or_second_highest_global_statement</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:288" class="idref" href="#tr:288"><span class="id" title="binder">tr</span></a> <a id="i:289" class="idref" href="#i:289"><span class="id" title="binder">i</span></a> <a id="p:290" class="idref" href="#p:290"><span class="id" title="binder">p</span></a> <a id="msg:291" class="idref" href="#msg:291"><span class="id" title="binder">msg</span></a> <a id="h_max:292" class="idref" href="#h_max:292"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:288"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:288"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:289"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:290"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:291"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:288"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:289"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:292"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:290"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:291"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:292"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:291"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:292"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>

<br/>
</div>

<div class="doc">
<a id="lab47"></a><h3 class="section">Normal view change trigger message contains the highest block</h3>

<div class="paragraph"> </div>

 In the normal view change case, the proof is relatively straightforward. The trigger
message is a PrepareQC for the last block proposed in the view. If there exists a PrepareQC
message for that block, there must exist a PrepareBlock message for that block. By 
construction of PrepareBlock messages, the last block proposed in the view is the
highest block. Therefore, the block contained in the trigger message is the highest
prepare stage block in the view. 
<div class="paragraph"> </div>

 We first establish a connection between the block contained in the normal trigger
message and its corresponding PrepareBlock message. 
<div class="paragraph"> </div>

 Nodes cannot send messages labeled with a view greater than its current view: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="out_message_view_bound" class="idref" href="#out_message_view_bound"><span class="id" title="lemma">out_message_view_bound</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:293" class="idref" href="#tr:293"><span class="id" title="binder">tr</span></a> <a id="n:294" class="idref" href="#n:294"><span class="id" title="binder">n</span></a> <a id="i:295" class="idref" href="#i:295"><span class="id" title="binder">i</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:293"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:294"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="msg:296" class="idref" href="#msg:296"><span class="id" title="binder">msg</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:296"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:293"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:295"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:294"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:296"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:293"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:295"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:294"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_sent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_sent</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view</span> := <a class="idref" href="Giskard.global.html#view_same_or_plus_one"><span class="id" title="lemma">view_same_or_plus_one</span></a> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;message&nbsp;is&nbsp;old&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;message&nbsp;is&nbsp;new&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_sent</span> | <span class="id" title="var">H_sent</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>; <span class="id" title="tactic">simpl</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_valid</span> : <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>) <span class="id" title="var">msg0</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_valid</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_sent</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_view_msg</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view_msg</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg0</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_sent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
At the local out message buffer level, blocks tagged as last block are higher
than any other block in the same view: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="last_block_highest_block_sent" class="idref" href="#last_block_highest_block_sent"><span class="id" title="lemma">last_block_highest_block_sent</span></a> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:297" class="idref" href="#tr:297"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="n:298" class="idref" href="#n:298"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>), <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:298"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:299" class="idref" href="#i:299"><span class="id" title="binder">i</span></a> <a id="p:300" class="idref" href="#p:300"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:301" class="idref" href="#msg:301"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:297"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:301"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:301"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:300"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:301"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:297"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:299"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:298"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_last"><span class="id" title="definition">b_last</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:301"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg':302" class="idref" href="#msg':302"><span class="id" title="binder">msg'</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg':302"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg':302"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:300"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg':302"><span class="id" title="variable">msg'</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:297"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:299"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:298"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:301"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg':302"><span class="id" title="variable">msg'</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">n</span> <span class="id" title="var">H_part</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_last</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_type'</span> <span class="id" title="var">H_view'</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>]; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg'</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old'</span> | <span class="id" title="var">H_new'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;case&nbsp;both&nbsp;messages&nbsp;are&nbsp;old&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span> <span class="id" title="var">H_old'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;case&nbsp;msg'&nbsp;is&nbsp;new&nbsp;and&nbsp;msg&nbsp;is&nbsp;old&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> <span class="id" title="var">msg'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_eq</span> | <span class="id" title="var">H_neq</span>]; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;cases&nbsp;that&nbsp;don't&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;type&nbsp;contradiction&nbsp;for&nbsp;msg&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> | <span class="id" title="var">H_in'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_bound</span> : <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="tactic">by</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#out_message_view_bound"><span class="id" title="lemma">out_message_view_bound</span></a>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span> <span class="id" title="tactic">at</span> 1; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_bound</span>; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;initial&nbsp;block&nbsp;proposal&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_init</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#NState_init"><span class="id" title="definition">NState_init</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_old</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_old</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;case&nbsp;msg&nbsp;is&nbsp;new&nbsp;and&nbsp;msg'&nbsp;is&nbsp;old&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> <span class="id" title="var">msg'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_eq</span> | <span class="id" title="var">H_neq</span>]; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;cases&nbsp;that&nbsp;don't&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;type&nbsp;contradiction&nbsp;for&nbsp;msg&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_bound</span> : <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="var">msg'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="tactic">by</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#out_message_view_bound"><span class="id" title="lemma">out_message_view_bound</span></a>; <span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span> <span class="id" title="tactic">at</span> 2; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_bound</span>; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;initial&nbsp;block&nbsp;proposal&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_init</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#NState_init"><span class="id" title="definition">NState_init</span></a> (<a class="idref" href="Giskard.structures.html#node_id"><span class="id" title="projection">node_id</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_old'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_old'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;case&nbsp;both&nbsp;messages&nbsp;are&nbsp;new&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg'</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> <span class="id" title="var">msg'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_eq</span> | <span class="id" title="var">H_neq</span>]; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;cases&nbsp;that&nbsp;don't&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;type&nbsp;contradiction&nbsp;for&nbsp;msg&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;non-last&nbsp;block&nbsp;for&nbsp;msg&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_last</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_last</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Giskard.structures.html#about_non_last_block"><span class="id" title="axiom">about_non_last_block</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_last</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Three&nbsp;remaining&nbsp;PrepareBlock&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;cases&nbsp;that&nbsp;don't&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;type&nbsp;contradiction&nbsp;for&nbsp;msg'&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> | <span class="id" title="var">H_in'</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_in'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally,&nbsp;in&nbsp;the&nbsp;remaining&nbsp;cases&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#proj1"><span class="id" title="lemma">proj1</span></a> (<a class="idref" href="Giskard.structures.html#about_generate_last_block"><span class="id" title="axiom">about_generate_last_block</span></a> <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.structures.html#about_generate_new_block"><span class="id" title="lemma">about_generate_new_block</span></a> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The sender of all PrepareBlock messages in a view is the block proposer of that view: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="PrepareBlock_sender_is_new_proposer_local" class="idref" href="#PrepareBlock_sender_is_new_proposer_local"><span class="id" title="lemma">PrepareBlock_sender_is_new_proposer_local</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:303" class="idref" href="#tr:303"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:304" class="idref" href="#i:304"><span class="id" title="binder">i</span></a> <a id="p:305" class="idref" href="#p:305"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:306" class="idref" href="#n:306"><span class="id" title="binder">n</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>) (<a id="msg:307" class="idref" href="#msg:307"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:303"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:306"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:307"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:307"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:305"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:307"><span class="id" title="variable">msg</span></a> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:303"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:304"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:306"><span class="id" title="variable">n</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> <a class="idref" href="Giskard.precommit.html#n:306"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#p:305"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">n</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In_dec"><span class="id" title="abbreviation">In_dec</span></a> <a class="idref" href="Giskard.structures.html#message_eq_dec"><span class="id" title="definition">message_eq_dec</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">n0</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#out_message_change_tells_sender"><span class="id" title="lemma">out_message_change_tells_sender</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p0</span> <span class="id" title="var">msg0</span> <span class="id" title="var">lm0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;analysis&nbsp;on&nbsp;the&nbsp;transition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;all&nbsp;the&nbsp;cases&nbsp;that&nbsp;don't&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;In&nbsp;the&nbsp;cases&nbsp;that&nbsp;do&nbsp;send&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_view_eq</span> : <a class="idref" href="Giskard.local.html#view_valid"><span class="id" title="definition">view_valid</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>)) <span class="id" title="var">msg0</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_view</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">tauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">H_rest</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>; <span class="id" title="tactic">tauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_member_correct"><span class="id" title="lemma">is_member_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_part</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_part</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="PrepareBlock_sender_is_new_proposer_global" class="idref" href="#PrepareBlock_sender_is_new_proposer_global"><span class="id" title="lemma">PrepareBlock_sender_is_new_proposer_global</span></a> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:308" class="idref" href="#tr:308"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:309" class="idref" href="#i:309"><span class="id" title="binder">i</span></a> <a id="p:310" class="idref" href="#p:310"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:311" class="idref" href="#msg:311"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:308"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:311"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:311"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:310"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:311"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:308"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:309"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;<a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.precommit.html#msg:311"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:310"><span class="id" title="variable">p</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareBlock_sender_is_new_proposer_local"><span class="id" title="lemma">PrepareBlock_sender_is_new_proposer_local</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
All PrepareBlock messages sent in the same view have the same sender. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="PrepareBlock_sender_view_injective_global" class="idref" href="#PrepareBlock_sender_view_injective_global"><span class="id" title="lemma">PrepareBlock_sender_view_injective_global</span></a> :<br/>
&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:312" class="idref" href="#tr:312"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:313" class="idref" href="#i:313"><span class="id" title="binder">i</span></a> <a id="p:314" class="idref" href="#p:314"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:315" class="idref" href="#msg:315"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:312"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:315"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:315"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:314"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:315"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:312"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:313"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg':316" class="idref" href="#msg':316"><span class="id" title="binder">msg'</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg':316"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg':316"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:314"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg':316"><span class="id" title="variable">msg'</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:312"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:313"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.precommit.html#msg:315"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <a class="idref" href="Giskard.precommit.html#msg':316"><span class="id" title="variable">msg'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_type'</span> <span class="id" title="var">H_view'</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_proposer1</span> : <a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">p</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareBlock_sender_is_new_proposer_global"><span class="id" title="lemma">PrepareBlock_sender_is_new_proposer_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_proposer2</span> : <a class="idref" href="Giskard.structures.html#is_block_proposer"><span class="id" title="axiom">is_block_proposer</span></a> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg'</span>) <span class="id" title="var">p</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareBlock_sender_is_new_proposer_global"><span class="id" title="lemma">PrepareBlock_sender_is_new_proposer_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#is_new_proposer_unique"><span class="id" title="axiom">is_new_proposer_unique</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">p</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Any block labeled as the last block in a PrepareBlock message is higher
than any other block in a PrepareBlock message in the same view: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="last_block_highest_block_global" class="idref" href="#last_block_highest_block_global"><span class="id" title="lemma">last_block_highest_block_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span>(<a id="tr:317" class="idref" href="#tr:317"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>) (<a id="i:318" class="idref" href="#i:318"><span class="id" title="binder">i</span></a> <a id="p:319" class="idref" href="#p:319"><span class="id" title="binder">p</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="msg:320" class="idref" href="#msg:320"><span class="id" title="binder">msg</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:317"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:320"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:320"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:319"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:320"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:317"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:318"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_last"><span class="id" title="definition">b_last</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:320"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="msg':321" class="idref" href="#msg':321"><span class="id" title="binder">msg'</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>), <a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg':321"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#PrepareBlock"><span class="id" title="constructor">PrepareBlock</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg':321"><span class="id" title="variable">msg'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#p:319"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg':321"><span class="id" title="variable">msg'</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:317"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:318"><span class="id" title="variable">i</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:320"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg':321"><span class="id" title="variable">msg'</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_type</span> <span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_last</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_type'</span> <span class="id" title="var">H_view'</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg'</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareBlock_sender_view_injective_global"><span class="id" title="lemma">PrepareBlock_sender_view_injective_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_part</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>)))).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_refl"><span class="id" title="lemma">node_eqb_refl</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg'</span> (<a class="idref" href="Giskard.structures.html#out_messages"><span class="id" title="projection">out_messages</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg'</span>)))).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_refl"><span class="id" title="lemma">node_eqb_refl</span></a>. }  <br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#last_block_highest_block_sent"><span class="id" title="lemma">last_block_highest_block_sent</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">i</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Finally, we use the connection made above to show our goal: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="normal_trigger_message_highest_global" class="idref" href="#normal_trigger_message_highest_global"><span class="id" title="lemma">normal_trigger_message_highest_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:322" class="idref" href="#tr:322"><span class="id" title="binder">tr</span></a> <a id="i:323" class="idref" href="#i:323"><span class="id" title="binder">i</span></a> <a id="p:324" class="idref" href="#p:324"><span class="id" title="binder">p</span></a> <a id="msg:325" class="idref" href="#msg:325"><span class="id" title="binder">msg</span></a> <a id="h_max:326" class="idref" href="#h_max:326"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:322"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#normal_trigger_message_global"><span class="id" title="definition">normal_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:322"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:323"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:324"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:325"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:322"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:323"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:326"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:324"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:325"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:326"><span class="id" title="variable">h_max</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> [<span class="id" title="var">H_last</span> <span class="id" title="var">H_in</span>]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Obtaining&nbsp;the&nbsp;PrepareBlock&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#PrepareQC_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareQC_sent_means_PrepareBlock_sent_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_in</span> <span class="id" title="var">H_type</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> [<span class="id" title="var">H_type'</span> [<span class="id" title="var">H_view'</span> [<span class="id" title="var">H_block'</span> <span class="id" title="var">H_in'</span>]]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;(get_block&nbsp;msg)&nbsp;is&nbsp;the&nbsp;highest&nbsp;in&nbsp;the&nbsp;view&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#last_block_highest_block_global"><span class="id" title="lemma">last_block_highest_block_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_type'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_block'</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block'</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;the&nbsp;message&nbsp;we&nbsp;want&nbsp;to&nbsp;feed&nbsp;it&nbsp;is&nbsp;the&nbsp;max&nbsp;prepare&nbsp;height&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_max</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_exists</span> <span class="id" title="var">H_max</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_exists</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b</span> [<span class="id" title="var">H_prepare</span> <span class="id" title="var">H_height</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_means_PrepareVote_PrepareQC_exists_global"><span class="id" title="lemma">prepare_means_PrepareVote_PrepareQC_exists_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">H_view0</span> [<span class="id" title="var">H_block0</span> [<span class="id" title="var">H_type_left</span> | <span class="id" title="var">H_type_right</span>]]]]].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;Prepare&nbsp;message&nbsp;is&nbsp;a&nbsp;PrepareVote&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareVote_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareVote_sent_means_PrepareBlock_sent_global</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type_left</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type_left</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg0_pb</span> [<span class="id" title="var">H_type0_pb</span> [<span class="id" title="var">H_view0_pb</span> [<span class="id" title="var">H_block0_pb</span> <span class="id" title="var">H_in0_pb</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">msg0_pb</span> <span class="id" title="var">H_type0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_in0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_max</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_block0_pb</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareQC_sent_means_PrepareBlock_sent_global"><span class="id" title="lemma">PrepareQC_sent_means_PrepareBlock_sent_global</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type_right</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_type_right</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg0_pb</span> [<span class="id" title="var">H_type0_pb</span> [<span class="id" title="var">H_view0_pb</span> [<span class="id" title="var">H_block0_pb</span> <span class="id" title="var">H_in0_pb</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">msg0_pb</span> <span class="id" title="var">H_type0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_in0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_max</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_block0_pb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_block0_pb</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab48"></a><h3 class="section">Timeout trigger message contains highest or second highest block</h3>

<div class="paragraph"> </div>

 Next, we prove the height property for timeout trigger messages. 
<div class="paragraph"> </div>

 The proof in this case is slightly more complex. The timeout trigger message
is a ViewChangeQC message aggregated from quorum ViewChange messages, containing
the highest block computed from all the ViewChange messages. We call this block
the max height block. Let b' be the highest prepare stage block globally, meaning
that there exists at least one node n such that b' is in prepare stage locally. Let b'' be
the parent of b'. Because b' is in highest prepare stage globally, there must be at
least quorum nodes for whom b'' is in prepare stage locally. Because ViewChange messages
contain the locally highest prepare stage block, and the locally highest prepare stage
block is at least b'' for majority nodes, any quorum of ViewChange messages' max 
height block must be at least b''. 
<div class="paragraph"> </div>

 The global maximum prepare height is either the highest or second highest: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="is_max_prepare_height_in_view_disj_global" class="idref" href="#is_max_prepare_height_in_view_disj_global"><span class="id" title="lemma">is_max_prepare_height_in_view_disj_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:327" class="idref" href="#tr:327"><span class="id" title="binder">tr</span></a> <a id="i:328" class="idref" href="#i:328"><span class="id" title="binder">i</span></a> <a id="h:329" class="idref" href="#h:329"><span class="id" title="binder">h</span></a> <a id="p:330" class="idref" href="#p:330"><span class="id" title="binder">p</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:327"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:327"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:328"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h:329"><span class="id" title="variable">h</span></a> <a class="idref" href="Giskard.precommit.html#p:330"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="b:331" class="idref" href="#b:331"><span class="id" title="binder">b</span></a>, <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:327"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:328"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#b:331"><span class="id" title="variable">b</span></a> <a class="idref" href="Giskard.precommit.html#p:330"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:331"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h:329"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b:331"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.precommit.html#h:329"><span class="id" title="variable">h</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">h</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_highest</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Logic.Classical_Prop.html#classic"><span class="id" title="axiom">classic</span></a> (<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <span class="id" title="var">b</span>) <span class="id" title="var">p</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_yes</span> | <span class="id" title="var">H_no</span>].<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(b_height&nbsp;b)&nbsp;is&nbsp;the&nbsp;highest&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_highest</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_highest1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b1</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_height1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_yes</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_highest2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b2</span> [<span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_height2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest1</span> <span class="id" title="var">b2</span> <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest2</span> <span class="id" title="var">b1</span> <span class="id" title="var">H_prepare1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(b_height&nbsp;b)&nbsp;is&nbsp;not&nbsp;the&nbsp;highest&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_highest</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_highest1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prepare1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b1</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_height1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest1</span> <span class="id" title="var">b</span> <span class="id" title="var">H_prepare</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If there exists a ViewChangeQC message in the global broadcast message buffer,
then there must exist a specific quorum of ViewChange messages broadcast globally
from which it was aggregated: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="timeout_trigger_message_global_means_exists_ViewChange_quorum" class="idref" href="#timeout_trigger_message_global_means_exists_ViewChange_quorum"><span class="id" title="lemma">timeout_trigger_message_global_means_exists_ViewChange_quorum</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:332" class="idref" href="#tr:332"><span class="id" title="binder">tr</span></a> <a id="i:333" class="idref" href="#i:333"><span class="id" title="binder">i</span></a> <a id="p:334" class="idref" href="#p:334"><span class="id" title="binder">p</span></a> <a id="msg:335" class="idref" href="#msg:335"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:332"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;msg&nbsp;triggered&nbsp;the&nbsp;view&nbsp;change&nbsp;from&nbsp;p&nbsp;to&nbsp;(S&nbsp;p)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:332"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:333"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:334"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:335"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Then&nbsp;there&nbsp;must&nbsp;exist&nbsp;a&nbsp;list&nbsp;of&nbsp;ViewChange&nbsp;messages&nbsp;that&nbsp;are&nbsp;broadcast&nbsp;globally<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;view&nbsp;p,&nbsp;implicitly&nbsp;those&nbsp;that&nbsp;are&nbsp;processed&nbsp;by&nbsp;the&nbsp;new&nbsp;proposer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="lm:336" class="idref" href="#lm:336"><span class="id" title="binder">lm</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="msg:337" class="idref" href="#msg:337"><span class="id" title="binder">msg</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:337"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.precommit.html#lm:336"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:337"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg:338" class="idref" href="#msg:338"><span class="id" title="binder">msg</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg:338"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.precommit.html#p:334"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg:338"><span class="id" title="variable">msg</span></a>) <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:332"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:333"><span class="id" title="variable">i</span></a>)))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;That&nbsp;has&nbsp;reached&nbsp;quorum&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <a class="idref" href="Giskard.precommit.html#lm:336"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;That&nbsp;was&nbsp;used&nbsp;by&nbsp;the&nbsp;new&nbsp;proposer&nbsp;(identity&nbsp;irrelevant)&nbsp;to&nbsp;create&nbsp;the&nbsp;ViewChangeQC&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="n:339" class="idref" href="#n:339"><span class="id" title="binder">n</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:335"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <a class="idref" href="Giskard.precommit.html#n:339"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="Giskard.precommit.html#lm:336"><span class="id" title="variable">lm</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">i</span> <span class="id" title="var">IH_prot</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_init</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global_dec"><span class="id" title="definition">timeout_trigger_message_global_dec</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H_old</span> | <span class="id" title="var">H_new</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">spec</span> <span class="id" title="var">IH_prot</span> <span class="id" title="var">H_old</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IH_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">lm</span> [<span class="id" title="var">H_subset</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">lm</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in0</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_subset</span> <span class="id" title="var">msg0</span> <span class="id" title="var">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_subset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_messages_monotonic_step"><span class="id" title="lemma">global_messages_monotonic_step</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">IH_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">msg</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>))) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H_new</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> <span class="id" title="var">H_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prot_copy</span> := <span class="id" title="var">H_prot</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_prot</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_prot</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">n0</span> [<span class="id" title="var">H_in0</span> [<span class="id" title="var">p0</span> [<span class="id" title="var">msg0</span> [<span class="id" title="var">lm0</span> [<span class="id" title="var">H_step</span> <span class="id" title="var">H_deliver</span>]]]]]] | <span class="id" title="var">H_timeout</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;transition&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_deliver</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#in_app_iff"><span class="id" title="lemma">in_app_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_step_copy</span> := <span class="id" title="var">H_step</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_step</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_update</span> [<span class="id" title="var">H_out</span> <span class="id" title="var">H_rest</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_out</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in</span> | <span class="id" title="var">H_in</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.local.html#pending_PrepareVote_correct"><span class="id" title="lemma">pending_PrepareVote_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_type</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_quorum</span> : <a class="idref" href="Giskard.local.html#view_change_quorum_in_view"><span class="id" title="definition">view_change_quorum_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>) (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>))) <span class="id" title="tactic">by</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_quorum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="Giskard.local.html#processed_ViewChange_in_view"><span class="id" title="definition">processed_ViewChange_in_view</span></a> (<a class="idref" href="Giskard.local.html#process"><span class="id" title="definition">process</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>) <span class="id" title="var">msg0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n0</span>))); <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Proving&nbsp;the&nbsp;subset&nbsp;relation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_in'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_in'</span> <span class="id" title="var">H_rest'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#processed_means_sent_global"><span class="id" title="lemma">processed_means_sent_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_update</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in'</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_prop"><span class="id" title="lemma">andb_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_rest'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_rest'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type'</span> <span class="id" title="var">H_view'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#andb_true_intro"><span class="id" title="lemma">andb_true_intro</span></a>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_view</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#message_type_eqb_correct"><span class="id" title="lemma">message_type_eqb_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_type'</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_in</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;highest_block&nbsp;property&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">n0</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#highest_ViewChange_message"><span class="id" title="definition">highest_ViewChange_message</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#GenesisBlock_message"><span class="id" title="definition">GenesisBlock_message</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Giskard.global.html#protocol_trace_state_sane"><span class="id" title="lemma">protocol_trace_state_sane</span></a> <span class="id" title="var">H_prot_copy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_timeout</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The highest block of any quorum list of ViewChange messages is at least
maximum height minus one: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="at_least_second_highest" class="idref" href="#at_least_second_highest"><span class="id" title="definition">at_least_second_highest</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:340" class="idref" href="#tr:340"><span class="id" title="binder">tr</span></a> <a id="i:341" class="idref" href="#i:341"><span class="id" title="binder">i</span></a> <a id="h:342" class="idref" href="#h:342"><span class="id" title="binder">h</span></a> <a id="p:343" class="idref" href="#p:343"><span class="id" title="binder">p</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:340"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:340"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:341"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h:342"><span class="id" title="variable">h</span></a> <a class="idref" href="Giskard.precommit.html#p:343"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="lm:344" class="idref" href="#lm:344"><span class="id" title="binder">lm</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Subset&nbsp;of&nbsp;all&nbsp;ViewChange&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> <a id="msg:345" class="idref" href="#msg:345"><span class="id" title="binder">msg</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:345"><span class="id" title="variable">msg</span></a> <a class="idref" href="Giskard.precommit.html#lm:344"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#msg:345"><span class="id" title="variable">msg</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter"><span class="id" title="definition">filter</span></a> (<span class="id" title="keyword">fun</span> <a id="msg0:346" class="idref" href="#msg0:346"><span class="id" title="binder">msg0</span></a> : <a class="idref" href="Giskard.structures.html#message"><span class="id" title="record">message</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Giskard.structures.html#get_view"><span class="id" title="projection">get_view</span></a> <a class="idref" href="Giskard.precommit.html#msg0:346"><span class="id" title="variable">msg0</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="Giskard.precommit.html#p:343"><span class="id" title="variable">p</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="Giskard.structures.html#message_type_eqb"><span class="id" title="definition">message_type_eqb</span></a> (<a class="idref" href="Giskard.structures.html#get_message_type"><span class="id" title="projection">get_message_type</span></a> <a class="idref" href="Giskard.precommit.html#msg0:346"><span class="id" title="variable">msg0</span></a>) <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Giskard.precommit.html#tr:340"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:341"><span class="id" title="variable">i</span></a>)))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Quorum&nbsp;of&nbsp;ViewChange&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#quorum"><span class="id" title="definition">quorum</span></a> <a class="idref" href="Giskard.precommit.html#lm:344"><span class="id" title="variable">lm</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="n:347" class="idref" href="#n:347"><span class="id" title="binder">n</span></a>, <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> (<a class="idref" href="Giskard.local.html#highest_message_in_list"><span class="id" title="definition">highest_message_in_list</span></a> <a class="idref" href="Giskard.precommit.html#n:347"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#ViewChange"><span class="id" title="constructor">ViewChange</span></a> <a class="idref" href="Giskard.precommit.html#lm:344"><span class="id" title="variable">lm</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.precommit.html#h:342"><span class="id" title="variable">h</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>

<br/>
</div>

<div class="doc">
Establishing a relationship between the maximum prepare height and the height of the
timeout trigger message block towards the final statement below: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="timeout_trigger_message_at_least_second_highest_global" class="idref" href="#timeout_trigger_message_at_least_second_highest_global"><span class="id" title="lemma">timeout_trigger_message_at_least_second_highest_global</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#at_least_second_highest"><span class="id" title="definition">at_least_second_highest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:348" class="idref" href="#tr:348"><span class="id" title="binder">tr</span></a> <a id="i:349" class="idref" href="#i:349"><span class="id" title="binder">i</span></a> <a id="p:350" class="idref" href="#p:350"><span class="id" title="binder">p</span></a> <a id="msg:351" class="idref" href="#msg:351"><span class="id" title="binder">msg</span></a> <a id="h_max:352" class="idref" href="#h_max:352"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:348"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:348"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:349"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:350"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:351"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:348"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:349"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:352"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:350"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:351"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#73030c22bc0b1fa771c65aa5414c65f9"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:352"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_timeout</span> <span class="id" title="var">H_highest</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful2</span> := <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global_means_exists_ViewChange_quorum"><span class="id" title="lemma">timeout_trigger_message_global_means_exists_ViewChange_quorum</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful2</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_timeout</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">lm</span> [<span class="id" title="var">H_subset</span> [<span class="id" title="var">H_quorum</span> [<span class="id" title="var">n</span> <span class="id" title="var">H_highest_msg</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">h_max</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_highest</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">lm</span> <span class="id" title="var">H_subset</span> <span class="id" title="var">H_quorum</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_highest_msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We are now able to show that the block contained in the trigger message for
a view is either the highest block in the view, or the second highest block in the view: 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="timeout_trigger_message_highest_or_second_highest_global" class="idref" href="#timeout_trigger_message_highest_or_second_highest_global"><span class="id" title="lemma">timeout_trigger_message_highest_or_second_highest_global</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#at_least_second_highest"><span class="id" title="definition">at_least_second_highest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:353" class="idref" href="#tr:353"><span class="id" title="binder">tr</span></a> <a id="i:354" class="idref" href="#i:354"><span class="id" title="binder">i</span></a> <a id="p:355" class="idref" href="#p:355"><span class="id" title="binder">p</span></a> <a id="msg:356" class="idref" href="#msg:356"><span class="id" title="binder">msg</span></a> <a id="h_max:357" class="idref" href="#h_max:357"><span class="id" title="binder">h_max</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:353"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#timeout_trigger_message_global"><span class="id" title="definition">timeout_trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:353"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:354"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#p:355"><span class="id" title="variable">p</span></a> <a class="idref" href="Giskard.precommit.html#msg:356"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_global"><span class="id" title="definition">is_max_prepare_height_in_view_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:353"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:354"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#h_max:357"><span class="id" title="variable">h_max</span></a> <a class="idref" href="Giskard.precommit.html#p:355"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:356"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:357"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg:356"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.precommit.html#h_max:357"><span class="id" title="variable">h_max</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_timeout</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_disj_global"><span class="id" title="lemma">is_max_prepare_height_in_view_disj_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">h_max</span> <span class="id" title="var">p</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#trigger_message_block_prepare_stage_global"><span class="id" title="lemma">trigger_message_block_prepare_stage_global</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="tactic">right</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_highest</span> | <span class="id" title="var">H_second</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Now&nbsp;we&nbsp;need&nbsp;to&nbsp;show&nbsp;that&nbsp;it&nbsp;cannot&nbsp;be&nbsp;lower&nbsp;than&nbsp;h_max&nbsp;-&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;There&nbsp;is&nbsp;another&nbsp;pigeonhole&nbsp;principle&nbsp;argument&nbsp;embedded&nbsp;in&nbsp;here&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_at_least_second_highest_global"><span class="id" title="lemma">timeout_trigger_message_at_least_second_highest_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">p</span> <span class="id" title="var">msg</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_timeout</span> <span class="id" title="var">H_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab49"></a><h2 class="section">Global trigger message blocks increase with view</h2>

<div class="paragraph"> </div>

 Having established global trigger message blocks as both lower bounds and
higher bounds, the final critical fact we need to show is that the height of
trigger message blocks increases as view increases. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_past_step_exists_global" class="idref" href="#trigger_message_past_step_exists_global"><span class="id" title="lemma">trigger_message_past_step_exists_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:358" class="idref" href="#tr:358"><span class="id" title="binder">tr</span></a> <a id="i:359" class="idref" href="#i:359"><span class="id" title="binder">i</span></a> <a id="v:360" class="idref" href="#v:360"><span class="id" title="binder">v</span></a> <a id="msg:361" class="idref" href="#msg:361"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:358"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:358"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:359"><span class="id" title="variable">i</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#v:360"><span class="id" title="variable">v</span></a>) <a class="idref" href="Giskard.precommit.html#msg:361"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg':362" class="idref" href="#msg':362"><span class="id" title="binder">msg'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:358"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:359"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#v:360"><span class="id" title="variable">v</span></a> <a class="idref" href="Giskard.precommit.html#msg':362"><span class="id" title="variable">msg'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#past_view_exists_trigger_message_global"><span class="id" title="lemma">past_view_exists_trigger_message_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_left</span> | <span class="id" title="var">H_right</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">v</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_bound</span> := (<a class="idref" href="Giskard.precommit.html#out_message_view_bound"><span class="id" title="lemma">out_message_view_bound</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span> <span class="id" title="var">tr</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_left</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">v</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_bound</span> := (<a class="idref" href="Giskard.precommit.html#out_message_view_bound"><span class="id" title="lemma">out_message_view_bound</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span> <span class="id" title="var">tr</span> (<a class="idref" href="Giskard.structures.html#get_sender"><span class="id" title="projection">get_sender</span></a> <span class="id" title="var">msg</span>) <span class="id" title="var">i</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_bound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#global_local_out_if"><span class="id" title="lemma">global_local_out_if</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.global.html#participation_rights_global"><span class="id" title="lemma">participation_rights_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#filter_In"><span class="id" title="lemma">filter_In</span></a>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#node_eqb_correct"><span class="id" title="axiom">node_eqb_correct</span></a>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_right</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_type</span> [<span class="id" title="var">H_view</span> <span class="id" title="var">H_rest</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_past_exists_global" class="idref" href="#trigger_message_past_exists_global"><span class="id" title="lemma">trigger_message_past_exists_global</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:363" class="idref" href="#tr:363"><span class="id" title="binder">tr</span></a> <a id="i:364" class="idref" href="#i:364"><span class="id" title="binder">i</span></a> <a id="v:365" class="idref" href="#v:365"><span class="id" title="binder">v</span></a> <a id="msg:366" class="idref" href="#msg:366"><span class="id" title="binder">msg</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:363"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:363"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:364"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#v:365"><span class="id" title="variable">v</span></a> <a class="idref" href="Giskard.precommit.html#msg:366"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="v':367" class="idref" href="#v':367"><span class="id" title="binder">v'</span></a>, <a class="idref" href="Giskard.precommit.html#v':367"><span class="id" title="variable">v'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.precommit.html#v:365"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="msg':368" class="idref" href="#msg':368"><span class="id" title="binder">msg'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:363"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:364"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#v':367"><span class="id" title="variable">v'</span></a> <a class="idref" href="Giskard.precommit.html#msg':368"><span class="id" title="variable">msg'</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v</span> <span class="id" title="var">msg</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span> <span class="id" title="var">v_past</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">v</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">v</span> <span class="id" title="var">IHv</span>]; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H_past</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">v_past</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v_past</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">v</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="var">spec</span> <span class="id" title="var">IHv</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#trigger_message_past_step_exists_global"><span class="id" title="lemma">trigger_message_past_step_exists_global</span></a> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg'</span> <span class="id" title="var">H_trigger'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IHv</span> <span class="id" title="var">msg'</span> <span class="id" title="var">H_trigger'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IHv</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">exists</span> <span class="id" title="var">msg</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The proof pattern for this lemma is typical of many induction-based
proof: we first show the property for one step, then we show it by
induction for an arbitrary number of steps. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_view_morphism_step_global" class="idref" href="#trigger_message_view_morphism_step_global"><span class="id" title="lemma">trigger_message_view_morphism_step_global</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:369" class="idref" href="#tr:369"><span class="id" title="binder">tr</span></a> <a id="j:370" class="idref" href="#j:370"><span class="id" title="binder">j</span></a> <a id="v1:371" class="idref" href="#v1:371"><span class="id" title="binder">v1</span></a> <a id="msg1:372" class="idref" href="#msg1:372"><span class="id" title="binder">msg1</span></a> <a id="msg2:373" class="idref" href="#msg2:373"><span class="id" title="binder">msg2</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:369"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:369"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:370"><span class="id" title="variable">j</span></a> <a class="idref" href="Giskard.precommit.html#v1:371"><span class="id" title="variable">v1</span></a> <a class="idref" href="Giskard.precommit.html#msg1:372"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:369"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:370"><span class="id" title="variable">j</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="Giskard.precommit.html#v1:371"><span class="id" title="variable">v1</span></a>) <a class="idref" href="Giskard.precommit.html#msg2:373"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:372"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:373"><span class="id" title="variable">msg2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_useful1</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span> <span class="id" title="var">v1</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger1</span> <span class="id" title="var">H_trigger2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful1</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">j</span> <span class="id" title="var">msg1</span> <span class="id" title="var">v1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#trigger_message_block_prepare_stage_global"><span class="id" title="lemma">trigger_message_block_prepare_stage_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_PrepareBlock_sent_global"><span class="id" title="lemma">prepare_stage_in_view_means_PrepareBlock_sent_global</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_trigger2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">pb_msg2</span> [<span class="id" title="var">H_type2</span> [<span class="id" title="var">H_view2</span> [<span class="id" title="var">H_block2</span> <span class="id" title="var">H_sent2</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_view2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful1</span> <span class="id" title="var">H_trigger1</span> <span class="id" title="var">pb_msg2</span> <span class="id" title="var">H_type2</span> <span class="id" title="var">H_view2</span> <span class="id" title="var">H_sent2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_useful1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.lt_le_incl"><span class="id" title="lemma">Nat.lt_le_incl</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H_block2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#PrepareBlock_block_height_geq"><span class="id" title="lemma">PrepareBlock_block_height_geq</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="trigger_message_view_morphism_global" class="idref" href="#trigger_message_view_morphism_global"><span class="id" title="lemma">trigger_message_view_morphism_global</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="tr:374" class="idref" href="#tr:374"><span class="id" title="binder">tr</span></a> <a id="j:375" class="idref" href="#j:375"><span class="id" title="binder">j</span></a> <a id="v1:376" class="idref" href="#v1:376"><span class="id" title="binder">v1</span></a> <a id="v2:377" class="idref" href="#v2:377"><span class="id" title="binder">v2</span></a> <a id="msg1:378" class="idref" href="#msg1:378"><span class="id" title="binder">msg1</span></a> <a id="msg2:379" class="idref" href="#msg2:379"><span class="id" title="binder">msg2</span></a>, <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#v1:376"><span class="id" title="variable">v1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.precommit.html#v2:377"><span class="id" title="variable">v2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:375"><span class="id" title="variable">j</span></a> <a class="idref" href="Giskard.precommit.html#v1:376"><span class="id" title="variable">v1</span></a> <a class="idref" href="Giskard.precommit.html#msg1:378"><span class="id" title="variable">msg1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_global"><span class="id" title="definition">trigger_message_global</span></a> <a class="idref" href="Giskard.precommit.html#tr:374"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#j:375"><span class="id" title="variable">j</span></a> <a class="idref" href="Giskard.precommit.html#v2:377"><span class="id" title="variable">v2</span></a> <a class="idref" href="Giskard.precommit.html#msg2:379"><span class="id" title="variable">msg2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg1:378"><span class="id" title="variable">msg1</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <a class="idref" href="Giskard.precommit.html#msg2:379"><span class="id" title="variable">msg2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span> <span class="id" title="var">msg1</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_past</span> <span class="id" title="var">H_trigger1</span> <span class="id" title="var">H_trigger2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">msg2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">v2</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">v2</span> <span class="id" title="var">IHv2</span>]; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H_past</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v2</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#trigger_message_past_exists_global"><span class="id" title="lemma">trigger_message_past_exists_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">v2</span>) <span class="id" title="var">msg2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger2</span> <span class="id" title="var">v2</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg2'</span> <span class="id" title="var">H_trigger2'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">IHv2</span> <span class="id" title="var">H</span> <span class="id" title="var">msg2'</span> <span class="id" title="var">H_trigger2'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#trigger_message_view_morphism_step_global"><span class="id" title="lemma">trigger_message_view_morphism_step_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span> <span class="id" title="var">v2</span> <span class="id" title="var">msg2'</span> <span class="id" title="var">msg2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_trigger2'</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_trigger2</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHv2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#trigger_message_view_morphism_step_global"><span class="id" title="lemma">trigger_message_view_morphism_step_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">j</span> <span class="id" title="var">v2</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab50"></a><h2 class="section">Final cases of precommit stage height injectivity</h2>

<div class="paragraph"> </div>

 Finally, we show the case of the precommit stage height injectivity proof
when the parent and child block reach prepare stage in the same view. We extract
the two symmetric cases in which b1 and b2 reach prepare stage in v1 and v2, and v1 &lt;&gt; v2. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="precommit_now_height_injective_symmetric" class="idref" href="#precommit_now_height_injective_symmetric"><span class="id" title="lemma">precommit_now_height_injective_symmetric</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#exists_max_prepare_height_in_view_global"><span class="id" title="definition">exists_max_prepare_height_in_view_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#at_least_second_highest"><span class="id" title="definition">at_least_second_highest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:380" class="idref" href="#tr:380"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:380"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:381" class="idref" href="#i:381"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:382" class="idref" href="#n:382"><span class="id" title="binder">n</span></a> <a id="m:383" class="idref" href="#m:383"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:380"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:381"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:382"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:380"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:381"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#m:383"><span class="id" title="variable">m</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:382"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:383"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b1:384" class="idref" href="#b1:384"><span class="id" title="binder">b1</span></a> <a id="b2:385" class="idref" href="#b2:385"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:384"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:385"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:380"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:381"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:382"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:384"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:380"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:381"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:383"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:385"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:384"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:385"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">H_second</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">H_lt</span> <span class="id" title="var">H_part_n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_part_m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child1</span> [<span class="id" title="var">H_height1</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare_child1</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child2</span> [<span class="id" title="var">H_height2</span> [<span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_prepare_child2</span>]]].<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">m</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;b2&nbsp;must&nbsp;be&nbsp;higher&nbsp;than&nbsp;the&nbsp;trigger&nbsp;message&nbsp;in&nbsp;(v2&nbsp;-&nbsp;1),&nbsp;for&nbsp;view&nbsp;change&nbsp;from&nbsp;(v2&nbsp;-&nbsp;1)&nbsp;to&nbsp;v2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_useful</span> := <a class="idref" href="Giskard.precommit.html#past_view_trigger_message_lowest_block_global"><span class="id" title="lemma">past_view_trigger_message_lowest_block_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">m</span> (<span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Obtaining&nbsp;the&nbsp;trigger&nbsp;message&nbsp;in&nbsp;(v2&nbsp;-&nbsp;1)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_trigger</span> := <a class="idref" href="Giskard.precommit.html#past_view_exists_trigger_message_global"><span class="id" title="lemma">past_view_exists_trigger_message_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_trigger</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part_m</span> (<span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_trigger</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg_v2</span> <span class="id" title="var">H_trigger_v2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">msg_v2</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_part_m</span> <span class="id" title="var">H_trigger_v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1)) <span class="id" title="keyword">with</span> <span class="id" title="var">v2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_useful</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span> <span class="id" title="var">b2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.local.html#prepare_stage"><span class="id" title="definition">prepare_stage</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_prepare2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;have&nbsp;established&nbsp;that&nbsp;b2&nbsp;is&nbsp;higher&nbsp;than&nbsp;the&nbsp;trigger&nbsp;message&nbsp;for&nbsp;(v2&nbsp;-&nbsp;1)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;to&nbsp;establish&nbsp;that&nbsp;b1&nbsp;is&nbsp;lower&nbsp;than&nbsp;the&nbsp;trigger&nbsp;message&nbsp;for&nbsp;v1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Obtaining&nbsp;the&nbsp;trigger&nbsp;message&nbsp;for&nbsp;(S&nbsp;v1)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_trigger2</span> := <a class="idref" href="Giskard.precommit.html#past_view_exists_trigger_message_global"><span class="id" title="lemma">past_view_exists_trigger_message_global</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_trigger2</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">m</span> <span class="id" title="var">i</span> <span class="id" title="var">H_part_m</span> <span class="id" title="var">v1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_trigger2</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">msg_v1</span> <span class="id" title="var">H_trigger1</span>].<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Obtaining&nbsp;the&nbsp;highest&nbsp;prepare&nbsp;height&nbsp;for&nbsp;v1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v1</span> <span class="id" title="var">H_prot</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_useful3</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Showing&nbsp;that&nbsp;a&nbsp;global&nbsp;prepare&nbsp;stage&nbsp;block&nbsp;exists&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">b1</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_useful3</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">h_max</span> <span class="id" title="var">H_highest_v1</span>].<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;want&nbsp;to&nbsp;say&nbsp;that&nbsp;msg_v1&nbsp;&lt;=&nbsp;msg_v2&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg_v1</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg_v2</span>))<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#trigger_message_view_morphism_global"><span class="id" title="lemma">trigger_message_view_morphism_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v1</span> (<span class="id" title="var">v2</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a>1); <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>; <span class="id" title="var">lia</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Next&nbsp;we&nbsp;want&nbsp;to&nbsp;say&nbsp;that&nbsp;b_height&nbsp;b1&nbsp;&lt;&nbsp;b_height&nbsp;(get_block&nbsp;msg_v1)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_prepare1_global</span> : <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_global"><span class="id" title="definition">prepare_stage_in_view_global</span></a> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">b1</span> <span class="id" title="var">v1</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>. } <br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <span class="id" title="var">b1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> (<a class="idref" href="Giskard.structures.html#get_block"><span class="id" title="projection">get_block</span></a> <span class="id" title="var">msg_v1</span>)).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">assert</span> (<span class="id" title="var">H_disj</span> := <a class="idref" href="Giskard.precommit.html#is_max_prepare_height_in_view_disj_global"><span class="id" title="lemma">is_max_prepare_height_in_view_disj_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_disj</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">h_max</span> <span class="id" title="var">v1</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_highest_v1</span> <span class="id" title="var">b1</span> <span class="id" title="var">H_prepare1_global</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_disj</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_false</span> | <span class="id" title="var">H_true</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_highest_v1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H_highest_v1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest_v1</span> <span class="id" title="var">b_child1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest_v1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#prepare_stage_in_view_means_prepare_stage_in_view_global"><span class="id" title="lemma">prepare_stage_in_view_means_prepare_stage_in_view_global</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <span class="id" title="var">b_child1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <span class="id" title="var">b1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_height1</span>. <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.structures.html#parent_block_height"><span class="id" title="axiom">parent_block_height</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H_trigger1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_normal1</span> | <span class="id" title="var">H_timeout1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;normal&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_highest</span> := <a class="idref" href="Giskard.precommit.html#normal_trigger_message_highest_global"><span class="id" title="lemma">normal_trigger_message_highest_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_highest</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v1</span> <span class="id" title="var">msg_v1</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_normal1</span> <span class="id" title="var">H_highest_v1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;timeout&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H_second'</span> := <a class="idref" href="Giskard.precommit.html#timeout_trigger_message_highest_or_second_highest_global"><span class="id" title="lemma">timeout_trigger_message_highest_or_second_highest_global</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec</span> <span class="id" title="var">H_second'</span> <span class="id" title="var">H_second</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">v1</span> <span class="id" title="var">msg_v1</span> <span class="id" title="var">h_max</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">H_timeout1</span>. <span class="id" title="var">spec</span> <span class="id" title="var">H_second'</span> <span class="id" title="var">H_highest_v1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Middle case. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="precommit_now_height_injective_middle" class="idref" href="#precommit_now_height_injective_middle"><span class="id" title="definition">precommit_now_height_injective_middle</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:386" class="idref" href="#tr:386"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:386"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:387" class="idref" href="#i:387"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:388" class="idref" href="#n:388"><span class="id" title="binder">n</span></a> <a id="m:389" class="idref" href="#m:389"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:386"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:387"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#n:388"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Giskard.precommit.html#tr:386"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:387"><span class="id" title="variable">i</span></a>) <a class="idref" href="Giskard.precommit.html#m:389"><span class="id" title="variable">m</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:388"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:389"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b1:390" class="idref" href="#b1:390"><span class="id" title="binder">b1</span></a> <a id="b2:391" class="idref" href="#b2:391"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:390"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:391"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:386"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:387"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:388"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:390"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:386"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:387"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:389"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:391"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:390"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:391"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>

<br/>
</div>

<div class="doc">
We use the helper lemma above to discharge two cases in the final
proof, and we use same view prepare stage height injectivity to discharge
the middle case, in which v1 = v2. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="precommit_now_height_injective" class="idref" href="#precommit_now_height_injective"><span class="id" title="lemma">precommit_now_height_injective</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#exists_max_prepare_height_in_view_global"><span class="id" title="definition">exists_max_prepare_height_in_view_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#at_least_second_highest"><span class="id" title="definition">at_least_second_highest</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#trigger_message_next_view_PrepareBlock_same_block_global"><span class="id" title="definition">trigger_message_next_view_PrepareBlock_same_block_global</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_now_height_injective_middle"><span class="id" title="definition">precommit_now_height_injective_middle</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="tr:392" class="idref" href="#tr:392"><span class="id" title="binder">tr</span></a> : <a class="idref" href="Giskard.global.html#GTrace"><span class="id" title="definition">GTrace</span></a>), <a class="idref" href="Giskard.global.html#protocol_trace"><span class="id" title="definition">protocol_trace</span></a> <a class="idref" href="Giskard.precommit.html#tr:392"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="i:393" class="idref" href="#i:393"><span class="id" title="binder">i</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<a id="n:394" class="idref" href="#n:394"><span class="id" title="binder">n</span></a> <a id="m:395" class="idref" href="#m:395"><span class="id" title="binder">m</span></a> : <a class="idref" href="Giskard.structures.html#node"><span class="id" title="axiom">node</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#n:394"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <a class="idref" href="Giskard.precommit.html#m:395"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.structures.html#participants"><span class="id" title="axiom">participants</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="b1:396" class="idref" href="#b1:396"><span class="id" title="binder">b1</span></a> <a id="b2:397" class="idref" href="#b2:397"><span class="id" title="binder">b2</span></a> : <a class="idref" href="Giskard.structures.html#block"><span class="id" title="axiom">block</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#b1:396"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="Giskard.precommit.html#b2:397"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:392"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:393"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#n:394"><span class="id" title="variable">n</span></a> <a class="idref" href="Giskard.precommit.html#b1:396"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.precommit.html#precommit_stage_now"><span class="id" title="definition">precommit_stage_now</span></a> <a class="idref" href="Giskard.precommit.html#tr:392"><span class="id" title="variable">tr</span></a> <a class="idref" href="Giskard.precommit.html#i:393"><span class="id" title="variable">i</span></a> <a class="idref" href="Giskard.precommit.html#m:395"><span class="id" title="variable">m</span></a> <a class="idref" href="Giskard.precommit.html#b2:397"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b1:396"><span class="id" title="variable">b1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Giskard.structures.html#b_height"><span class="id" title="axiom">b_height</span></a> <a class="idref" href="Giskard.precommit.html#b2:397"><span class="id" title="variable">b2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_max</span> <span class="id" title="var">H_second</span> <span class="id" title="var">H_ass</span> <span class="id" title="var">H_mid</span> <span class="id" title="var">tr</span> <span class="id" title="var">H_prot</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H_part_n</span> <span class="id" title="var">H_part_m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> <span class="id" title="var">H_neq</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">m</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">v2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_lt</span> | [<span class="id" title="var">H_eq</span> | <span class="id" title="var">H_gt</span>]].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#precommit_now_height_injective_symmetric"><span class="id" title="lemma">precommit_now_height_injective_symmetric</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_mid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H_mid</span> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <span class="id" title="var">v2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">v1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 1) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H_gt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H_lt</span> | [<span class="id" title="var">H_eq1</span> | <span class="id" title="var">H_eq2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">b2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <span class="id" title="var">b1</span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#not_eq_sym"><span class="id" title="lemma">not_eq_sym</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_neq</span>; <span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.precommit.html#precommit_now_height_injective_symmetric"><span class="id" title="lemma">precommit_now_height_injective_symmetric</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">b2</span> <span class="id" title="var">b1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Giskard.prepare.html#prepare_stage_same_view_height_injective"><span class="id" title="lemma">prepare_stage_same_view_height_injective</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> (<a class="idref" href="Giskard.structures.html#node_view"><span class="id" title="projection">node_view</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">tr</span> <span class="id" title="var">i</span>) <span class="id" title="var">n</span>)); <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child1</span> [<span class="id" title="var">H_height1</span> [<span class="id" title="var">H_prepare1</span> <span class="id" title="var">H_prepare_child1</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H_precommit2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b_child2</span> [<span class="id" title="var">H_height2</span> [<span class="id" title="var">H_prepare2</span> <span class="id" title="var">H_prepare_child2</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H_eq1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Giskard.precommit.html#precommit_now_height_injective_middle"><span class="id" title="definition">precommit_now_height_injective_middle</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_mid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">b2</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <span class="id" title="var">b1</span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#not_eq_sym"><span class="id" title="lemma">not_eq_sym</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H_neq</span>; <span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H_height</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H_mid</span> <span class="id" title="keyword">with</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">b2</span> <span class="id" title="var">b1</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr">coqdoc</a> and improved with <a href="https://github.com/palmskog/coqdocjs">CoqdocJS</a> as adapted for <a href="https://github.com/coq-community">coq-community</a>
</div>
</div>
</body>

</html>
