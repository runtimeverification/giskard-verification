<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>global.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-windowed alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.16.0+0.16.2. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Coq <span class="kn">Require Import</span> Arith Bool List Lia.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Giskard <span class="kn">Require Import</span> lib structures local.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Import</span> ListNotations.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Set Implicit Arguments</span>.</span></span></pre><div class="doc">
<a id="lab1"></a><h1 class="section">Global state operations, transitions and properties</h1>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
Global state transitions are responsible for modeling network responsibilities:
message broadcasting and timekeeping. Global states can be viewed as a snapshot of
all local states, paired with a global message buffer which records all messages sent
by all participating nodes up to that point in the protocol's execution. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
<a id="lab2"></a><h2 class="section">Global state definitions</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
A global state is defined as a pair containing:
<ul class="doclist">
<li> a mapping from node identifier to its local state, and

</li>
<li> a list of messages containing all broadcasted messages thus far.

</li>
</ul>
<div class="paragraph"> </div>

It is equipped with a property that the mapping works as intended. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">GState</span> : <span class="kt">Type</span> := (node -&gt; NState) * list message.</span></span></pre><div class="doc">
The initial global state is defined as the collection of initial local
states, paired with an empty message buffer. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">GState_init</span> : GState :=
  (<span class="kr">fun</span> (<span class="nv">n</span> : node) =&gt; NState_init n, []).</span></span></pre><div class="doc">
<a id="lab3"></a><h2 class="section">Global state transitions</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
In order to define protocol-following global state transitions,
we first define an operation which does two things:
<ul class="doclist">
<li> broadcasts outgoing messages from the transitioning node to the remaining nodes, and

</li>
<li> records outgoing messages in the global message buffer.

</li>
</ul>
<div class="paragraph"> </div>

We adopt the convention that nodes do not send messages to themselves.
This design choice is orthogonal to safety proofs because we do not
reason about the number of participants required to reach a quorum. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">broadcast_messages</span> (<span class="nv">g</span> : GState) (<span class="nv">s1</span> <span class="nv">s2</span> : NState) (<span class="nv">lm</span> : list message) : GState :=
  (<span class="kr">fun</span> (<span class="nv">n</span> : node) =&gt; <span class="kr">if</span> node_eqb n (node_id s1)
                  <span class="kr">then</span> s2 
                  <span class="kr">else</span>
                    (<span class="kr">if</span> is_member n participants
                     <span class="kr">then</span> add_plural (fst g n) lm
                     <span class="kr">else</span> (fst g n)),
                  lm ++ (snd g)).</span><span class="alectryon-wsp"> </span></span></pre><div class="doc">
Protocol-following global state transitions are defined as a binary relation
on pre-state and post-state, in which one participating node makes a protocol-following
local state transition, and the network broadcasts and records its outgoing messages
to the other participating nodes. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">GState_step</span> : GState -&gt; GState -&gt; <span class="kt">Prop</span> :=
| GState_step_process :
   <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">process</span> : NState_transition_type)
     (<span class="nv">msg</span> : message) (<span class="nv">lm</span> : list message) (<span class="nv">g</span> <span class="nv">g&#39;</span> : GState),
      In n participants -&gt;
      get_transition process (fst g n) msg (fst g&#39; n) lm -&gt;
      g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm -&gt;
      GState_step g g&#39;
| GState_step_timeout :
    <span class="kr">forall</span> (<span class="nv">g</span> <span class="nv">g&#39;</span> : GState),
      g&#39; = ((<span class="kr">fun</span> <span class="nv">n</span> =&gt; <span class="kr">if</span> is_member n participants
        <span class="kr">then</span> flip_timeout (fst g n) <span class="kr">else</span> fst g n), snd g) -&gt;
      GState_step g g&#39;.</span></span></pre><div class="doc">
More convenient representation of the global transition relation for reasoning. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">GState_transition</span> (<span class="nv">g</span> <span class="nv">g&#39;</span> : GState) : <span class="kt">Prop</span> :=
  (<span class="kr">exists</span> (<span class="nv">n</span> : node),
      In n participants /\ 
      <span class="kr">exists</span> (<span class="nv">process</span> : NState_transition_type)
        (<span class="nv">msg</span> : message)
        (<span class="nv">lm</span> : list message),
        (get_transition process) (fst g n) msg (fst g&#39; n) lm /\
        g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm) \/
  g&#39; = ((<span class="kr">fun</span> <span class="nv">n</span> =&gt; <span class="kr">if</span> is_member n participants
              <span class="kr">then</span> flip_timeout (fst g n)
              <span class="kr">else</span> fst g n), snd g).</span></span></pre><div class="doc">
The two global transition relation definitions are equivalent. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk0"><span class="kn">Lemma</span> <span class="nf">GState_step_transition</span> :
 <span class="kr">forall</span> <span class="nv">g</span> <span class="nv">g&#39;</span>, GState_step g g&#39; &lt;-&gt; GState_transition g g&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">g</span> <span class="nv">g&#39;</span> : GState,
GState_step g g&#39; &lt;-&gt; GState_transition g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">g</span> <span class="nv">g&#39;</span> : GState,
GState_step g g&#39; &lt;-&gt; GState_transition g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2"><span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39; -&gt; GState_transition g g&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br></div><label class="goal-separator" for="global-v-chk3"><hr></label><div class="goal-conclusion">GState_transition g g&#39; -&gt; GState_step g g&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39; -&gt; GState_transition g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5"><span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6"><span class="nb">inversion</span> Htr; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n) msg (fst g&#39; n) lm</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition g g&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><label class="goal-separator" for="global-v-chk7"><hr></label><div class="goal-conclusion">GState_transition g
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n, snd g)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n) msg (fst g&#39; n) lm</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk9"><span class="nb">left</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n) msg (fst g&#39; n) lm</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) 
   (<span class="nv">msg</span> : message) (<span class="nv">lm</span> : list message),
     get_transition process 
       (fst g n) msg (fst g&#39; n) lm /\
     g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka"><span class="kr">exists</span> <span class="nv">n</span>; <span class="nb">split</span>; [<span class="bp">assumption</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n) msg (fst g&#39; n) lm</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span>
  (<span class="nv">process</span> : NState_transition_type) 
(<span class="nv">msg</span> : message) (<span class="nv">lm</span> : list message),
  get_transition process (fst g n) msg (fst g&#39; n) lm /\
  g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb"><span class="kr">exists</span> <span class="nv">process</span>, msg, lm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g g&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n) msg (fst g&#39; n) lm</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_transition process (fst g n) msg (fst g&#39; n) lm /\
g&#39; = broadcast_messages g (fst g n) (fst g&#39; n) lm</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_step g
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition g
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n, snd g)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">right</span>; <span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition g g&#39; -&gt; GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke"><span class="nb">intro</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf"><span class="nb">inversion</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) 
   (<span class="nv">msg</span> : message) (<span class="nv">lm</span> : list message),
     get_transition process 
       (fst g n) msg (fst g&#39; n) lm /\
     g&#39; =
     broadcast_messages g (fst g n) (fst g&#39; n) lm)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk10" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><label class="goal-separator" for="global-v-chk10"><hr></label><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) 
   (<span class="nv">msg</span> : message) (<span class="nv">lm</span> : list message),
     get_transition process 
       (fst g n) msg (fst g&#39; n) lm /\
     g&#39; =
     broadcast_messages g (fst g n) (fst g&#39; n) lm)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12"><span class="nb">destruct</span> H; <span class="nb">destruct</span> H; <span class="nb">destruct</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In x participants</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> (<span class="nv">msg</span> : message) 
(<span class="nv">lm</span> : list message),
  get_transition x0 (fst g x) msg (fst g&#39; x) lm /\
  g&#39; =
  broadcast_messages g (fst g x) (fst g&#39; x) lm</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13"><span class="nb">destruct</span> H0; <span class="nb">destruct</span> H0; <span class="nb">destruct</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In x participants</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_transition x0 (fst g x) x1 (fst g&#39; x) x2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; = broadcast_messages g (fst g x) (fst g&#39; x) x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eapply</span> GState_step_process; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_step g g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk15"><span class="nb">apply</span> GState_step_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g, g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">GState_sane</span> (<span class="nv">g</span> : GState) : <span class="kt">Prop</span> := <span class="kr">forall</span> <span class="nv">n</span>, node_id ((fst g) n) = n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk16"><span class="kn">Lemma</span> <span class="nf">GState_init_sane</span> : GState_sane GState_init.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane GState_init</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18"><span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst GState_init n) = n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19"><span class="kn">Lemma</span> <span class="nf">GState_sane_transition</span> : <span class="kr">forall</span> <span class="nv">g</span>, GState_sane g -&gt; <span class="kr">forall</span> <span class="nv">g&#39;</span>, GState_transition g g&#39; -&gt; GState_sane g&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">g</span> : GState,
GState_sane g -&gt;
<span class="kr">forall</span> <span class="nv">g&#39;</span> : GState,
GState_transition g g&#39; -&gt; GState_sane g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">g</span> : GState,
GState_sane g -&gt;
<span class="kr">forall</span> <span class="nv">g&#39;</span> : GState,
GState_transition g g&#39; -&gt; GState_sane g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>GState_transition g g&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c"><span class="nb">inversion</span> H0; <span class="nb">clear</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) (<span class="nv">msg</span> : message) 
   (<span class="nv">lm</span> : list message),
     get_transition process (fst g n) msg
       (fst g&#39; n) lm /\
     g&#39; =
     broadcast_messages g (fst g n) (fst g&#39; n) lm)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane g&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d"><hr></label><div class="goal-conclusion">GState_sane g&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) (<span class="nv">msg</span> : message) 
   (<span class="nv">lm</span> : list message),
     get_transition process (fst g n) msg
       (fst g&#39; n) lm /\
     g&#39; =
     broadcast_messages g (fst g n) (fst g&#39; n) lm)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f"><span class="nb">intro</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">n</span> : node,
  In n participants /\
  (<span class="kr">exists</span>
     (<span class="nv">process</span> : NState_transition_type) (<span class="nv">msg</span> : message) 
   (<span class="nv">lm</span> : list message),
     get_transition process (fst g n) msg
       (fst g&#39; n) lm /\
     g&#39; =
     broadcast_messages g (fst g n) (fst g&#39; n) lm)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20"><span class="nb">destruct</span> H1 <span class="kr">as</span> [n&#39; [Hin [process [msg [lm [Hpr Hg&#39;]]]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>Hg'</var><span class="hyp-type"><b>: </b><span>g&#39; =
broadcast_messages g (fst g n&#39;) (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21"><span class="nb">rewrite</span> Hg&#39;; <span class="nb">clear</span> Hg&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id
  (fst
     (broadcast_messages g (fst g n&#39;) (fst g&#39; n&#39;) lm)
     n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id
  (<span class="kr">if</span> node_eqb n (node_id (fst g n&#39;))
   <span class="kr">then</span> fst g&#39; n&#39;
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst g n) lm
    <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23"><span class="nb">case_eq</span> (node_eqb n (node_id (fst g n&#39;))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_eqb n (node_id (fst g n&#39;)) = true -&gt;
node_id (fst g&#39; n&#39;) = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk24" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><label class="goal-separator" for="global-v-chk24"><hr></label><div class="goal-conclusion">node_eqb n (node_id (fst g n&#39;)) = false -&gt;
node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_eqb n (node_id (fst g n&#39;)) = true -&gt;
node_id (fst g&#39; n&#39;) = n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26"><span class="nb">rewrite</span> node_eqb_correct; <span class="nb">intro</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n&#39;) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27"><span class="nb">rewrite</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n&#39;) = node_id (fst g n&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28"><span class="nb">unfold</span> get_transition <span class="kr">in</span> Hpr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span><span class="kr">match</span> process <span class="kr">with</span>
| propose_block_init_type =&gt; propose_block_init
| discard_view_invalid_type =&gt;
    discard_view_invalid
| process_PrepareBlock_duplicate_type =&gt;
    process_PrepareBlock_duplicate
| process_PrepareVote_vote_type =&gt;
    process_PrepareVote_vote
| process_PrepareVote_wait_type =&gt;
    process_PrepareVote_wait
| process_PrepareQC_last_block_new_proposer_type =&gt;
    process_PrepareQC_last_block_new_proposer
| process_PrepareQC_last_block_type =&gt;
    process_PrepareQC_last_block
| process_PrepareQC_non_last_block_type =&gt;
    process_PrepareQC_non_last_block
| process_ViewChange_quorum_new_proposer_type =&gt;
    process_ViewChange_quorum_new_proposer
| process_ViewChange_pre_quorum_type =&gt;
    process_ViewChange_pre_quorum
| process_ViewChangeQC_single_type =&gt;
    process_ViewChangeQC_single
| process_PrepareBlock_malicious_vote_type =&gt;
    process_PrepareBlock_malicious_vote
| _ =&gt; process_PrepareBlock_pending_vote
<span class="kr">end</span> (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n&#39;) = node_id (fst g n&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk29"><span class="nb">unfold</span>
      propose_block_init,
      discard_view_invalid,
      process_PrepareBlock_duplicate,
      process_PrepareVote_vote,
      process_PrepareVote_wait,
      process_PrepareQC_last_block_new_proposer,
      process_PrepareQC_last_block,
      process_PrepareQC_non_last_block,
      process_ViewChange_quorum_new_proposer,
      process_ViewChange_pre_quorum,
      process_ViewChangeQC_single,
      process_PrepareBlock_malicious_vote,
      process_PrepareBlock_pending_vote <span class="kr">in</span> Hpr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span><span class="kr">match</span> process <span class="kr">with</span>
| propose_block_init_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">_</span> : message) 
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    record_plural s
      (make_PrepareBlocks s
         (GenesisBlock_message s)) /\
    lm =
    make_PrepareBlocks s
      (GenesisBlock_message s) /\
    s = NState_init (node_id s) /\
    honest_node (node_id s) /\
    is_block_proposer (node_id s) <span class="mi">0</span> /\
    <span class="kp">timeout</span> s = false
| discard_view_invalid_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = discard s msg /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    ~ view_valid s msg
| process_PrepareBlock_duplicate_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = discard s msg /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareBlock /\
    view_valid s msg /\
    <span class="kp">timeout</span> s = false /\
    exists_same_height_PrepareBlock s
      (get_block msg)
| process_PrepareVote_vote_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    local.process
      (record_plural s
         (make_PrepareQC s msg
          :: pending_PrepareVote s msg)) msg /\
    lm =
    make_PrepareQC s msg
    :: pending_PrepareVote s msg /\
    honest_node (node_id s) /\
    received s msg /\
    get_message_type msg = PrepareVote /\
    view_valid s msg /\
    <span class="kp">timeout</span> s = false /\
    ~ exists_same_height_block s (get_block msg) /\
    vote_quorum_in_view 
      (local.process s msg) 
      (get_view msg) (get_block msg)
| process_PrepareVote_wait_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = local.process s msg /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareVote /\
    view_valid s msg /\
    <span class="kp">timeout</span> s = false /\
    ~
    prepare_stage (local.process s msg)
      (get_block msg)
| process_PrepareQC_last_block_new_proposer_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    record_plural
      (increment_view (local.process s msg))
      (make_PrepareBlocks
         (increment_view (local.process s msg))
         msg) /\
    lm =
    make_PrepareBlocks
      (increment_view (local.process s msg)) msg /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareQC /\
    view_valid s msg /\
    last_block (get_block msg) /\
    is_block_proposer (node_id s)
      (S (node_view s))
| process_PrepareQC_last_block_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = increment_view (local.process s msg) /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareQC /\
    view_valid s msg /\
    last_block (get_block msg) /\
    ~
    is_block_proposer (node_id s)
      (S (node_view s))
| process_PrepareQC_non_last_block_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    local.process
      (record_plural s
         (pending_PrepareVote s msg)) msg /\
    lm = pending_PrepareVote s msg /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareQC /\
    view_valid s msg /\
    <span class="kp">timeout</span> s = false /\
    ~ last_block (get_block msg)
| process_ViewChange_quorum_new_proposer_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    record_plural
      (increment_view
         (local.process 
            (local.process s msg)
            {|
              get_message_type := PrepareQC;
              get_view := get_view msg;
              get_sender := get_sender msg;
              get_block :=
                get_block
                  (highest_ViewChange_message
                     (local.process s msg));
              get_piggyback_block :=
                GenesisBlock
            |}))
      ({|
         get_message_type := PrepareQC;
         get_view := node_view s;
         get_sender := node_id s;
         get_block :=
           get_block
             (highest_ViewChange_message
                (local.process s msg));
         get_piggyback_block := GenesisBlock
       |}
       :: make_ViewChangeQC s
            (highest_ViewChange_message
               (local.process s msg))
          :: make_PrepareBlocks
               (increment_view s)
               (highest_ViewChange_message
                  (local.process s msg))) /\
    lm =
    {|
      get_message_type := PrepareQC;
      get_view := node_view s;
      get_sender := node_id s;
      get_block :=
        get_block
          (highest_ViewChange_message
             (local.process s msg));
      get_piggyback_block := GenesisBlock
    |}
    :: make_ViewChangeQC s
         (highest_ViewChange_message
            (local.process s msg))
       :: make_PrepareBlocks 
            (increment_view s)
            (highest_ViewChange_message
               (local.process s msg)) /\
    received s msg /\
    received s
      {|
        get_message_type := PrepareQC;
        get_view := get_view msg;
        get_sender := get_sender msg;
        get_block :=
          get_block
            (highest_ViewChange_message
               (local.process s msg));
        get_piggyback_block := GenesisBlock
      |} /\
    honest_node (node_id s) /\
    get_message_type msg = ViewChange /\
    view_valid s msg /\
    view_change_quorum_in_view
      (local.process s msg) 
      (node_view s) /\
    is_block_proposer (node_id s)
      (S (node_view s))
| process_ViewChange_pre_quorum_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = local.process s msg /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = ViewChange /\
    view_valid s msg /\
    ~
    view_change_quorum_in_view
      (local.process s msg) 
      (node_view s)
| process_ViewChangeQC_single_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    increment_view
      (local.process
         (local.process s
            {|
              get_message_type := PrepareQC;
              get_view := node_view s;
              get_sender := get_sender msg;
              get_block := get_block msg;
              get_piggyback_block :=
                GenesisBlock
            |}) msg) /\
    lm = [] /\
    received s msg /\
    received s
      {|
        get_message_type := PrepareQC;
        get_view := node_view s;
        get_sender := get_sender msg;
        get_block := get_block msg;
        get_piggyback_block := GenesisBlock
      |} /\
    honest_node (node_id s) /\
    get_message_type msg = ViewChangeQC /\
    view_valid s msg
| process_PrepareBlock_malicious_vote_type =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; =
    record_plural (local.process s msg)
      (pending_PrepareVote s msg) /\
    lm = pending_PrepareVote s msg /\
    received s msg /\
    ~ honest_node (node_id s) /\
    get_message_type msg = PrepareBlock /\
    view_valid s msg /\
    exists_same_height_block s (get_block msg)
| _ =&gt;
    <span class="kr">fun</span> (<span class="nv">s</span> : NState) (<span class="nv">msg</span> : message)
      (<span class="nv">s&#39;</span> : NState) (<span class="nv">lm</span> : list message) =&gt;
    s&#39; = local.process s msg /\
    lm = [] /\
    received s msg /\
    honest_node (node_id s) /\
    get_message_type msg = PrepareBlock /\
    view_valid s msg /\
    <span class="kp">timeout</span> s = false /\
    ~
    exists_same_height_PrepareBlock s
      (get_block msg) /\
    ~
    prepare_stage s (parent_of (get_block msg))
<span class="kr">end</span> (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id (fst g&#39; n&#39;) = node_id (fst g n&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> process; <span class="nb">decompose record</span> Hpr; <span class="nb">rewrite</span> H0; <span class="nb">simpl</span>; <span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_eqb n (node_id (fst g n&#39;)) = false -&gt;
node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b"><span class="nb">case</span> (node_eq_dec n (node_id (fst g n&#39;))); [<span class="nb">intro</span> Heq;<span class="nb">apply</span> node_eqb_correct <span class="kr">in</span> Heq; <span class="bp">congruence</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt;&gt; node_id (fst g n&#39;) -&gt;
node_eqb n (node_id (fst g n&#39;)) = false -&gt;
node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c"><span class="nb">intro</span> Hneq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_eqb n (node_id (fst g n&#39;)) = false -&gt;
node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d"><span class="nb">case</span> (node_eq_dec n n&#39;); [<span class="nb">intro</span> Heq; <span class="nb">rewrite</span> Heq <span class="kr">in</span> Hneq; <span class="nb">rewrite</span> H <span class="kr">in</span> Hneq; <span class="bp">congruence</span>|].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; node_id (fst g n&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n &lt;&gt; n&#39; -&gt;
node_eqb n (node_id (fst g n&#39;)) = false -&gt;
node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e"><span class="nb">intros</span> Hneq&#39; Hnq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n'</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hin</var><span class="hyp-type"><b>: </b><span>In n&#39; participants</span></span></span><br><span><var>process</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Hpr</var><span class="hyp-type"><b>: </b><span>get_transition process 
  (fst g n&#39;) msg (fst g&#39; n&#39;) lm</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>Hneq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; node_id (fst g n&#39;)</span></span></span><br><span><var>Hneq'</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n&#39;</span></span></span><br><span><var>Hnq</var><span class="hyp-type"><b>: </b><span>node_eqb n (node_id (fst g n&#39;)) = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst g n) lm
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">case_eq</span> (is_member n participants); <span class="nb">intro</span>; <span class="nb">simpl</span>; <span class="nb">rewrite</span> H; <span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>g&#39; =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst g n)
 <span class="kr">else</span> fst g n, snd g)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane g&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30"><span class="nb">rewrite</span> H1; <span class="nb">clear</span> H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n, snd g)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk31"><span class="nb">intro</span> n; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>GState_sane g</span></span></span><br><span><var>g'</var><span class="hyp-type"><b>: </b><span>GState</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_id
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst g n)
   <span class="kr">else</span> fst g n) = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">case_eq</span> (is_member n participants); <span class="nb">intro</span>; <span class="nb">simpl</span>; <span class="nb">rewrite</span> H; <span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
A trace is a mapping from the natural numbers to global states. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">GTrace</span> : <span class="kt">Type</span> := nat -&gt; GState.</span></span></pre><div class="doc">
<a id="lab4"></a><h2 class="section">Protocol state definitions</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
A protocol-following trace is one that starts at the initial state and makes
only protocol-following global state transitions from step i to step (i+1), for all i. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">protocol_trace</span> (<span class="nv">t</span> : GTrace) : <span class="kt">Prop</span> :=
  t <span class="mi">0</span> = GState_init /\ <span class="kr">forall</span> <span class="nv">n</span>, GState_transition (t n) (t (S n)).</span></span></pre><div class="doc">
In turn, a valid Giskard protocol state is one that exists at the index of a protocol-following trace. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">protocol_state</span> (<span class="nv">g</span> : GState) (<span class="nv">t</span> : GTrace) : <span class="kt">Prop</span> :=
  <span class="kr">exists</span> <span class="nv">n</span>, protocol_trace t /\ (t n) = g.</span></span></pre><div class="doc">
<a id="lab5"></a><h2 class="section">Facts about protocol states and traces</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk32"><span class="kn">Lemma</span> <span class="nf">protocol_trace_zero</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>, protocol_trace tr -&gt; tr <span class="mi">0</span> = GState_init.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt; tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk33"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt; tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk34"><span class="nb">intros</span> tr H_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk35"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk36"><span class="kn">Lemma</span> <span class="nf">GState_init_protocol_state</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    protocol_state GState_init tr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt; protocol_state GState_init tr</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk37"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt; protocol_state GState_init tr</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk38"><span class="kr">exists</span> <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">protocol_trace tr /\ tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk39"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">protocol_trace tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><label class="goal-separator" for="global-v-chk3a"><hr></label><div class="goal-conclusion">tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">tr <span class="mi">0</span> = GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H; <span class="bp">easy</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c"><span class="kn">Lemma</span> <span class="nf">protocol_trace_state_sane</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>, protocol_trace tr -&gt;
  <span class="kr">forall</span> <span class="nv">n</span>, GState_sane (tr n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e"><span class="nb">intros</span> tr Htr n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f"><span class="nb">destruct</span> Htr <span class="kr">as</span> [Hinit Htr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk40"><span class="nb">revert</span> n Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">n</span> : nat,
(<span class="kr">forall</span> <span class="nv">n0</span> : nat,
 GState_transition (tr n0) (tr (S n0))) -&gt;
GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41"><span class="nb">induction</span> n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr <span class="mi">0</span>)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk42" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">n</span> : nat,
 GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk42"><hr></label><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr (S n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk43">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk44"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr <span class="mi">0</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk45"><span class="nb">rewrite</span> Hinit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane GState_init</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> GState_init_sane.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk46">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">n</span> : nat,
 GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">n</span> : nat, GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr (S n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk47"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">n</span> : nat,
 GState_transition (tr n) (tr (S n))) -&gt;
GState_sane (tr n)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr (S n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk48"><span class="nb">specialize</span> (IHn Htr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>GState_sane (tr n)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr (S n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk49"><span class="nb">specialize</span> (Htr n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>GState_sane (tr n)</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr (S n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4a"><span class="nb">revert</span> Htr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>GState_sane (tr n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_transition (tr n) (tr (S n)) -&gt;
GState_sane (tr (S n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4b"><span class="nb">apply</span> GState_sane_transition.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Hinit</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn</var><span class="hyp-type"><b>: </b><span>GState_sane (tr n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">GState_sane (tr n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4c"><span class="kn">Lemma</span> <span class="nf">view_state_morphism_inductive_step</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
      In n participants -&gt;
      node_view (fst (tr i) n) = node_view (fst (tr (S i)) n) \/
      S (node_view (fst (tr i) n)) = node_view (fst (tr (S i)) n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4e"><span class="nb">intros</span> tr Htr i n H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk4f"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk50"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk51">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk52"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk53" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk53"><hr></label><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk54">- <span class="c">(* In the normal transition case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk55"><span class="nb">destruct</span> (node_eq_dec n0 n) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk56" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk56"><hr></label><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk57">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk58"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
        <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update _];
        <span class="nb">rewrite</span> H_update; <span class="nb">simpl</span>; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk59">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5a"><span class="nb">left</span>; <span class="nb">rewrite</span> H_deliver; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5b"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n n0
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5c"><span class="nb">rewrite</span> node_eqb_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n0 n
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5d"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_new.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n0 n
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5e"><span class="nb">rewrite</span> H_new.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk5f"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk60"><span class="nb">rewrite</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (add_plural (fst (tr i) n) lm0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk61">- <span class="c">(* In the timeout case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk62"><span class="nb">left</span>; <span class="nb">rewrite</span> H_timeout; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk63"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk64"><span class="nb">rewrite</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (flip_timeout (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk65"><span class="kn">Lemma</span> <span class="nf">view_state_morphism</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
      In n participants -&gt;
      i1 &lt;= i2 -&gt; 
      node_view (fst (tr i1) n) &lt;= node_view (fst (tr i2) n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;= node_view (fst (tr i2) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk66"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;= node_view (fst (tr i2) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk67"><span class="nb">intros</span> tr H_prot i1 i2 n H_part H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;= node_view (fst (tr i2) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk68"><span class="nb">induction</span> i2 <span class="kr">as</span> [|i2 IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;= node_view (fst (tr <span class="mi">0</span>) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk69" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk69"><hr></label><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;= node_view (fst (tr <span class="mi">0</span>) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6b"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">inversion</span> H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= <span class="mi">0</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i1 = <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr <span class="mi">0</span>) n) &lt;= node_view (fst (tr <span class="mi">0</span>) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6c"><span class="nb">rewrite</span> H_init.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= <span class="mi">0</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i1 = <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst GState_init n) &lt;=
node_view (fst GState_init n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt;= S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6e"><span class="nb">apply</span> Nat.lt_eq_cases <span class="kr">in</span> H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2 \/ i1 = S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk6f"><span class="nb">destruct</span> H_le <span class="kr">as</span> [H_lt | H_eq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk70" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i1 = S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk70"><hr></label><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk71" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk71">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk72">spec IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt;= i2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk73" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk73"><hr></label><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk74"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i1 &lt; S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (view_state_morphism_inductive_step H_prot i2 n H_part) <span class="kr">as</span> [H_eq | H_eq_S];
        <span class="bp">lia</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk75">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i1 = S i2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk76"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i1 = S i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i1) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk77"><span class="nb">rewrite</span> H_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i1 = S i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr (S i2)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk78"><span class="kn">Lemma</span> <span class="nf">counting_messages_change_tells_receiver</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">p0</span> <span class="nv">m</span> <span class="nv">msg0</span> <span class="nv">lm0</span> <span class="nv">n</span> <span class="nv">msg</span>,
    protocol_trace tr -&gt;
    get_transition p0 (fst (tr i) m) msg0 (fst (tr (S i)) m) lm0 -&gt;
    tr (S i) = broadcast_messages (tr i) (fst (tr i) m) (fst (tr (S i)) m) lm0 -&gt;
    In n participants -&gt; 
    ~ In msg (counting_messages (fst (tr i) n)) -&gt;
    In msg (counting_messages (fst (tr (S i)) n)) -&gt;
    m = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt;
In n participants -&gt;
~ In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr (S i)) n)) -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk79"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt;
In n participants -&gt;
~ In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr (S i)) n)) -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk7a"><span class="nb">intros</span> tr i p0 m msg0 lm0 n msg Htr H_step H_deliver H_part H_not_in H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk7b"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk7c"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk7d"><span class="nb">destruct</span> (node_eq_dec m n) <span class="kr">as</span> [H_true | H_false].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>m = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk7e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk7e"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk7f"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk80"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk81"><span class="nb">assert</span> (H_same_counting : counting_messages (fst (tr (S i)) n) = counting_messages (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk82" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk82"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk83">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk84"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (broadcast_messages 
        (tr i) (fst (tr i) m) 
        (fst (tr (S i)) m) lm0) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk85"><span class="nb">unfold</span> broadcast_messages.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk86"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk87"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk88"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n m
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk89"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n m
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8a"><span class="nb">rewrite</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8b"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (add_plural (fst (tr i) n) lm0) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8c"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8d">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8e"><span class="nb">rewrite</span> H_same_counting <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk8f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk8f"><span class="kn">Lemma</span> <span class="nf">out_messages_global_monotonic_step</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt; 
    <span class="kr">forall</span> (<span class="nv">i</span>: nat),
    <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
      In n participants -&gt; 
      In msg (out_messages (fst (tr i) n)) -&gt;
      In msg (out_messages (fst (tr (S i)) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk90"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk91"><span class="nb">intros</span> tr Htr i n msg H_part H_in1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk92" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk92"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk93"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk94">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk95"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in [p [msg0 [lm0 [H_process H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk96" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk96"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk97"><span class="nb">destruct</span> (node_eq_dec n0 n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk98" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk98"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk99" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk99"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk9a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk9a"><span class="nb">rewrite</span> e <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk9b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk9b"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk9c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk9c"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk9d"><span class="nb">destruct</span> p; <span class="nb">destruct</span> H_process <span class="kr">as</span> [H_update _];
    <span class="nb">rewrite</span> H_update; <span class="nb">simpl</span>;
      <span class="kp">try</span> <span class="bp">assumption</span>;
      <span class="kp">try</span> (<span class="kp">try</span> <span class="nb">rewrite</span> in_app_iff; <span class="kp">repeat</span> <span class="nb">right</span>; <span class="bp">assumption</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk9e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk9e"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk9f"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (broadcast_messages 
           (tr i) (fst (tr i) n0) 
           (fst (tr (S i)) n0) lm0) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chka0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chka0"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka1"><span class="nb">unfold</span> broadcast_messages.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
         <span class="kr">then</span> fst (tr (S i)) n0
         <span class="kr">else</span>
          <span class="kr">if</span> is_member n participants
          <span class="kr">then</span> add_plural (fst (tr i) n) lm0
          <span class="kr">else</span> fst (tr i) n, 
         lm0 ++ snd (tr i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chka2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chka2"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka3"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
         <span class="kr">then</span> fst (tr (S i)) n0
         <span class="kr">else</span>
          <span class="kr">if</span> is_member n participants
          <span class="kr">then</span> add_plural (fst (tr i) n) lm0
          <span class="kr">else</span> fst (tr i) n, 
         lm0 ++ snd (tr i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chka4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chka4"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka5"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> node_eqb n n0
         <span class="kr">then</span> fst (tr (S i)) n0
         <span class="kr">else</span>
          <span class="kr">if</span> is_member n participants
          <span class="kr">then</span> add_plural (fst (tr i) n) lm0
          <span class="kr">else</span> fst (tr i) n, 
         lm0 ++ snd (tr i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chka6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chka6"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka7"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> n1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> node_eqb n n0
         <span class="kr">then</span> fst (tr (S i)) n0
         <span class="kr">else</span>
          <span class="kr">if</span> is_member n participants
          <span class="kr">then</span> add_plural (fst (tr i) n) lm0
          <span class="kr">else</span> fst (tr i) n, 
         lm0 ++ snd (tr i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chka8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chka8"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chka9"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> n1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> node_eqb n n0
         <span class="kr">then</span> fst (tr (S i)) n0
         <span class="kr">else</span>
          <span class="kr">if</span> is_member n participants
          <span class="kr">then</span> add_plural (fst (tr i) n) lm0
          <span class="kr">else</span> fst (tr i) n, 
         lm0 ++ snd (tr i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkaa" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chkaa"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkab"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkac" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chkac"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkad"><span class="nb">rewrite</span> n1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> add_plural (fst (tr i) n) lm0
      <span class="kr">else</span> fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkae" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chkae"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkaf"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (add_plural (fst (tr i) n) lm0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkb0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chkb0"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb1"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_process</var><span class="hyp-type"><b>: </b><span>get_transition p (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkb2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chkb2"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb3"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb4"><span class="nb">rewrite</span> H_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb5"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb6"><span class="nb">simpl</span>; <span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (flip_timeout (fst (tr i) n)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">easy</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb7"><span class="kn">Lemma</span> <span class="nf">out_messages_global_monotonic</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt; 
    <span class="kr">forall</span> (<span class="nv">n1</span> <span class="nv">n2</span> : nat),
      n1 &lt; n2 -&gt;
      <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
        In n participants -&gt; 
      In msg (out_messages (fst (tr n1) n)) -&gt;
      In msg (out_messages (fst (tr n2) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
n1 &lt; n2 -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr n1) n)) -&gt;
In msg (out_messages (fst (tr n2) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
n1 &lt; n2 -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr n1) n)) -&gt;
In msg (out_messages (fst (tr n2) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkb9"><span class="nb">intros</span> tr [H_init H_prot] n1 n2 H_lt n msg H_part H_in1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr n2) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkba"><span class="nb">generalize dependent</span> n2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">n2</span> : nat,
n1 &lt; n2 -&gt; In msg (out_messages (fst (tr n2) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkbb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkbb"><span class="nb">induction</span> n2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; <span class="mi">0</span> -&gt; In msg (out_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkbc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chkbc"><hr></label><div class="goal-conclusion">n1 &lt; S n2 -&gt; In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkbd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkbd"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkbe" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chkbe"><hr></label><div class="goal-conclusion">n1 &lt; S n2 -&gt; In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkbf"><span class="nb">inversion</span> H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n1 &lt; S n2 -&gt; In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc0"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc1"><span class="nb">assert</span> (n1 &lt; n2 \/ n1 = n2) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 \/ n1 = n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc2"><span class="nb">destruct</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkc3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 = n2</span></span></span><br></div><label class="goal-separator" for="global-v-chkc3"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc4">spec IHn2 H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n2) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkc5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 = n2</span></span></span><br></div><label class="goal-separator" for="global-v-chkc5"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc6"><span class="bp">now</span> <span class="nb">apply</span> out_messages_global_monotonic_step.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n1) n))</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 = n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc7"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n2 &lt; S n2</span></span></span><br><span><var>IHn2</var><span class="hyp-type"><b>: </b><span>n2 &lt; n2 -&gt;
In msg (out_messages (fst (tr n2) n))</span></span></span><br><span><var>H_in1</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr n2) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S n2)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> out_messages_global_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc8"><span class="kn">Lemma</span> <span class="nf">out_messages_change_means_sent</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
   protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node) (<span class="nv">p0</span> : NState_transition_type)
    (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
  In n0 participants -&gt;
  tr (S i) = broadcast_messages (tr i) (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
  get_transition p0 (fst (tr i) n0) msg0 (fst (tr (S i)) n0) lm0 -&gt;
  <span class="kr">forall</span> <span class="nv">n</span> : node,
  In n participants -&gt;
  <span class="kr">forall</span> <span class="nv">msg</span> : message,
     In msg (out_messages (fst (tr (S i)) n)) -&gt; 
     ~ In msg (out_messages (fst (tr i) n)) -&gt;
     In msg lm0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message)
  (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt; In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkc9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkc9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message)
  (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt; In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkca" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkca"><span class="nb">intros</span> tr Htr i n0 p0 msg0 lm0 H_part0 H_deliver H_step n H_part msg H_in H_out.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkcb"><span class="nb">destruct</span> (node_eq_dec n0 n) <span class="kr">as</span> [H_eq | H_neq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkcc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chkcc"><hr></label><div class="goal-conclusion">In msg lm0</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkcd">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkce"><span class="nb">rewrite</span> H_eq <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
      <span class="nb">assert</span> (H_step_copy := H_step);
      <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_broadcast H_rest]];
      <span class="nb">rewrite</span> H_update <span class="kr">in</span> H_in;
      <span class="nb">rewrite</span> H_broadcast;
      <span class="nb">simpl</span> <span class="kr">in</span> H_in;
      <span class="kp">try</span> <span class="nb">rewrite</span> in_app_iff <span class="kr">in</span> H_in; 
      <span class="kp">repeat</span> <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in | H_in];
      <span class="kp">try</span> <span class="bp">contradiction</span>;
      <span class="kp">try</span> <span class="bp">assumption</span>; 
      <span class="kp">try</span> (<span class="nb">rewrite</span> &lt;- H_in; <span class="nb">simpl</span>; <span class="bp">tauto</span>);
      <span class="kp">try</span> (<span class="nb">rewrite</span> &lt;- H_in; <span class="nb">apply</span> in_eq);
      <span class="kp">try</span> (<span class="nb">right</span>; <span class="bp">assumption</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkcf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkcf">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd0"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd1"><span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (fst
        (broadcast_messages 
           (tr i) (fst (tr i) n0)
           (fst (tr (S i)) n0) lm0) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd2"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd3"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr) <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd4"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n0 n
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd5"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_neq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n0 n
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd6"><span class="nb">rewrite</span> H_neq <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> add_plural (fst (tr i) n) lm0
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd7"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> add_plural (fst (tr i) n) lm0
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd8"><span class="nb">rewrite</span> H_part <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages (add_plural (fst (tr i) n) lm0))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkd9"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_part0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkda" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkda"><span class="kn">Lemma</span> <span class="nf">global_messages_monotonic_step</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">n</span> : nat) (<span class="nv">msg</span> : message),
        In msg (snd (tr n)) -&gt;
        In msg (snd (tr (S n))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr n)) -&gt; In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkdb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkdb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr n)) -&gt; In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">   
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkdc"><span class="nb">intros</span> tr H_prot n msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkdd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkdd"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init H_prot];
  spec H_prot n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkde"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr n) n0) msg0
  (fst (tr (S n)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S n) =
broadcast_messages (tr n) 
  (fst (tr n) n0) (fst (tr (S n)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkdf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S n) =
(<span class="kr">fun</span> <span class="nv">n0</span> : node =&gt;
 <span class="kr">if</span> is_member n0 participants
 <span class="kr">then</span> flip_timeout (fst (tr n) n0)
 <span class="kr">else</span> fst (tr n) n0, snd (tr n))</span></span></span><br></div><label class="goal-separator" for="global-v-chkdf"><hr></label><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke0">- <span class="c">(* In the transition case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr n) n0) msg0
  (fst (tr (S n)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S n) =
broadcast_messages (tr n) 
  (fst (tr n) n0) (fst (tr (S n)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke1"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr n) n0) msg0
  (fst (tr (S n)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S n) =
broadcast_messages (tr n) 
  (fst (tr n) n0) (fst (tr (S n)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (snd
     (broadcast_messages 
        (tr n) (fst (tr n) n0) 
        (fst (tr (S n)) n0) lm0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke2"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr n) n0) msg0
  (fst (tr (S n)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S n) =
broadcast_messages (tr n) 
  (fst (tr n) n0) (fst (tr (S n)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke3"><span class="nb">apply</span> in_app_iff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr n) n0) msg0
  (fst (tr (S n)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S n) =
broadcast_messages (tr n) 
  (fst (tr n) n0) (fst (tr (S n)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0 \/ In msg (snd (tr n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">right</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke4">- <span class="c">(* In the timeout case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S n) =
(<span class="kr">fun</span> <span class="nv">n0</span> : node =&gt;
 <span class="kr">if</span> is_member n0 participants
 <span class="kr">then</span> flip_timeout (fst (tr n) n0)
 <span class="kr">else</span> fst (tr n) n0, snd (tr n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke5"><span class="nb">rewrite</span> H_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S n) =
(<span class="kr">fun</span> <span class="nv">n0</span> : node =&gt;
 <span class="kr">if</span> is_member n0 participants
 <span class="kr">then</span> flip_timeout (fst (tr n) n0)
 <span class="kr">else</span> fst (tr n) n0, snd (tr n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (snd
     (<span class="kr">fun</span> <span class="nv">n0</span> : node =&gt;
      <span class="kr">if</span> is_member n0 participants
      <span class="kr">then</span> flip_timeout (fst (tr n) n0)
      <span class="kr">else</span> fst (tr n) n0, 
      snd (tr n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke6"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S n) =
(<span class="kr">fun</span> <span class="nv">n0</span> : node =&gt;
 <span class="kr">if</span> is_member n0 participants
 <span class="kr">then</span> flip_timeout (fst (tr n) n0)
 <span class="kr">else</span> fst (tr n) n0, snd (tr n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke7"><span class="kn">Lemma</span> <span class="nf">global_messages_monotonic</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
    protocol_trace tr -&gt;
    <span class="kr">forall</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
      n1 &lt; n2 -&gt;
      <span class="kr">forall</span> (<span class="nv">msg</span> : message),
        In msg (snd (tr n1)) -&gt;
        In msg (snd (tr n2)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
n1 &lt; n2 -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr n1)) -&gt; In msg (snd (tr n2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> <span class="nv">n1</span> <span class="nv">n2</span> : nat,
n1 &lt; n2 -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr n1)) -&gt; In msg (snd (tr n2))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chke9"><span class="nb">intros</span> tr H_prot n1 n2 H_lt msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr n2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkea" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkea"><span class="nb">induction</span> n2 <span class="kr">as</span> [|n2 IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; <span class="mi">0</span></span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkeb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br></div><label class="goal-separator" for="global-v-chkeb"><hr></label><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkec" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkec">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; <span class="mi">0</span></span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> H_lt.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chked" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chked">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkee" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkee"><span class="nb">assert</span> (H : n1 &lt; n2 \/ n1 = n2) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 \/ n1 = n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkef" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkef"><span class="nb">destruct</span> H <span class="kr">as</span> [H_still_lt | H_eq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H_still_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chkf0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n1 = n2</span></span></span><br></div><label class="goal-separator" for="global-v-chkf0"><hr></label><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf1">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H_still_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf2">spec IH_prot H_still_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>H_still_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf3">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n1, n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n1 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n1))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n1 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n1 = n2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf4"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>n2 &lt; S n2</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>n2 &lt; n2 -&gt; In msg (snd (tr n2))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr n2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S n2)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf5"><span class="kn">Lemma</span> <span class="nf">not_my_problem</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>, protocol_trace tr -&gt;
    <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">n0</span> <span class="nv">lm0</span>,
    In n participants -&gt; 
    n0 &lt;&gt; n -&gt; 
    tr (S i) = broadcast_messages (tr i) (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
    counting_messages (fst (tr (S i)) n) = counting_messages (fst (tr i) n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> <span class="nv">n0</span> : node) (<span class="nv">lm0</span> : list message),
In n participants -&gt;
n0 &lt;&gt; n -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> <span class="nv">n0</span> : node) (<span class="nv">lm0</span> : list message),
In n participants -&gt;
n0 &lt;&gt; n -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf7"><span class="nb">intros</span> tr Htr; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf8"><span class="nb">rewrite</span> H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (broadcast_messages (tr i) (fst (tr i) n0)
        (fst (tr (S i)) n0) lm0) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkf9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkf9"><span class="nb">unfold</span> broadcast_messages.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkfa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkfa"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkfb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkfb"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkfc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkfc"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkfd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkfd"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n n0
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkfe" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkfe"><span class="nb">rewrite</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chkff" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chkff"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk100" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk100"><span class="nb">rewrite</span> H2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (add_plural (fst (tr i) n) lm0) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk101" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk101"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n, n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk102" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk102"><span class="kn">Lemma</span> <span class="nf">counting_messages_monotonic</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">msg</span>,
    protocol_trace tr -&gt;
    In n participants -&gt; 
    In msg (counting_messages (fst (tr i) n)) -&gt;
    In msg (counting_messages (fst (tr (S i)) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk103" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk103"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk104" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk104"><span class="nb">intros</span> tr i n msg Htr H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk105" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk105"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk106" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk106"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk107" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk107">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk108" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk108"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk109" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk109"><hr></label><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk10a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk10a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk10b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk10b"><span class="nb">destruct</span> (node_eq_dec n0 n) <span class="kr">as</span> [H_n | H_not_n].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_n</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk10c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_not_n</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk10c"><hr></label><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk10d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk10d">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_n</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk10e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk10e"><span class="nb">rewrite</span> H_n <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_n</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
      <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update H_rest];
      <span class="nb">rewrite</span> H_update;
      <span class="nb">simpl</span>; 
      <span class="kp">try</span> <span class="bp">assumption</span>;
      <span class="kp">try</span> (<span class="nb">right</span>; <span class="bp">assumption</span>);
      <span class="kp">try</span> (<span class="nb">right</span>; <span class="nb">right</span>; <span class="bp">assumption</span>);
      <span class="kp">try</span> (<span class="nb">rewrite</span> H_update <span class="kr">in</span> H_view;
           <span class="nb">simpl</span> <span class="kr">in</span> H_view;
           <span class="bp">lia</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk10f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk10f">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_not_n</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk110" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk110"><span class="nb">assert</span> (H_same_counting : counting_messages (fst (tr (S i)) n) =
       counting_messages (fst (tr i) n)) <span class="bp">by</span> <span class="nb">apply</span> (not_my_problem Htr&#39; i H_part H_not_n H_deliver).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_not_n</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">rewrite</span> H_same_counting.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk111" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk111">- <span class="c">(* In the timeout case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk112" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk112"><span class="nb">assert</span> (H_same_counting : counting_messages (fst (tr (S i)) n) = counting_messages (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk113" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk113"><hr></label><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk114" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk114">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk115" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk115"><span class="nb">rewrite</span> H_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n, 
      snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk116" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk116"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n, 
      snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk117" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk117"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk118" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk118"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (flip_timeout (fst (tr i) n)) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk119" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk119"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11a">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">rewrite</span> H_same_counting.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11b"><span class="kn">Lemma</span> <span class="nf">counting_message_different_tells_receiver</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">p0</span> <span class="nv">m</span> <span class="nv">msg0</span> <span class="nv">lm0</span>,
    protocol_trace tr -&gt;
    In n participants -&gt; 
    counting_messages (fst (tr i) n) &lt;&gt; counting_messages (fst (tr (S i)) n) -&gt;
    get_transition p0 (fst (tr i) m) msg0 (fst (tr (S i)) m) lm0 -&gt;
    tr (S i) = broadcast_messages (tr i) (fst (tr i) m) (fst (tr (S i)) m) lm0 -&gt; 
    m = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
protocol_trace tr -&gt;
In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
protocol_trace tr -&gt;
In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp">                                       
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11d"><span class="nb">intros</span> tr i n p0 m msg0 lm0 Htr H_part H_diff H_step H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11e"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk11f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk11f"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk120" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk120"><span class="nb">destruct</span> (node_eq_dec m n) <span class="kr">as</span> [H_true | H_false].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>m = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk121" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk121"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk122" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk122"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk123" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk123"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk124" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk124"><span class="nb">assert</span> (H_same_counting : counting_messages (fst (tr (S i)) n) = counting_messages (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk125" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk125"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk126" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk126">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk127" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk127"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (broadcast_messages 
        (tr i) (fst (tr i) m) 
        (fst (tr (S i)) m) lm0) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk128" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk128"><span class="nb">unfold</span> broadcast_messages.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk129" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk129"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12a"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12b"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n m
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12c"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> node_eqb n m
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12d"><span class="nb">rewrite</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12e"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (add_plural (fst (tr i) n) lm0) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk12f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk12f"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) =
counting_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk130" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk130">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk131" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk131"><span class="nb">rewrite</span> H_same_counting <span class="kr">in</span> H_diff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr i) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_counting</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr (S i)) n) =
counting_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk132" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk132"><span class="kn">Lemma</span> <span class="nf">view_different_tells_receiver</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">p0</span> <span class="nv">m</span> <span class="nv">msg0</span> <span class="nv">lm0</span>,
    protocol_trace tr -&gt;
    In n participants -&gt; 
    node_view (fst (tr i) n) &lt;&gt; node_view (fst (tr (S i)) n) -&gt; 
    get_transition p0 (fst (tr i) m) msg0 (fst (tr (S i)) m) lm0 -&gt;
    tr (S i) = broadcast_messages (tr i) (fst (tr i) m) (fst (tr (S i)) m) lm0 -&gt; 
    m = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
protocol_trace tr -&gt;
In n participants -&gt;
node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk133" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk133"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">m</span> : node)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
protocol_trace tr -&gt;
In n participants -&gt;
node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) m)
  (fst (tr (S i)) m) lm0 -&gt; m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk134" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk134"><span class="nb">intros</span> tr i n p0 m msg0 lm0 Htr H_part H_diff H_step H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk135" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk135"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk136" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk136"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk137" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk137"><span class="nb">destruct</span> (node_eq_dec m n) <span class="kr">as</span> [H_true | H_false].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>m = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk138" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk138"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk139" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk139"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>m &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13a"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13b"><span class="nb">assert</span> (H_same_view : node_view (fst (tr (S i)) n) = node_view (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
node_view (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk13c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_view</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S i)) n) =
node_view (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk13c"><hr></label><div class="goal-conclusion">m = n</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13d">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13e"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (fst
     (broadcast_messages 
        (tr i) (fst (tr i) m) 
        (fst (tr (S i)) m) lm0) n) =
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk13f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk13f"><span class="nb">unfold</span> broadcast_messages.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) = 
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk140" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk140"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n (node_id (fst (tr i) m))
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) = 
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk141" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk141"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n m
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) = 
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk142" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk142"><span class="nb">rewrite</span> node_eqb_comm <span class="kr">in</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n m
      <span class="kr">then</span> fst (tr (S i)) m
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) = 
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk143" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk143"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (<span class="kr">if</span> node_eqb n m
   <span class="kr">then</span> fst (tr (S i)) m
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) = 
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk144" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk144"><span class="nb">rewrite</span> H_false.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) = node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk145" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk145"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (add_plural (fst (tr i) n) lm0) =
node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk146" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk146"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb n m = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) = node_view (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk147" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk147">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_view</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S i)) n) =
node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk148" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk148"><span class="nb">rewrite</span> H_same_view <span class="kr">in</span> H_diff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>m</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;&gt;
node_view (fst (tr i) n)</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>node_eqb m n = false</span></span></span><br><span><var>H_same_view</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S i)) n) =
node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">m = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk149" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk149"><span class="kn">Lemma</span> <span class="nf">counting_message_change_view_change</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">msg</span>,
    protocol_trace tr -&gt;
    In n participants -&gt;
    In msg (counting_messages (fst (tr i) n)) -&gt;
    ~ In msg (counting_messages (fst (tr (S i)) n)) -&gt;
    node_view (fst (tr (S i)) n) = S (node_view (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
~ In msg (counting_messages (fst (tr (S i)) n)) -&gt;
node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
~ In msg (counting_messages (fst (tr (S i)) n)) -&gt;
node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14b"><span class="nb">intros</span> tr i n msg [H_init H_prot] H_part H_in H_not_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14c"><span class="nb">assert</span> (H_prot_copy := H_prot).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14d">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk14e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk14e"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk14f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk14f"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk150" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk150"><span class="nb">assert</span> (H_useful := counting_message_different_tells_receiver).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) 
  (<span class="nv">n</span> : node) (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">m</span> : node) (<span class="nv">msg0</span> : message)
  (<span class="nv">lm0</span> : list message),
protocol_trace tr -&gt;
In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) m) msg0
  (fst (tr (S i)) m) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) m) (fst (tr (S i)) m) lm0 -&gt;
m = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk151" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk151"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk152" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk152">spec H_useful tr i n p0 n0 msg0 lm0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>protocol_trace tr -&gt;
In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk153" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk153"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk154" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk154">spec H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>protocol_trace tr -&gt;
In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">protocol_trace tr</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk155" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk155"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk156" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk156"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk157" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk157"><span class="nb">split</span>; <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>In n participants -&gt;
counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk158" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk158"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk159" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk159">spec H_useful H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk15a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk15a"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk15b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk15b">spec H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk15c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk15c"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk15d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk15d"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk15e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk15e"><span class="nb">destruct</span> (list_eq_dec message_eq_dec (counting_messages (fst (tr i) n)) (counting_messages (fst (tr (S i)) n))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) =
counting_messages (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk15f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk15f"><hr></label><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk160" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk160"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk161" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk161"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk162" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk162"><span class="nb">rewrite</span> e <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) =
counting_messages (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk163" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk163"><hr></label><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk164" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk164"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk165" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk165"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk166" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk166"><span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n) -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br><span><var>n1</var><span class="hyp-type"><b>: </b><span>counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">counting_messages (fst (tr i) n) &lt;&gt;
counting_messages (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk167" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk167"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk168" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk168"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk169" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk169"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk16a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk16a"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk16b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk16b">spec H_useful H_step H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk16c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk16c"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk16d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk16d"><span class="nb">rewrite</span> &lt;- H_useful <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n0))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n0))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n0) =
S (node_view (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk16e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk16e"><hr></label><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk16f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk16f"><span class="nb">destruct</span> p0; <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update _];
    <span class="nb">rewrite</span> H_update; <span class="nb">simpl</span>; <span class="kp">try</span> <span class="bp">reflexivity</span>;
      <span class="kp">try</span> (<span class="nb">rewrite</span> H_update <span class="kr">in</span> H_not_in;
           <span class="nb">simpl</span> <span class="kr">in</span> H_not_in; <span class="kp">try</span> <span class="bp">tauto</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk170" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk170"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_not_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk171" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk171"><span class="nb">assert</span> (H_member : is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_member</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk172" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk172"><span class="nb">simpl</span> <span class="kr">in</span> H_not_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_member</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk173" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk173"><span class="nb">rewrite</span> H_member <span class="kr">in</span> H_not_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~
In msg
  (counting_messages
     (flip_timeout (fst (tr i) n)))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_member</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk174" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk174"><span class="nb">simpl</span> <span class="kr">in</span> H_not_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_not_in</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H_member</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr (S i)) n) =
S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk175" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk175"><span class="kn">Lemma</span> <span class="nf">processed_means_past_received</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
      In n participants -&gt; 
      In msg (counting_messages (fst (tr i) n)) -&gt;
      <span class="kr">exists</span> (<span class="nv">i_past</span> : nat),
        i_past &lt; i /\ 
        In msg (in_messages (fst (tr i_past) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk176" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk176"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk177" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk177"><span class="nb">intros</span> tr H_prot i n msg H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk178" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk178"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; <span class="mi">0</span> /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk179" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk179"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; <span class="mi">0</span> /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in;
      <span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17c"><span class="nb">destruct</span> (In_dec message_eq_dec msg (counting_messages (fst (tr i) n))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk17d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk17d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17e">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk17f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk17f">spec IH_prot H_old.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk180" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk180"><span class="nb">destruct</span> IH_prot <span class="kr">as</span> [i_past [H_lt H_goal]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk181" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk181"><span class="kr">exists</span> <span class="nv">i_past</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i_past &lt; S i</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk182" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk182"><hr></label><div class="goal-conclusion">In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk183" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk183"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk184" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk184">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk185" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk185"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk186" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk186"><span class="nb">assert</span> (H_prot_copy := H_prot);
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init H_prot];
        spec H_prot i;
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk187" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk187"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk188" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk188">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk189" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk189"><span class="nb">assert</span> (H_subst := counting_messages_change_tells_receiver _ _ _ _ _ _ H_prot_copy H_step H_deliver H_part H_new H_in).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_subst</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18a"><span class="nb">rewrite</span> H_subst <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_subst</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      <span class="c">(* Now that we&#39;ve established n made the transition *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">assert</span> (H_step_copy := H_step);
        <span class="nb">destruct</span> p0;
        <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_out H_rest]];
        <span class="nb">rewrite</span> H_update <span class="kr">in</span> H_in;
        <span class="c">(* For cases that don&#39;t process messages *)</span>
        <span class="kp">try</span> <span class="bp">contradiction</span>;
      <span class="c">(* 9 goals left *)</span>
        <span class="kp">try</span> (<span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>;
               <span class="nb">simpl</span> <span class="kr">in</span> H_in;
               <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_piggyback | H_contra];
               [<span class="nb">subst</span>; <span class="bp">tauto</span> | <span class="bp">contradiction</span>]);
      <span class="c">(* 2 goals left! *)</span>
      <span class="kp">try</span> (<span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>;
             <span class="nb">simpl</span> <span class="kr">in</span> H_in;
        <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_self | [H_piggyback | H_contra]];
        [<span class="nb">rewrite</span> H_self <span class="kr">in</span> *; <span class="bp">tauto</span> | <span class="nb">subst</span>; <span class="bp">tauto</span> | <span class="bp">contradiction</span>]).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18b">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18c"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (counting_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18d"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (counting_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18e"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (counting_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk18f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk18f"><span class="nb">rewrite</span> H_part <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (counting_messages
     (flip_timeout (fst (tr i) n)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk190" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk190"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  In msg (in_messages (fst (tr i_past) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk191" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk191"><span class="kn">Lemma</span> <span class="nf">delivered_means_sent_global</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
      In n participants -&gt; 
      In msg (in_messages (fst (tr i) n)) -&gt;
      In msg (snd (tr i)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk192" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk192"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk193" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk193"><span class="nb">intros</span> tr H_prot i n msg H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk194" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk194"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk195" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk195"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk196" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk196">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in;
      <span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk197" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk197">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk198" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk198"><span class="nb">destruct</span> (In_dec message_eq_dec msg (in_messages (fst (tr i) n))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk199" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk199"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19b">spec IH_prot H_old.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19d"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk19e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk19e"><span class="nb">assert</span> (H_prot_copy := H_prot);
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init H_prot];
        spec H_prot i;
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk19f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk19f"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a0">* <span class="c">(* In the normal transition case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a1"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (snd
     (broadcast_messages 
        (tr i) (fst (tr i) n0) 
        (fst (tr (S i)) n0) lm0))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a2"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a3"><span class="nb">destruct</span> (node_eq_dec n n0) <span class="kr">as</span> [H_eq | H_neq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1a4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1a4"><hr></label><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a5">** <span class="c">(* If n made the transition *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a6"><span class="nb">rewrite</span> &lt;- H_eq <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          <span class="c">(* There cannot be a message that is added after n consumes a message by</span>
<span class="c">             making a transition, so we find a contradiction between H_in and H_new *)</span>
</span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
            <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update _];
            <span class="nb">rewrite</span> H_update <span class="kr">in</span> H_in;
            <span class="nb">simpl</span> <span class="kr">in</span> *;
            <span class="kp">try</span> <span class="bp">contradiction</span>;
            <span class="kp">try</span> (<span class="kp">repeat</span> <span class="nb">apply</span> remove_subset <span class="kr">in</span> H_in; <span class="bp">contradiction</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a7">** <span class="c">(* If n didn&#39;t make the transition *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a8"><span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (fst
        (broadcast_messages 
           (tr i) (fst (tr i) n0)
           (fst (tr (S i)) n0) lm0) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1a9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1a9"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1aa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1aa"><span class="nb">rewrite</span> (protocol_trace_state_sane H_prot_copy) <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ab" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ab"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ac" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ac"><span class="nb">rewrite</span> H_part <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span> add_plural (fst (tr i) n) lm0))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ad" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ad"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_neq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span> add_plural (fst (tr i) n) lm0))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ae" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ae"><span class="nb">rewrite</span> H_neq <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages (add_plural (fst (tr i) n) lm0))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1af" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1af"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (lm0 ++ in_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b0"><span class="nb">apply</span> in_app_iff <span class="kr">in</span> H_in;
            <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_goal | H_contra].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1b1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_contra</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><label class="goal-separator" for="global-v-chk1b1"><hr></label><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b2"><span class="nb">apply</span> in_app_iff; <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_contra</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b3">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b4"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b5"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b6"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b7"><span class="nb">rewrite</span> H_part <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (in_messages (flip_timeout (fst (tr i) n)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b8"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (in_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1b9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1b9"><span class="kn">Lemma</span> <span class="nf">processed_means_sent_global</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
      In n participants -&gt; 
      In msg (counting_messages (fst (tr i) n)) -&gt;
      In msg (snd (tr i)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ba" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ba"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">   
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1bb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1bb"><span class="nb">intros</span> tr H_prot i n msg H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1bc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1bc"><span class="nb">assert</span> (H_useful := processed_means_past_received H_prot _ _ _ H_part H_in).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1bd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1bd"><span class="nb">destruct</span> H_useful <span class="kr">as</span> [i_past [H_lt H_goal]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1be" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1be"><span class="nb">assert</span> (H_useful2 := delivered_means_sent_global H_prot _ _ _ H_part H_goal).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_goal</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> (global_messages_monotonic H_prot H_lt _ H_useful2).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1bf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1bf"><span class="kn">Lemma</span> <span class="nf">delivered_means_sent_local</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>, protocol_trace tr -&gt;
   <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">msg</span> (<span class="nv">n0</span> : node) (<span class="nv">lm0</span> : list message),
   In msg lm0 -&gt;
   In n0 participants -&gt;
   <span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
   get_transition p0 (fst (tr i) n0) msg0 (fst (tr (S i)) n0) lm0 -&gt;
   tr (S i) = broadcast_messages (tr i) (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
   In msg (out_messages (fst (tr (S i)) n0)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n0</span> : node)
  (<span class="nv">lm0</span> : list message),
In msg lm0 -&gt;
In n0 participants -&gt;
<span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
In msg (out_messages (fst (tr (S i)) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n0</span> : node)
  (<span class="nv">lm0</span> : list message),
In msg lm0 -&gt;
In n0 participants -&gt;
<span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
In msg (out_messages (fst (tr (S i)) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">   
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c1"><span class="nb">intros</span> tr Htr i msg n0 lm0 H_fresh H_in0 p0 msg0 H_step H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c2"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (fst
        (broadcast_messages 
           (tr i) (fst (tr i) n0) 
           (fst (tr (S i)) n0) lm0) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c3"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n0 (node_id (fst (tr i) n0))
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n0 participants
       <span class="kr">then</span> add_plural (fst (tr i) n0) lm0
       <span class="kr">else</span> fst (tr i) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c4"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (out_messages
     (<span class="kr">if</span> node_eqb n0 n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n0 participants
       <span class="kr">then</span> add_plural (fst (tr i) n0) lm0
       <span class="kr">else</span> fst (tr i) n0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c5"><span class="nb">rewrite</span> node_eqb_refl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n0))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1c6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1c6"><span class="nb">destruct</span> p0;
    <span class="nb">assert</span> (H_step_copy := H_step);
    <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_out _]];
    <span class="nb">rewrite</span> H_update;
    <span class="nb">rewrite</span> H_out <span class="kr">in</span> H_fresh; <span class="nb">simpl</span>;
      <span class="kp">try</span> <span class="bp">easy</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks (fst (tr i) n0)
     (GenesisBlock_message (fst (tr i) n0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural (fst (tr i) n0)
  (make_PrepareBlocks (fst (tr i) n0)
     (GenesisBlock_message (fst (tr i) n0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks (fst (tr i) n0)
  (GenesisBlock_message (fst (tr i) n0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition propose_block_init_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block GenesisBlock;
  get_piggyback_block := GenesisBlock
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block GenesisBlock);
  get_piggyback_block := GenesisBlock
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block GenesisBlock));
  get_piggyback_block := GenesisBlock
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1c7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareQC (fst (tr i) n0) msg0
   :: pending_PrepareVote 
        (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1c7"><hr></label><div class="goal-conclusion">make_PrepareQC (fst (tr i) n0) msg0 = msg \/
In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1c8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1c8"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1c9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1c9"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1ca" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1ca"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1cb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1cb"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1cc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1cc"><span class="nb">unfold</span> make_PrepareBlocks <span class="kr">in</span> H_fresh;
    <span class="nb">simpl</span> <span class="kr">in</span> H_fresh; <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareQC (fst (tr i) n0) msg0
   :: pending_PrepareVote 
        (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">make_PrepareQC (fst (tr i) n0) msg0 = msg \/
In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1cd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1cd"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1ce" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1ce"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1cf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1cf"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d0"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1d1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1d1"><span class="nb">simpl</span> <span class="kr">in</span> H_fresh; <span class="nb">destruct</span> H_fresh.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>make_PrepareQC (fst (tr i) n0) msg0 = msg</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">make_PrepareQC (fst (tr i) n0) msg0 = msg \/
In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1d2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d2"><hr></label><div class="goal-conclusion">make_PrepareQC (fst (tr i) n0) msg0 = msg \/
In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d3"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d4"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d5"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d6"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1d7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1d7"><span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">make_PrepareQC (fst (tr i) n0) msg0 = msg \/
In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1d8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d8"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1d9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1d9"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1da" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1da"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1db" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1db"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1dc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1dc"><span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1dd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1dd"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1de" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1de"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1df" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1df"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e0"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1e1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1e1"><span class="nb">rewrite</span> in_app_iff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (make_PrepareQC (fst (tr i) n0) msg0
      :: pending_PrepareVote
           (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n0) msg0
:: pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (pending_PrepareVote (fst (tr i) n0) msg0) \/
In msg (out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1e2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e2"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e3"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e4"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e5"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1e6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1e6"><span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0)) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process (fst (tr i) n0) msg0))
  (make_PrepareBlocks
     (increment_view
        (process (fst (tr i) n0) msg0))
     msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareBlocks
  (increment_view
     (process (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_last_block_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block := generate_new_block (get_block msg0);
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block (get_block msg0));
  get_piggyback_block := get_block msg0
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block (get_block msg0)));
  get_piggyback_block := get_block msg0
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1e7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e7"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e8"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1e9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1e9"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ea" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ea"><span class="nb">unfold</span> make_PrepareBlocks <span class="kr">in</span> H_fresh; <span class="nb">simpl</span> <span class="kr">in</span> H_fresh; <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
process
  (record_plural (fst (tr i) n0)
     (pending_PrepareVote 
        (fst (tr i) n0) msg0)) msg0</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1eb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1eb"><hr></label><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk1ec" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1ec"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ed" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ed"><span class="nb">apply</span> in_app_iff; <span class="nb">left</span>; <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|} = msg \/
make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0)));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_new_block
      (generate_new_block
         (get_block
            (highest_ViewChange_message
               (process (fst (tr i) n0) msg0))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/
{|
  get_message_type := PrepareBlock;
  get_view := S (node_view (fst (tr i) n0));
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    generate_last_block
      (generate_new_block
         (generate_new_block
            (get_block
               (highest_ViewChange_message
                  (process (fst (tr i) n0) msg0)))));
  get_piggyback_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0))
|} = msg \/ In msg (out_messages (fst (tr i) n0))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1ee" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1ee"><hr></label><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Vanquished bug here *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ef" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ef"><span class="nb">unfold</span> make_PrepareBlocks <span class="kr">in</span> H_fresh; <span class="nb">simpl</span> <span class="kr">in</span> H_fresh; <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (process (fst (tr i) n0) msg0)
  (pending_PrepareVote (fst (tr i) n0) msg0)</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 = pending_PrepareVote (fst (tr i) n0) msg0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (pending_PrepareVote (fst (tr i) n0) msg0 ++
   out_messages (fst (tr i) n0))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> in_app_iff; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f0"><span class="kn">Lemma</span> <span class="nf">out_message_change_tells_sender</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace), protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
    (<span class="nv">p0</span> : NState_transition_type)
    (<span class="nv">msg0</span> : message)
    (<span class="nv">lm0</span> : list message),
    In n0 participants -&gt; 
    <span class="c">(* g ~~&gt; g&#39; with fixed node and in/out messages *)</span> 
    tr (S i) = broadcast_messages (tr i) (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt; 
    get_transition p0 (fst (tr i) n0) msg0 (fst (tr (S i)) n0) lm0 -&gt;
    <span class="c">(* We know the node that processed the message, </span>
<span class="c">     although we don&#39;t necessarily know the message *)</span> 
    <span class="kr">forall</span> (<span class="nv">n</span> : node),
      In n participants -&gt; 
      (<span class="kr">exists</span> (<span class="nv">msg</span> : message), 
          In msg (out_messages (fst (tr (S i)) n)) /\
          ~ In msg (out_messages (fst (tr i) n))) -&gt;
      n0 = n.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message)
  (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (out_messages (fst (tr (S i)) n)) /\
   ~ In msg (out_messages (fst (tr i) n))) -&gt; n0 = n</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message)
  (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (out_messages (fst (tr (S i)) n)) /\
   ~ In msg (out_messages (fst (tr i) n))) -&gt; n0 = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f2"><span class="nb">intros</span> tr Htr i n0 p0 msg0 lm0 H_in0 H_deliver H_step n H_in H_change.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n0 = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f3"><span class="nb">destruct</span> (node_eq_dec n n0) <span class="kr">as</span> [H_eq | H_neq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n0 = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1f4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><label class="goal-separator" for="global-v-chk1f4"><hr></label><div class="goal-conclusion">n0 = n</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>n = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n0 = n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">symmetry</span>; <span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n0 = n</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f7"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_change</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    <span class="c">(* Proving a contradiction *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f8"><span class="nb">destruct</span> H_change <span class="kr">as</span> [msg [H_new H_old]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* For all non-n0 nodes, their out message nodes are exactly the same *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1f9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1f9"><span class="nb">assert</span> (H_eq_one : out_messages (fst (tr (S i)) n) = out_messages (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk1fa" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br><span><var>H_eq_one</var><span class="hyp-type"><b>: </b><span>out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk1fa"><hr></label><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1fb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1fb">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1fc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1fc"><span class="nb">unfold</span> broadcast_messages <span class="kr">in</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1fd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1fd"><span class="nb">rewrite</span> (protocol_trace_state_sane Htr) <span class="kr">in</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1fe" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1fe"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_neq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk1ff" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk1ff"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> node_eqb n n0
      <span class="kr">then</span> fst (tr (S i)) n0
      <span class="kr">else</span>
       <span class="kr">if</span> is_member n participants
       <span class="kr">then</span> add_plural (fst (tr i) n) lm0
       <span class="kr">else</span> fst (tr i) n, 
      lm0 ++ snd (tr i)) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk200" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk200"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages
  (<span class="kr">if</span> node_eqb n n0
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n) = 
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk201" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk201"><span class="nb">rewrite</span> H_neq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) = out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk202" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk202"><span class="nb">assert</span> (is_member n participants = true) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span>
      is_member_correct.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n) = out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk203" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk203"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (add_plural (fst (tr i) n) lm0) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk204" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk204"><span class="nb">unfold</span> record_plural.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (add_plural (fst (tr i) n) lm0) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk205" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk205"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> node_eqb n n0
 <span class="kr">then</span> fst (tr (S i)) n0
 <span class="kr">else</span>
  <span class="kr">if</span> is_member n participants
  <span class="kr">then</span> add_plural (fst (tr i) n) lm0
  <span class="kr">else</span> fst (tr i) n, lm0 ++ snd (tr i))</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>node_eqb n n0 = false</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">out_messages (fst (tr i) n) =
out_messages (fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk206" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk206">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br><span><var>H_eq_one</var><span class="hyp-type"><b>: </b><span>out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk207" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk207"><span class="nb">rewrite</span> H_eq_one <span class="kr">in</span> H_new.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_neq</var><span class="hyp-type"><b>: </b><span>n &lt;&gt; n0</span></span></span><br><span><var>H_eq_one</var><span class="hyp-type"><b>: </b><span>out_messages (fst (tr (S i)) n) =
out_messages (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk208" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk208"><span class="kn">Lemma</span> <span class="nf">delivered_means_sender_made_transition</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>, protocol_trace tr -&gt;
   <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">msg</span> (<span class="nv">n0</span> : node) (<span class="nv">lm0</span> : list message),
    In msg lm0 -&gt;
    In n0 participants -&gt;
    <span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
     get_transition p0 (fst (tr i) n0) msg0 (fst (tr (S i)) n0) lm0 -&gt;
    tr (S i) = broadcast_messages (tr i) (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
    get_sender msg = n0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n0</span> : node)
  (<span class="nv">lm0</span> : list message),
In msg lm0 -&gt;
In n0 participants -&gt;
<span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt; get_sender msg = n0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk209" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk209"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n0</span> : node)
  (<span class="nv">lm0</span> : list message),
In msg lm0 -&gt;
In n0 participants -&gt;
<span class="kr">forall</span> (<span class="nv">p0</span> : NState_transition_type) (<span class="nv">msg0</span> : message),
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
tr (S i) =
broadcast_messages (tr i) (fst (tr i) n0)
  (fst (tr (S i)) n0) lm0 -&gt; get_sender msg = n0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20a"><span class="nb">intros</span> tr Htr i msg n0 lm0 H_fresh H_in0 p0 msg0 H_step H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_sender msg = n0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
    <span class="nb">assert</span> (H_step_copy := H_step); 
    <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_out H_rest]];
    <span class="nb">rewrite</span> H_out <span class="kr">in</span> H_fresh;
    <span class="nb">simpl</span> <span class="kr">in</span> H_fresh; 
    <span class="kp">try</span> (<span class="nb">subst</span>; <span class="bp">reflexivity</span>);
    <span class="kp">try</span> (<span class="nb">destruct</span> H_fresh;
         <span class="nb">subst</span>;
         <span class="nb">unfold</span> get_sender; <span class="nb">simpl</span>; <span class="bp">reflexivity</span>);
    <span class="kp">repeat</span> <span class="nb">destruct</span> H_fresh <span class="kr">as</span> [H_fresh | H_fresh];
    <span class="kp">try</span> <span class="bp">contradiction</span>;
    <span class="kp">try</span> <span class="nb">rewrite</span> &lt;- H_fresh; <span class="nb">simpl</span> <span class="kr">in</span> *;
      <span class="kp">try</span> <span class="nb">rewrite</span> (protocol_trace_state_sane Htr);
      <span class="kp">try</span> <span class="bp">reflexivity</span>; 
      <span class="kp">try</span> <span class="bp">tauto</span>;
      <span class="kp">try</span> (<span class="nb">apply</span> pending_PrepareVote_correct <span class="kr">in</span> H_fresh;
           <span class="nb">destruct</span> H_fresh <span class="kr">as</span> [_ [H_fresh _]];
           <span class="nb">rewrite</span> H_fresh; <span class="nb">simpl</span> <span class="kr">in</span> *;
           <span class="nb">rewrite</span> (protocol_trace_state_sane Htr); <span class="bp">reflexivity</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20b"><span class="kn">Lemma</span> <span class="nf">global_local_out_if</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">msg</span> <span class="nv">n</span>,
      In n participants -&gt;
      In msg (filter (<span class="kr">fun</span> <span class="nv">msg</span> =&gt; node_eqb (get_sender msg) n) (snd (tr i))) -&gt;
      In msg (out_messages (fst (tr i) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n</span> : node),
In n participants -&gt;
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0) n) (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n</span> : node),
In n participants -&gt;
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0) n) (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20d"><span class="nb">intros</span> tr Htr i msg n H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20e"><span class="nb">pose proof</span> Htr <span class="kr">as</span> Htr&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>Htr</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i)))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk20f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk20f"><span class="nb">destruct</span> Htr <span class="kr">as</span> [H_init H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i)))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk210" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk210"><span class="nb">induction</span> i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr <span class="mi">0</span>)))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk211" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk211"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk212" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk212">- <span class="c">(* Base case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr <span class="mi">0</span>)))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk213" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk213"><span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd GState_init))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk214" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk214">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small></span><span class="alectryon-wsp"> <span class="c">(* IH says if it&#39;s in the global out messages in the previous state, then it&#39;s in the</span>
<span class="c">       local out messages in the previous state. *)</span>
    <span class="c">(* Either it&#39;s in the global out messages in the previous state, or it&#39;s not, </span>
<span class="c">       meaning it was newly sent *)</span>
    <span class="c">(* Then it must be in the out messages by case analysis on the transitions *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk215" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk215"><span class="nb">destruct</span> (In_dec message_eq_dec msg
      (filter (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt; node_eqb (get_sender msg) n) (snd (tr i)))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk216" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk216"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk217" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk217">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk218" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk218">spec IHi H_old.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> out_messages_global_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk219" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk219">+ <span class="c">(* msg was not in n&#39;s part of the global out message buffer in state (tr i) *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>IHi</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n) 
     (snd (tr i))) -&gt;
In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      <span class="c">(* But it is in n&#39;s part of the global out message buffer in state (tr (S i)) *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21a"><span class="nb">clear</span> IHi.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr (S i))))</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21b"><span class="nb">apply</span> filter_In <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i))) /\
node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21c"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in H_sender].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      <span class="c">(* First we establish that n is the sender *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21d"><span class="nb">assert</span> (H_useful := filter_In (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt; node_eqb (get_sender msg) n) msg (snd (tr i))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      node_eqb (get_sender msg) n)
     (snd (tr i))) &lt;-&gt;
In msg (snd (tr i)) /\
(<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
 node_eqb (get_sender msg) n) msg = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21e"><span class="nb">assert</span> (~ In msg (snd (tr i)) \/
              ~ (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt; node_eqb (get_sender msg) n) msg = true) <span class="bp">by</span> <span class="bp">tauto</span>; <span class="nb">clear</span> H_useful H_new.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i)) \/
(<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt; node_eqb (get_sender msg) n)
  msg &lt;&gt; true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk21f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk21f"><span class="nb">destruct</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk220" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n &lt;&gt; true</span></span></span><br></div><label class="goal-separator" for="global-v-chk220"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk221" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk221"><span class="mi">2</span> : <span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      <span class="c">(* Based on H and H_in, msg must have been newly added *)</span>  
      <span class="c">(* Therefore, whatever transition happened, n must have made the transition *)</span> 
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk222" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk222">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk223" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk223"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk224" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk224"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk225" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk225">* <span class="c">(* In the transition case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk226" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk226"><span class="nb">destruct</span> (node_eq_dec n0 n) <span class="kr">as</span> [H_true | H_false].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk227" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk227"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk228" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk228">** <span class="c">(* In the case that n made the transition *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk229" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk229"><span class="nb">rewrite</span> H_true <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22a"><span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (snd
     (broadcast_messages 
        (tr i) (fst (tr i) n)
        (fst (tr (S i)) n) lm0))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22b"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (lm0 ++ snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22c"><span class="nb">rewrite</span> in_app_iff <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0 \/ In msg (snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22d"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_fresh | H_old].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk22e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk22e"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk22f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk22f"><span class="mi">2</span> : <span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_true</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> (delivered_means_sent_local Htr&#39; i msg n H_fresh H_part p0 msg0 H_step H_deliver).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk230" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk230">** <span class="c">(* In the case that n didn&#39;t make the transition *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk231" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk231"><span class="nb">exfalso</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk232" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk232"><span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (snd
     (broadcast_messages 
        (tr i) (fst (tr i) n0)
        (fst (tr (S i)) n0) lm0))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk233" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk233"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (lm0 ++ snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk234" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk234"><span class="nb">rewrite</span> in_app_iff <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0 \/ In msg (snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk235" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk235"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_fresh | H_old].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk236" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk236"><hr></label><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk237" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk237"><span class="mi">2</span> : <span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk238" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk238"><span class="nb">assert</span> (get_sender msg = n0) <span class="bp">by</span>
           <span class="nb">apply</span> (delivered_means_sender_made_transition Htr&#39; i msg n0 H_fresh H_in0 p0 msg0 H_step H_deliver).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_sender msg = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk239" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk239"><span class="nb">apply</span> node_eqb_correct <span class="kr">in</span> H_sender.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_fresh</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>get_sender msg = n</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_false</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>get_sender msg = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">subst</span>; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23a">* <span class="c">(* In the timeout case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23b"><span class="nb">assert</span> (snd (tr i) = snd (tr (S i))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">snd (tr i) = snd (tr (S i))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk23c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>snd (tr i) = snd (tr (S i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk23c"><hr></label><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23d">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">snd (tr i) = snd (tr (S i))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23e"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">snd (tr i) = snd (tr (S i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk23f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk23f"><span class="nb">rewrite</span> H_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">snd (tr i) =
snd
  (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
   <span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n, snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk240" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk240"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">snd (tr i) = snd (tr i)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk241" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk241">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>snd (tr i) = snd (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk242" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk242"><span class="nb">rewrite</span> H0 <span class="kr">in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_sender</var><span class="hyp-type"><b>: </b><span>node_eqb (get_sender msg) n = true</span></span></span><br><span><var>Htr'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr (S i)))</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>snd (tr i) = snd (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (out_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk243" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk243"><span class="kn">Lemma</span> <span class="nf">local_global_out_if</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">msg</span> <span class="nv">n</span>,
      In n participants -&gt;
      In msg (out_messages (fst (tr i) n)) -&gt; 
      In msg (snd (tr i)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n</span> : node),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk244" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk244"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message) (<span class="nv">n</span> : node),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk245" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk245"><span class="nb">intros</span> tr H_prot i msg n H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk246" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk246"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk247" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk247"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk248" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk248">- <span class="c">(* Base case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk249" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk249"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst GState_init n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr <span class="mi">0</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk24a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk24a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk24b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk24b"><span class="nb">destruct</span> (In_dec message_eq_dec msg (out_messages (fst (tr i) n))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk24c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk24c"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk24d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk24d">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">spec IH_prot H_old;
        <span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk24e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk24e">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n)) -&gt;
In msg (snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk24f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk24f"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk250" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk250"><span class="nb">assert</span> (H_useful := out_messages_change_means_sent).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk251" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk251"><span class="nb">pose proof</span> H_prot <span class="kr">as</span> H_prot&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk252" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk252"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [_ H_prot];
        spec H_prot i;
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk253" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk253"><hr></label><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk254" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk254">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk255" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk255"><span class="nb">assert</span> (In msg lm0) <span class="bp">by</span>
         <span class="bp">now</span> <span class="nb">apply</span> (H_useful _ H_prot&#39; _ _ _ msg0 lm0 H_in0 H_deliver H_step n H_part msg H_in H_new).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk256" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk256"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (snd
     (broadcast_messages 
        (tr i) (fst (tr i) n0) 
        (fst (tr (S i)) n0) lm0))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk257" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk257"><span class="nb">unfold</span> broadcast_messages; <span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (lm0 ++ snd (tr i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> in_app_iff; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk258" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk258">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk259" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk259"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_in; <span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (<span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25a"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part;
          <span class="nb">rewrite</span> H_part <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages (flip_timeout (fst (tr i) n)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n0</span> : node)
  (<span class="nv">p0</span> : NState_transition_type)
  (<span class="nv">msg0</span> : message) (<span class="nv">lm0</span> : list message),
In n0 participants -&gt;
tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0 -&gt;
get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0 -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr (S i)) n)) -&gt;
~ In msg (out_messages (fst (tr i) n)) -&gt;
In msg lm0</span></span></span><br><span><var>H_prot'</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25b"><span class="kn">Lemma</span> <span class="nf">message_type_PrepareVote</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">n</span> <span class="nv">msg1</span> <span class="nv">b1</span>,
    protocol_trace tr -&gt; 
    In msg1 (processed_PrepareVote_in_view_about_block (fst (tr i) n) (node_view (fst (tr i) n)) b1) -&gt;
    get_message_type msg1 = PrepareVote.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg1</span> : message) (<span class="nv">b1</span> : block),
protocol_trace tr -&gt;
In msg1
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) (node_view (fst (tr i) n)) b1) -&gt;
get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg1</span> : message) (<span class="nv">b1</span> : block),
protocol_trace tr -&gt;
In msg1
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) (node_view (fst (tr i) n)) b1) -&gt;
get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25d"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>In msg1
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) (node_view (fst (tr i) n)) b1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25e"><span class="nb">apply</span> filter_In <span class="kr">in</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>In msg1 (counting_messages (fst (tr i) n)) /\
message_type_eqb (get_message_type msg1)
  PrepareVote &amp;&amp; block_eqb (get_block msg1) b1 &amp;&amp;
(get_view msg1 =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk25f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk25f"><span class="nb">destruct</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>In msg1 (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg1)
  PrepareVote &amp;&amp; block_eqb (get_block msg1) b1 &amp;&amp;
(get_view msg1 =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk260" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk260"><span class="kp">repeat</span> (<span class="nb">apply</span> andb_prop <span class="kr">in</span> H1; <span class="nb">destruct</span> H1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>In msg1 (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg1)
  PrepareVote = true</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>block_eqb (get_block msg1) b1 = true</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>(get_view msg1 =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk261" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk261"><span class="nb">apply</span> message_type_eqb_correct <span class="kr">in</span> H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg1</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>In msg1 (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>get_message_type msg1 = PrepareVote</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>block_eqb (get_block msg1) b1 = true</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>(get_view msg1 =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg1 = PrepareVote</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk262" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk262"><span class="kn">Lemma</span> <span class="nf">view_same_or_plus_one</span> : 
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
    protocol_trace tr -&gt;
    In n participants -&gt;
    node_view (fst (tr i) n) = node_view (fst (tr (S i)) n) \/
    S (node_view (fst (tr i) n)) = node_view (fst (tr (S i)) n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
protocol_trace tr -&gt;
In n participants -&gt;
node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk263" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk263"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
protocol_trace tr -&gt;
In n participants -&gt;
node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk264" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk264"><span class="nb">intros</span> tr i n H_prot H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk265" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk265"><span class="nb">pose proof</span> H_prot <span class="kr">as</span> H_prot_copy.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk266" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk266"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [_ H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk267" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk267">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk268" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk268"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk269" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk269"><hr></label><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26a">- <span class="c">(* In the normal transition case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26b"><span class="nb">destruct</span> (node_eq_dec n0 n) <span class="kr">as</span> [H_same | H_diff].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk26c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><label class="goal-separator" for="global-v-chk26c"><hr></label><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26d">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26e"><span class="nb">rewrite</span> H_same <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> p0;
      <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update _];
      <span class="nb">rewrite</span> H_update; <span class="nb">simpl</span>; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk26f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk26f">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk270" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk270"><span class="nb">left</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk271" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk271"><span class="nb">rewrite</span> H_deliver.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (fst
     (broadcast_messages 
        (tr i) (fst (tr i) n0) 
        (fst (tr (S i)) n0) lm0) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk272" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk272"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n (node_id (fst (tr i) n0))
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk273" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk273"><span class="nb">rewrite</span> (protocol_trace_state_sane H_prot_copy).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n n0
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk274" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk274"><span class="nb">rewrite</span> node_eqb_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>n0 &lt;&gt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n0 n
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk275" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk275"><span class="nb">apply</span> node_eqb_no <span class="kr">in</span> H_diff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> node_eqb n0 n
   <span class="kr">then</span> fst (tr (S i)) n0
   <span class="kr">else</span>
    <span class="kr">if</span> is_member n participants
    <span class="kr">then</span> add_plural (fst (tr i) n) lm0
    <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk276" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk276"><span class="nb">rewrite</span> H_diff.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk277" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk277"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> add_plural (fst (tr i) n) lm0
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk278" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk278"><span class="nb">rewrite</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_diff</var><span class="hyp-type"><b>: </b><span>node_eqb n0 n = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (add_plural (fst (tr i) n) lm0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk279" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk279">- <span class="c">(* In the timeout case *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n) \/
S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27a"><span class="nb">left</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27b"><span class="nb">rewrite</span> H_timeout.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (fst
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n, 
      snd (tr i)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27c"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27d"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view
  (<span class="kr">if</span> is_member n participants
   <span class="kr">then</span> flip_timeout (fst (tr i) n)
   <span class="kr">else</span> fst (tr i) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27e"><span class="nb">rewrite</span> H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>is_member n participants = true</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_view (fst (tr i) n) =
node_view (flip_timeout (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk27f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk27f"><span class="kn">Lemma</span> <span class="nf">counting_messages_inclusion</span>:
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">msg</span> : message),
    protocol_trace tr -&gt;
    In n participants -&gt;
    i &lt;= j -&gt; 
    In msg (counting_messages (fst (tr i) n)) -&gt;
    In msg (counting_messages (fst (tr j) n)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
i &lt;= j -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr j) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk280" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk280"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node)
  (<span class="nv">msg</span> : message),
protocol_trace tr -&gt;
In n participants -&gt;
i &lt;= j -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In msg (counting_messages (fst (tr j) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk281" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk281"><span class="nb">intros</span> tr i j n msg H_prot H_part H_view H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk282" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk282"><span class="nb">induction</span> j <span class="kr">as</span> [|j IHj].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= <span class="mi">0</span></span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk283" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk283"><hr></label><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk284" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk284">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= <span class="mi">0</span></span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk285" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk285"><span class="nb">inversion</span> H_view.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= <span class="mi">0</span></span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i = <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk286" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk286"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr <span class="mi">0</span>) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in;
      <span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk287" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk287">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk288" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk288"><span class="nb">assert</span> (i &lt;= j \/ i = S j) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i &lt;= j \/ i = S j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk289" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk289"><span class="nb">destruct</span> H <span class="kr">as</span> [H_le | H_eq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk28a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i = S j</span></span></span><br></div><label class="goal-separator" for="global-v-chk28a"><hr></label><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28c">spec IHj H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr j) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_monotonic.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28d">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>i &lt;= S j</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>i &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i = S j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28e"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IHj</var><span class="hyp-type"><b>: </b><span>S j &lt;= j -&gt;
In msg (counting_messages (fst (tr j) n))</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr (S j)) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S j &lt;= S j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr (S j)) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> </span></span></pre><div class="doc">
For any two states with views v and (S v), we can always find the exact two
intermediate states where that view change occurred. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk28f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk28f"><span class="kn">Lemma</span> <span class="nf">wedged_in_between</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node),
      In n participants -&gt;
      i &lt; j -&gt;
      S (node_view (fst (tr i) n)) = node_view (fst (tr j) n) -&gt;
      <span class="kr">exists</span> (<span class="nv">x</span> : nat),
        i &lt;= x &lt;= j /\
        node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
        node_view (fst (tr (S x)) n) = node_view (fst (tr j) n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk290" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk290"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> <span class="nv">j</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk291" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk291"><span class="nb">intros</span> tr H_prot i j n H_part H_past H_view.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk292" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk292"><span class="nb">induction</span> j <span class="kr">as</span> [|j IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; <span class="mi">0</span></span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= <span class="mi">0</span> /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr <span class="mi">0</span>) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk293" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk293"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk294" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk294">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; <span class="mi">0</span></span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= <span class="mi">0</span> /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr <span class="mi">0</span>) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> H_past.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk295" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk295">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk296" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk296"><span class="nb">destruct</span> (view_same_or_plus_one j n H_prot H_part) <span class="kr">as</span> [H_j_same | H_j_next].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk297" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr j) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk297"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk298" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk298">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk299" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk299"><span class="nb">assert</span> (i &lt; j \/ i = j) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i &lt; j \/ i = j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk29a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk29a"><span class="nb">destruct</span> H <span class="kr">as</span> [H_lt | H_eq].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk29b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i = j</span></span></span><br></div><label class="goal-separator" for="global-v-chk29b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk29c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk29c">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk29d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk29d">spec IH_prot H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk29e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk29e">spec IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk29f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk29f"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a0"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a1"><span class="nb">destruct</span> IH_prot <span class="kr">as</span> [x [H_rel [H_view1 H_view2]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>i &lt; j</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_rel</var><span class="hyp-type"><b>: </b><span>i &lt;= x &lt;= j</span></span></span><br><span><var>H_view1</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr x) n) =
node_view (fst (tr i) n)</span></span></span><br><span><var>H_view2</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S x)) n) =
node_view (fst (tr j) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">x</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a2">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr j) n) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>i = j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">subst</span>; <span class="bp">lia</span>.</span><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a3">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i &lt; j -&gt;
S (node_view (fst (tr i) n)) =
node_view (fst (tr j) n) -&gt;
<span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= j /\
  node_view (fst (tr x) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr j) n)</span></span></span><br><span><var>H_j_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr j) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a4"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i, j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i &lt; S j</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br><span><var>H_j_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr j) n)) =
node_view (fst (tr (S j)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">x</span> : nat,
  i &lt;= x &lt;= S j /\
  node_view (fst (tr x) n) = node_view (fst (tr i) n) /\
  node_view (fst (tr (S x)) n) =
  node_view (fst (tr (S j)) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">j</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
For any view smaller than the current view for any node, we can find
the state at which that view change occurred 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a5"><span class="kn">Lemma</span> <span class="nf">strongly_wedged_in_between</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
      In n participants -&gt;
      <span class="kr">forall</span> (<span class="nv">v_past</span> : nat),
        v_past &lt; node_view (fst (tr i) n) -&gt;
        <span class="kr">exists</span> (<span class="nv">i_past</span> : nat),
        i_past &lt; i /\
        node_view (fst (tr i_past) n) = v_past /\
        node_view (fst (tr (S i_past)) n) = S v_past.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">v_past</span> : nat,
v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">v_past</span> : nat,
v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a7"><span class="nb">intros</span> tr H_prot i n H_part v_past H_past.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2a8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2a8"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; <span class="mi">0</span> /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2a9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><label class="goal-separator" for="global-v-chk2a9"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2aa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2aa">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; <span class="mi">0</span> /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_past;
      <span class="nb">inversion</span> H_past.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ab" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ab">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ac" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ac"><span class="nb">destruct</span> (view_same_or_plus_one i n H_prot H_part) <span class="kr">as</span> [H_i_same | H_i_next].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2ad" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk2ad"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ae" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ae">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2af" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2af">spec IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v_past &lt; node_view (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2b0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><label class="goal-separator" for="global-v-chk2b0"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b1"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b2"><span class="nb">destruct</span> IH_prot <span class="kr">as</span> [x [H_rel [H_view1 H_view2]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_i_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_rel</var><span class="hyp-type"><b>: </b><span>x &lt; i</span></span></span><br><span><var>H_view1</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr x) n) = v_past</span></span></span><br><span><var>H_view2</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S x)) n) = S v_past</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">x</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b3">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr (S i)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b4"><span class="nb">rewrite</span> &lt;- H_i_next <span class="kr">in</span> H_past.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b5"><span class="nb">assert</span> (v_past = node_view (fst (tr i) n) \/ v_past &lt; node_view (fst (tr i) n)) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>v_past = node_view (fst (tr i) n) \/
v_past &lt; node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b6"><span class="nb">destruct</span> H <span class="kr">as</span> [H_eq | H_lt].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>v_past = node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2b7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk2b7"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b8">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>v_past = node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2b9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2b9"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;
node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S i_past)) n) =
  S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;
S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S i_past)) n) =
  S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ba" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ba"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i) n) &lt;
S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) =
  node_view (fst (tr i) n) /\
  node_view (fst (tr (S i_past)) n) =
  S (node_view (fst (tr i) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">i</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2bb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2bb">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2bc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2bc">spec IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n) -&gt;
<span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v_past &lt; node_view (fst (tr i) n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2bd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><label class="goal-separator" for="global-v-chk2bd"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2be" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2be"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) =
  S v_past</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2bf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2bf"><span class="nb">destruct</span> IH_prot <span class="kr">as</span> [x [H_rel [H_view1 H_view2]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt; S (node_view (fst (tr i) n))</span></span></span><br><span><var>H_i_next</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i) n)) =
node_view (fst (tr (S i)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>v_past &lt; node_view (fst (tr i) n)</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_rel</var><span class="hyp-type"><b>: </b><span>x &lt; i</span></span></span><br><span><var>H_view1</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr x) n) = v_past</span></span></span><br><span><var>H_view2</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr (S x)) n) = S v_past</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; S i /\
  node_view (fst (tr i_past) n) = v_past /\
  node_view (fst (tr (S i_past)) n) = S v_past</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">x</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">lia</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c0"><span class="kn">Lemma</span> <span class="nf">state_view_morphism</span>:
  <span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
  protocol_trace tr -&gt;
  <span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
    In n participants -&gt;
    node_view (fst (tr i1) n) &lt; node_view (fst (tr i2) n) -&gt; 
    i1 &lt; i2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
node_view (fst (tr i1) n) &lt; node_view (fst (tr i2) n) -&gt;
i1 &lt; i2</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
node_view (fst (tr i1) n) &lt; node_view (fst (tr i2) n) -&gt;
i1 &lt; i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c2"><span class="nb">intros</span> tr H_prot i1 i2 n H_part H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; i2</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c3"><span class="nb">induction</span> i2 <span class="kr">as</span> [|i2 IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2c4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br></div><label class="goal-separator" for="global-v-chk2c4"><hr></label><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c6"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr <span class="mi">0</span>) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c7"><span class="nb">rewrite</span> H_init <span class="kr">in</span> H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_init</var><span class="hyp-type"><b>: </b><span>tr <span class="mi">0</span> = GState_init</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst GState_init n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> H_lt.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2c9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2c9"><span class="nb">destruct</span> (view_same_or_plus_one i2 n H_prot H_part) <span class="kr">as</span> [H_same | H_incr].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i2) n) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2ca" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk2ca"><hr></label><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2cb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2cb">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i2) n) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2cc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2cc"><span class="nb">rewrite</span> &lt;- H_same <span class="kr">in</span> H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i2) n) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2cd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2cd">spec IH_prot H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br><span><var>H_same</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i2) n) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>i1 &lt; i2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ce" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ce">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2cf" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2cf"><span class="nb">rewrite</span> &lt;- H_incr <span class="kr">in</span> H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
S (node_view (fst (tr i2) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d0"><span class="nb">assert</span> (node_view (fst (tr i1) n) = node_view (fst (tr i2) n) \/
              node_view (fst (tr i1) n) &lt; node_view (fst (tr i2) n)) <span class="bp">by</span> <span class="bp">lia</span>; <span class="nb">clear</span> H_lt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n) \/
node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d1"><span class="nb">destruct</span> H <span class="kr">as</span> [H_eq | H_lt].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2d2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk2d2"><hr></label><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d3">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d4"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        <span class="c">(* View change occurred from i2 to S i2 *)</span>
        <span class="c">(* i1 is in the same view as i2 *)</span>
</span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d5"><span class="nb">rewrite</span> &lt;- H_eq <span class="kr">in</span> H_incr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d6"><span class="nb">assert</span> (node_view (fst (tr i1) n) &lt; node_view (fst (tr (S i2)) n)) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d7"><span class="nb">assert</span> (H_useful := view_state_morphism).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i1</span> <span class="nv">i2</span> : nat) (<span class="nv">n</span> : node),
In n participants -&gt;
i1 &lt;= i2 -&gt;
node_view (fst (tr i1) n) &lt;=
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d8">spec H_useful tr H_prot (S i2) i1 n H_part.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>S i2 &lt;= i1 -&gt;
node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr i1) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2d9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2d9"><span class="nb">apply</span> modus_tollens <span class="kr">in</span> H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>~ S i2 &lt;= i1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2da" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>S i2 &lt;= i1 -&gt;
node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr i1) n)</span></span></span><br></div><label class="goal-separator" for="global-v-chk2da"><hr></label><div class="goal-conclusion">~
node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr i1) n)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2db" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2db"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i1) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_eq</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) =
node_view (fst (tr i2) n)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>S i2 &lt;= i1 -&gt;
node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr i1) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">~
node_view (fst (tr (S i2)) n) &lt;=
node_view (fst (tr i1) n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2dc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2dc">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i1, i2</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n) -&gt; 
i1 &lt; i2</span></span></span><br><span><var>H_incr</var><span class="hyp-type"><b>: </b><span>S (node_view (fst (tr i2) n)) =
node_view (fst (tr (S i2)) n)</span></span></span><br><span><var>H_lt</var><span class="hyp-type"><b>: </b><span>node_view (fst (tr i1) n) &lt;
node_view (fst (tr i2) n)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">i1 &lt; S i2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">spec IH_prot H_lt; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2dd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2dd"><span class="kn">Lemma</span> <span class="nf">participation_rights_global</span> :
    <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
      protocol_trace tr -&gt;
      <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
        In msg (snd (tr i)) -&gt;
        In (get_sender msg) participants.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2de" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2de"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2df" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2df"><span class="nb">intros</span> tr H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e0"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot]; <span class="nb">intros</span> msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr <span class="mi">0</span>))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2e1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2e1"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr <span class="mi">0</span>))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in;
      <span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e4"><span class="nb">destruct</span> (In_dec message_eq_dec msg (snd (tr i))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2e5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2e5"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e6">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> IH_prot.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e7">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2e8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2e8"><span class="nb">assert</span> (H_prot_copy := H_prot); 
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [_ H_prot];
        spec H_prot i;
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2e9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2e9"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ea" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ea"><span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (snd
     (broadcast_messages 
        (tr i) (fst (tr i) n0)
        (fst (tr (S i)) n0) lm0))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2eb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2eb"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ec" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ec"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (lm0 ++ snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2ed" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2ed"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ee" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ee"><span class="nb">apply</span> in_app_iff <span class="kr">in</span> H_in;
        <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in | H_in];
        <span class="kp">try</span> <span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2ef" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2ef"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f0"><span class="nb">assert</span> (get_sender msg = n0) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> delivered_means_sender_made_transition <span class="kr">with</span> tr i lm0 p0 msg0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>get_sender msg = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2f1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2f1"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f2"><span class="nb">rewrite</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>get_sender msg = n0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In n0 participants</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk2f3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk2f3"><hr></label><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f4"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f5"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (snd
     (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
      <span class="kr">if</span> is_member n participants
      <span class="kr">then</span> flip_timeout (fst (tr i) n)
      <span class="kr">else</span> fst (tr i) n, 
      snd (tr i)))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f6"><span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
In (get_sender msg) participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f7"><span class="kn">Lemma</span> <span class="nf">participation_rights</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
      In n participants -&gt;
      In msg (counting_messages (fst (tr i) n)) -&gt;
      In (get_sender msg) participants.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (counting_messages (fst (tr i) n)) -&gt;
In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2f9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2f9"><span class="nb">intros</span> tr H_prot n i msg H_part H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2fa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2fa"><span class="nb">apply</span> processed_means_sent_global <span class="kr">in</span> H_in;
    <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In (get_sender msg) participants</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> participation_rights_global <span class="kr">with</span> tr i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> </span></span></pre><div class="doc">
Any message property that holds for processed messages holds for sent messages 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2fb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2fb"><span class="kn">Lemma</span> <span class="nf">lift_sent_to_received</span> :
  <span class="kr">forall</span> (<span class="nv">P</span> : message -&gt; <span class="kt">Prop</span>), 
    (<span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
        protocol_trace tr -&gt;
        <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
          In n participants -&gt;
          <span class="kr">forall</span> (<span class="nv">msg</span> : message),
            In msg (out_messages (fst (tr i) n)) -&gt;
            P msg) -&gt;
    (<span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
        protocol_trace tr -&gt;
        <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
          In n participants -&gt;
          <span class="kr">forall</span> (<span class="nv">msg</span> : message),
            In msg (counting_messages (fst (tr i) n)) -&gt;
            P msg).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : message -&gt; <span class="kt">Prop</span>,
(<span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
 protocol_trace tr -&gt;
 <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
 In n participants -&gt;
 <span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg (out_messages (fst (tr i) n)) -&gt; P msg) -&gt;
<span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (counting_messages (fst (tr i) n)) -&gt; P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2fc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2fc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : message -&gt; <span class="kt">Prop</span>,
(<span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
 protocol_trace tr -&gt;
 <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
 In n participants -&gt;
 <span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg (out_messages (fst (tr i) n)) -&gt; P msg) -&gt;
<span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (counting_messages (fst (tr i) n)) -&gt; P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2fd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2fd"><span class="nb">intros</span> P H_helper tr H_prot n i H_part msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* n processed msg -&gt; n received msg *)</span> 
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2fe" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2fe"><span class="nb">assert</span> (H_useful := processed_means_past_received H_prot i n msg H_part H_in).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i_past</span> : nat,
  i_past &lt; i /\
  In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk2ff" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk2ff"><span class="nb">destruct</span> H_useful <span class="kr">as</span> [i_past [H_past H_received]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  <span class="c">(* n received msg -&gt; msg in global sent buffer *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk300" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk300"><span class="nb">assert</span> (H_useful2 := delivered_means_sent_global H_prot i_past n msg H_part H_received).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk301" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk301"><span class="nb">assert</span> (H_part_sender : In (get_sender msg) participants) <span class="bp">by</span> <span class="bp">now</span> <span class="nb">apply</span> (participation_rights H_prot n i msg H_part H_in).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* msg in global sent buffer -&gt; msg in local sent buffer *)</span>  
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk302" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk302"><span class="nb">assert</span> (H_useful3 := @global_local_out_if tr H_prot i_past msg (get_sender msg) H_part_sender).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0)
        (get_sender msg))
     (snd (tr i_past))) -&gt;
In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk303" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk303">spec H_useful3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0)
        (get_sender msg))
     (snd (tr i_past))) -&gt;
In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0) (get_sender msg))
     (snd (tr i_past)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk304" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk304"><hr></label><div class="goal-conclusion">P msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk305" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk305"><span class="nb">apply</span> filter_In; <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">easy</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      node_eqb (get_sender msg0)
        (get_sender msg))
     (snd (tr i_past))) -&gt;
In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">node_eqb (get_sender msg) (get_sender msg) = true</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk306" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk306"><hr></label><div class="goal-conclusion">P msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk307" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk307"><span class="bp">now</span> <span class="nb">rewrite</span> node_eqb_refl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>message -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>H_helper</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
P msg</span></span></span><br><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>i_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>i_past &lt; i</span></span></span><br><span><var>H_received</var><span class="hyp-type"><b>: </b><span>In msg (in_messages (fst (tr i_past) n))</span></span></span><br><span><var>H_useful2</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i_past))</span></span></span><br><span><var>H_part_sender</var><span class="hyp-type"><b>: </b><span>In (get_sender msg) participants</span></span></span><br><span><var>H_useful3</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (fst (tr i_past) (get_sender msg)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* Now apply assumption *)</span> 
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> H_helper <span class="kr">with</span> tr (get_sender msg) i_past.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk308" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk308"><span class="kn">Lemma</span> <span class="nf">sent_PrepareVote_means_received_PrepareBlock</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
      In n participants -&gt;
      In msg (out_messages (fst (tr i) n)) -&gt;
      get_message_type msg = PrepareVote -&gt; 
      <span class="kr">exists</span> (<span class="nv">msg&#39;</span> : message),
        In msg&#39; (counting_messages (fst (tr i) n)) /\
        get_message_type msg&#39; = PrepareBlock /\
        get_block msg&#39;= get_block msg /\
        get_view msg&#39; = get_view msg.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk309" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk309"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In n participants -&gt;
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">         
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30a"><span class="nb">intros</span> tr H_prot n i msg H_part H_sent H_type.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30b"><span class="nb">generalize dependent</span> msg.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30c"><span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot]; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr <span class="mi">0</span>) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk30d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br></div><label class="goal-separator" for="global-v-chk30d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr <span class="mi">0</span>) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr <span class="mi">0</span>) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_sent;
      <span class="nb">inversion</span> H_sent.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk30f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk30f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk310" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk310"><span class="nb">destruct</span> (In_dec message_eq_dec msg (out_messages (fst (tr i) n))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk311" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><label class="goal-separator" for="global-v-chk311"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk312" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk312">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk313" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk313">spec IH_prot msg H_old H_type.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk314" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk314"><span class="nb">destruct</span> IH_prot <span class="kr">as</span> [msg&#39; IH_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; = get_block msg /\
get_view msg&#39; = get_view msg</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk315" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk315"><span class="kr">exists</span> <span class="nv">msg&#39;</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; = get_block msg /\
get_view msg&#39; = get_view msg</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_monotonic.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk316" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk316">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (out_messages (fst (tr i) n)) -&gt;
get_message_type msg = PrepareVote -&gt;
<span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr i) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk317" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk317"><span class="nb">clear</span> IH_prot.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk318" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk318"><span class="nb">assert</span> (H_prot_copy := H_prot); 
        <span class="nb">destruct</span> H_prot <span class="kr">as</span> [_ H_prot].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat,
GState_transition (tr n) (tr (S n))</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk319" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk319">spec H_prot i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>GState_transition (tr i) (tr (S i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk31a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk31a"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk31b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk31b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      <span class="c">(* Establishing that n must be in lm0 *)</span> 
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk31c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk31c"><span class="nb">assert</span> (In msg lm0).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg lm0</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk31d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk31d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk31e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk31e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk31f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk31f"><span class="nb">apply</span> (out_messages_change_means_sent H_prot_copy _ _ _ _ H_in0 H_deliver H_step _ H_part); <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk320" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk320"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk321" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk321"><span class="nb">assert</span> (n0 = n).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n0 = n</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk322" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk322"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk323" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk323"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk324" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk324"><span class="nb">apply</span> (out_message_change_tells_sender H_prot_copy _ _ _ _ H_in0 H_deliver H_step n H_part).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (out_messages (fst (tr (S i)) n)) /\
  ~ In msg (out_messages (fst (tr i) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk325" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><label class="goal-separator" for="global-v-chk325"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk326" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk326"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk327" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk327"><span class="kr">exists</span> <span class="nv">msg</span>; <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk328" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk328"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk329" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk329"><span class="nb">rewrite</span> H0 <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n) msg0
  (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk32a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk32a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      <span class="c">(* Case analysis on transition made from i ~~&gt; S i *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk32b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk32b"><span class="nb">destruct</span> p0;
        <span class="nb">assert</span> (H_step_copy := H_step);
        <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_broadcast H_rest]];
        <span class="nb">rewrite</span> H_broadcast <span class="kr">in</span> H;
        <span class="kp">try</span> <span class="nb">apply</span> in_inv <span class="kr">in</span> H;
        <span class="c">(* For cases that do not send messages *)</span>
        <span class="kp">try</span> <span class="bp">tauto</span>;
        <span class="kp">try</span> (<span class="nb">apply</span> make_PrepareBlocks_message_type <span class="kr">in</span> H; 
             <span class="nb">rewrite</span> H_type <span class="kr">in</span> H; <span class="bp">discriminate</span>); 
        <span class="kp">repeat</span> <span class="nb">destruct</span> H <span class="kr">as</span> [H | H]; 
        <span class="kp">try</span> (<span class="nb">subst</span>; <span class="nb">rewrite</span> H_type <span class="kr">in</span> H_rest;
             <span class="nb">assert</span> (PrepareVote = PrepareQC) <span class="bp">by</span> <span class="bp">tauto</span>;
             <span class="bp">discriminate</span>);
        <span class="kp">try</span> (<span class="nb">rewrite</span> &lt;- H <span class="kr">in</span> H_type; <span class="bp">discriminate</span>);
        <span class="kp">try</span> <span class="nb">inversion</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk32c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk32c"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk32d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk32d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk32e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk32e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      <span class="c">(* In the three cases where voting actually occurs,</span>
<span class="c">       the existential witness is in H *)</span>  
      
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk32f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk32f"><span class="nb">apply</span> in_map_iff <span class="kr">in</span> H;
      <span class="nb">destruct</span> H <span class="kr">as</span> [msg&#39; [H_eq&#39; H_about_msg&#39;]];
      <span class="kr">exists</span> <span class="nv">msg&#39;</span>; <span class="nb">rewrite</span> &lt;- H_eq&#39;;
      <span class="nb">apply</span> filter_In <span class="kr">in</span> H_about_msg&#39;;
      <span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_in&#39; H_about_msg&#39;];
      <span class="nb">apply</span> andb_prop <span class="kr">in</span> H_about_msg&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_about_msg'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;)
  (get_block msg0) = true /\
message_type_eqb
  (get_message_type msg&#39;) PrepareBlock =
true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk330" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk330"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk331" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk331"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk332" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk332"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk333" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk333"><span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_view&#39; H_type&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk334" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk334"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk335" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk335"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk336" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk336"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk337" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk337"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true /\
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk338" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk338"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk339" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk339"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk33a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk33a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk33b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk33b"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk33c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk33c"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk33d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk33d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk33e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk33e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk33f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk33f"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true /\
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk340" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk340"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk341" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk341"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk342" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk342"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk343" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk343"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk344" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk344"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk345" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk345"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk346" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk346"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk347" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk347"><span class="nb">rewrite</span> message_type_eqb_correct <span class="kr">in</span> H_type&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk348" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk348"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk349" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk349"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk34a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk34a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk34b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk34b"><span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk34c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk34c"><hr></label><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk34d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk34d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk34e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk34e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk34f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk34f"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk350" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk350"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_monotonic.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk351" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk351"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk352" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk352"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk353" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk353"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk354" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk354"><span class="nb">unfold</span> view_valid <span class="kr">in</span> H_rest.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk355" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk355"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk356" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk356"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk357" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk357"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk358" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk358"><span class="nb">rewrite</span> Nat.eqb_eq <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk359" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk359"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk35a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk35a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk35b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk35b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk35c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk35c"><span class="nb">rewrite</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (make_PrepareQC (fst (tr i) n) msg0
      :: pending_PrepareVote 
           (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
make_PrepareQC (fst (tr i) n) msg0
:: pending_PrepareVote (fst (tr i) n)
     msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>honest_node (node_id (fst (tr i) n)) /\
received (fst (tr i) n) msg0 /\
get_message_type msg0 = PrepareVote /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~
exists_same_height_block 
  (fst (tr i) n) (get_block msg0) /\
vote_quorum_in_view
  (process (fst (tr i) n) msg0)
  (get_view msg0) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareVote_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg0 =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk35d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk35d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk35e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk35e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk35f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk35f"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk360" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk360"><span class="nb">symmetry</span>; <span class="bp">easy</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk361" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk361"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk362" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk362"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk363" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk363"><span class="nb">apply</span> in_map_iff <span class="kr">in</span> H;
      <span class="nb">destruct</span> H <span class="kr">as</span> [msg&#39; [H_eq&#39; H_about_msg&#39;]];
      <span class="kr">exists</span> <span class="nv">msg&#39;</span>; <span class="nb">rewrite</span> &lt;- H_eq&#39;;
      <span class="nb">apply</span> filter_In <span class="kr">in</span> H_about_msg&#39;;
      <span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_in&#39; H_about_msg&#39;];
      <span class="nb">apply</span> andb_prop <span class="kr">in</span> H_about_msg&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_about_msg'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;)
  (get_block msg0) = true /\
message_type_eqb
  (get_message_type msg&#39;) PrepareBlock =
true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk364" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk364"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk365" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk365"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk366" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk366"><span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_view&#39; H_type&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk367" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk367"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk368" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk368"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk369" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk369"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true /\
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk36a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk36a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk36b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk36b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk36c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk36c"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk36d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk36d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk36e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk36e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk36f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk36f"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true /\
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk370" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk370"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk371" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk371"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk372" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk372"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk373" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk373"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk374" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk374"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk375" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk375"><span class="nb">rewrite</span> message_type_eqb_correct <span class="kr">in</span> H_type&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk376" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk376"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk377" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk377"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk378" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk378"><span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk379" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk379"><hr></label><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk37a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk37a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk37b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk37b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk37c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk37c"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_monotonic.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
view_valid (fst (tr i) n) msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk37d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk37d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk37e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk37e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk37f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk37f"><span class="nb">unfold</span> view_valid <span class="kr">in</span> H_rest.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk380" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk380"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk381" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk381"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk382" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk382"><span class="nb">rewrite</span> Nat.eqb_eq <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk383" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk383"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk384" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk384"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk385" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk385"><span class="nb">rewrite</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
process
  (record_plural (fst (tr i) n)
     (pending_PrepareVote 
        (fst (tr i) n) msg0)) msg0</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareQC /\
node_view (fst (tr i) n) = get_view msg0 /\
<span class="kp">timeout</span> (fst (tr i) n) = false /\
~ last_block (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareQC_non_last_block_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg0 =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk386" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk386"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk387" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk387"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk388" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk388"><span class="nb">symmetry</span>; <span class="bp">easy</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk389" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk389"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk38a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk38a"><span class="nb">apply</span> in_map_iff <span class="kr">in</span> H;
      <span class="nb">destruct</span> H <span class="kr">as</span> [msg&#39; [H_eq&#39; H_about_msg&#39;]];
      <span class="kr">exists</span> <span class="nv">msg&#39;</span>; <span class="nb">rewrite</span> &lt;- H_eq&#39;;
      <span class="nb">apply</span> filter_In <span class="kr">in</span> H_about_msg&#39;;
      <span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_in&#39; H_about_msg&#39;];
      <span class="nb">apply</span> andb_prop <span class="kr">in</span> H_about_msg&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_about_msg'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;)
  (get_block msg0) = true /\
message_type_eqb
  (get_message_type msg&#39;) PrepareBlock =
true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk38b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk38b"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk38c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk38c"><span class="nb">destruct</span> H_about_msg&#39; <span class="kr">as</span> [H_view&#39; H_type&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) &amp;&amp;
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk38d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk38d"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk38e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk38e"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true /\
parent_ofb (get_block msg&#39;) (get_block msg0) =
true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk38f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk38f"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk390" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk390"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) &amp;&amp;
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk391" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk391"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk392" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk392"><span class="nb">apply</span> andb_prop <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true /\
negb
  (exists_same_height_blockb 
     (fst (tr i) n) (get_block msg&#39;)) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk393" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk393"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk394" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk394"><span class="nb">destruct</span> H_view&#39; <span class="kr">as</span> [H_view&#39; _].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg&#39;)
  PrepareBlock = true</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk395" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk395"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk396" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk396"><span class="nb">rewrite</span> message_type_eqb_correct <span class="kr">in</span> H_type&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
get_message_type msg&#39; = PrepareBlock /\
get_block msg&#39; =
get_block (make_PrepareVote (fst (tr i) n) msg0 msg&#39;) /\
get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk397" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk397"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk398" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk398"><span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg&#39; (counting_messages (fst (tr (S i)) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk399" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk399"><hr></label><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk39a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk39a"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk39b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk39b"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_monotonic.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
view_valid (fst (tr i) n) msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk39c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk39c"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk39d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk39d"><span class="nb">unfold</span> view_valid <span class="kr">in</span> H_rest.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
node_view (fst (tr i) n) = get_view msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>(get_view msg&#39; =? get_view msg0) = true</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk39e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk39e"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk39f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk39f"><span class="nb">rewrite</span> Nat.eqb_eq <span class="kr">in</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
node_view (fst (tr i) n) = get_view msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg&#39; =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3a0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3a0"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a1"><span class="nb">rewrite</span> H_view&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n =
record_plural (process (fst (tr i) n) msg0)
  (pending_PrepareVote (fst (tr i) n) msg0)</span></span></span><br><span><var>H_broadcast</var><span class="hyp-type"><b>: </b><span>lm0 =
pending_PrepareVote (fst (tr i) n) msg0</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n) msg0 /\
~ honest_node (node_id (fst (tr i) n)) /\
get_message_type msg0 = PrepareBlock /\
node_view (fst (tr i) n) = get_view msg0 /\
exists_same_height_block 
  (fst (tr i) n) (get_block msg0)</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n) (fst (tr (S i)) n) lm0</span></span></span><br><span><var>msg'</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_eq'</var><span class="hyp-type"><b>: </b><span>make_PrepareVote (fst (tr i) n) msg0 msg&#39; =
msg</span></span></span><br><span><var>H_in'</var><span class="hyp-type"><b>: </b><span>In msg&#39; (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view'</var><span class="hyp-type"><b>: </b><span>get_view msg&#39; = get_view msg0</span></span></span><br><span><var>H_type'</var><span class="hyp-type"><b>: </b><span>get_message_type msg&#39; = PrepareBlock</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>n0 = n</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_PrepareBlock_malicious_vote_type
  (fst (tr i) n) msg0 (fst (tr (S i)) n)
  lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_view msg0 =
get_view (make_PrepareVote (fst (tr i) n) msg0 msg&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3a2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3a2"><hr></label><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a3"><span class="nb">symmetry</span>; <span class="bp">easy</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg (out_messages (fst (tr (S i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      
      <span class="c">(* In the timeout case *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a4"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_sent.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_sent</var><span class="hyp-type"><b>: </b><span>In msg
  (out_messages
     (fst
        (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
         <span class="kr">if</span> is_member n participants
         <span class="kr">then</span> flip_timeout (fst (tr i) n)
         <span class="kr">else</span> fst (tr i) n, 
         snd (tr i)) n))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareVote</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (out_messages (fst (tr i) n))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg&#39;</span> : message,
  In msg&#39; (counting_messages (fst (tr (S i)) n)) /\
  get_message_type msg&#39; = PrepareBlock /\
  get_block msg&#39; = get_block msg /\
  get_view msg&#39; = get_view msg</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> is_member_correct <span class="kr">in</span> H_part;
        <span class="nb">simpl</span> <span class="kr">in</span> H_sent;
        <span class="nb">rewrite</span> H_part <span class="kr">in</span> H_sent;
        <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a5"><span class="kn">Lemma</span> <span class="nf">vote_quorum_current_view_persistent</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace), protocol_trace tr -&gt;
  <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat), In n participants -&gt;
  <span class="kr">forall</span> (<span class="nv">b</span> : block), vote_quorum_in_view (fst (tr i) n) (node_view (fst (tr i) n)) b -&gt;
  <span class="kr">forall</span> (<span class="nv">j</span> : nat), i &lt;= j -&gt;
  vote_quorum_in_view (fst (tr j) n) (node_view (fst (tr i) n)) b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
vote_quorum_in_view (fst (tr i) n)
  (node_view (fst (tr i) n)) b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
vote_quorum_in_view (fst (tr j) n)
  (node_view (fst (tr i) n)) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
vote_quorum_in_view (fst (tr i) n)
  (node_view (fst (tr i) n)) b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
vote_quorum_in_view (fst (tr j) n)
  (node_view (fst (tr i) n)) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a7"><span class="nb">intros</span> tr H_prot n i H_part b H_vote j H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n)
  (node_view (fst (tr i) n)) b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view (fst (tr j) n)
  (node_view (fst (tr i) n)) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a8"><span class="nb">unfold</span> vote_quorum_in_view, processed_PrepareVote_in_view_about_block,
   processed_PrepareVote_in_view_about_block <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3a9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3a9"><span class="nb">assert</span> (H_useful := @quorum_subset 
             (filter
                (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                 message_type_eqb (get_message_type msg)
                   PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
                 (get_view msg =? node_view (fst (tr i) n)))
                (counting_messages (fst (tr i) n)))
             (filter
                (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                 message_type_eqb (get_message_type msg)
                   PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
                 (get_view msg =? node_view (fst (tr i) n)))
                (counting_messages (fst (tr j) n)))
          H_vote).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3aa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3aa">spec H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n))) -&gt;
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3ab" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3ab"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ac" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ac"><span class="nb">intros</span> msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3ad" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3ad"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ae" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ae"><span class="nb">apply</span> filter_In <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3af" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3af"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b0"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in H_rest].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3b1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3b1"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b2"><span class="nb">apply</span> filter_In.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n)) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? node_view (fst (tr i) n)) = true</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3b3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3b3"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b4"><span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =?
        node_view (fst (tr i) n)))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? node_view (fst (tr i) n)) =
true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3b5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3b5"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b6"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_inclusion <span class="kr">with</span> i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =?
       node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? node_view (fst (tr i) n)))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">PrepareVote_about_block_in_view_global</span> (<span class="nv">tr</span> : GTrace) <span class="nv">i</span> <span class="nv">b</span> <span class="nv">p</span> :=
  filter
    (<span class="kr">fun</span> <span class="nv">msg</span> =&gt;
       message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
       block_eqb (get_block msg) b &amp;&amp;
       Nat.eqb (get_view msg) p)
    (snd (tr i)).</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">PrepareVote_about_block_global</span> (<span class="nv">tr</span> : GTrace) <span class="nv">i</span> <span class="nv">b</span> :=
  filter
    (<span class="kr">fun</span> <span class="nv">msg</span> =&gt;
       message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
       block_eqb (get_block msg) b)
    (snd (tr i)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">vote_quorum_in_view_global</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">b</span> <span class="nv">p</span> :=
  quorum (PrepareVote_about_block_in_view_global tr i b p).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b7"><span class="kn">Lemma</span> <span class="nf">vote_quorum_in_view_persistent</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace), protocol_trace tr -&gt;
  <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat), In n participants -&gt;
  <span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat), vote_quorum_in_view (fst (tr i) n) p b -&gt;
  <span class="kr">forall</span> (<span class="nv">j</span> : nat), i &lt;= j -&gt;
  vote_quorum_in_view (fst (tr j) n) p b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
vote_quorum_in_view (fst (tr i) n) p b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt; vote_quorum_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
vote_quorum_in_view (fst (tr i) n) p b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt; vote_quorum_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3b9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3b9"><span class="nb">intros</span> tr H_prot n i H_part b p H_vote j H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ba" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ba"><span class="nb">unfold</span> vote_quorum_in_view, processed_PrepareVote_in_view_about_block <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3bb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3bb"><span class="nb">assert</span> (H_useful := @quorum_subset
                        (filter
                           (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                              message_type_eqb
                                (get_message_type msg) PrepareVote &amp;&amp;
                              block_eqb (get_block msg) b &amp;&amp;
                              (get_view msg =? p))
                           (counting_messages (fst (tr i) n)))
                        (filter
                           (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                              message_type_eqb
                                (get_message_type msg) PrepareVote &amp;&amp;
                              block_eqb (get_block msg) b &amp;&amp;
                              (get_view msg =? p))
                           (counting_messages (fst (tr j) n)))
                        H_vote).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3bc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3bc">spec H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? p))
     (counting_messages (fst (tr i) n))) -&gt;
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3bd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3bd"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3be" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3be"><span class="nb">intros</span> msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3bf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3bf"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c0"><span class="nb">apply</span> filter_In <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3c1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3c1"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c2"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in H_rest].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3c3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3c3"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c4"><span class="nb">apply</span> filter_In.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n)) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3c5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3c5"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c6"><span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr i) n))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (counting_messages (fst (tr j) n)))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3c7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3c7"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c8"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_inclusion <span class="kr">with</span> i.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr i) n)))</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p))
     (counting_messages (fst (tr j) n)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3c9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3c9"><span class="kn">Lemma</span> <span class="nf">vote_quorum_in_view_global_step</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">b</span> <span class="nv">p</span>,
    protocol_trace tr -&gt;
    vote_quorum_in_view_global tr i b p -&gt;
    vote_quorum_in_view_global tr (S i) b p.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
protocol_trace tr -&gt;
vote_quorum_in_view_global tr i b p -&gt;
vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ca" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ca"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
protocol_trace tr -&gt;
vote_quorum_in_view_global tr i b p -&gt;
vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3cb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3cb"><span class="nb">intros</span> tr i b p H_prot H_vote.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3cc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3cc"><span class="nb">unfold</span> vote_quorum_in_view_global, PrepareVote_about_block_in_view_global <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3cd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3cd"><span class="nb">assert</span> (H_useful := @quorum_subset
                        (filter
                           (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                              message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
                              block_eqb (get_block msg) b &amp;&amp; (get_view msg =? p)) 
                           (snd (tr i)))
                        (filter
                           (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
                              message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
                              block_eqb (get_block msg) b &amp;&amp; (get_view msg =? p)) 
                           (snd (tr (S i))))
                        H_vote).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ce" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ce">spec H_useful.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? p)) 
     (snd (tr i))) -&gt;
In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
      message_type_eqb (get_message_type msg0)
        PrepareVote &amp;&amp; block_eqb (get_block msg0) b &amp;&amp;
      (get_view msg0 =? p)) 
     (snd (tr (S i))))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3cf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3cf"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d0"><span class="nb">intros</span> msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3d1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3d1"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d2" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d2"><span class="nb">apply</span> filter_In <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3d3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3d3"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d4"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in H_rest].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3d5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3d5"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d6"><span class="nb">apply</span> filter_In.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i))) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3d7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3d7"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3d8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3d8"><span class="nb">split</span>; <span class="kp">try</span> <span class="bp">tauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">msg</span> : message,
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p)) 
      (snd (tr i))) -&gt;
 In msg
   (filter
      (<span class="kr">fun</span> <span class="nv">msg0</span> : message =&gt;
       message_type_eqb
         (get_message_type msg0)
         PrepareVote &amp;&amp;
       block_eqb (get_block msg0) b &amp;&amp;
       (get_view msg0 =? p))
      (snd (tr (S i))))) -&gt;
quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3d9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3d9"><hr></label><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3da" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3da"><span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr i)))</span></span></span><br><span><var>H_useful</var><span class="hyp-type"><b>: </b><span>quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb
        (get_message_type msg) PrepareVote &amp;&amp;
      block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (filter
     (<span class="kr">fun</span> <span class="nv">msg</span> : message =&gt;
      message_type_eqb (get_message_type msg)
        PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
      (get_view msg =? p)) 
     (snd (tr (S i))))</div></blockquote></div></div></small><span class="alectryon-wsp">   
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3db" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3db"><span class="kn">Lemma</span> <span class="nf">make_PrepareBlocks_message_type</span> :
  <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">msg0</span> <span class="nv">msg</span>, 
  In msg (make_PrepareBlocks s msg0) -&gt;
  get_message_type msg = PrepareBlock.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : NState) (<span class="nv">msg0</span> <span class="nv">msg</span> : message),
In msg (make_PrepareBlocks s msg0) -&gt;
get_message_type msg = PrepareBlock</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3dc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3dc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : NState) (<span class="nv">msg0</span> <span class="nv">msg</span> : message),
In msg (make_PrepareBlocks s msg0) -&gt;
get_message_type msg = PrepareBlock</div></blockquote></div></div></small><span class="alectryon-wsp">         
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3dd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3dd"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>NState</span></span></span><br><span><var>msg0, msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (make_PrepareBlocks s msg0)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg = PrepareBlock</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3de" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3de"><span class="nb">unfold</span> make_PrepareBlocks <span class="kr">in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>NState</span></span></span><br><span><var>msg0, msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg
  [{|
     get_message_type := PrepareBlock;
     get_view := node_view s;
     get_sender := node_id s;
     get_block :=
       generate_new_block (get_block msg0);
     get_piggyback_block := get_block msg0
   |};
   {|
     get_message_type := PrepareBlock;
     get_view := node_view s;
     get_sender := node_id s;
     get_block :=
       generate_new_block
         (generate_new_block (get_block msg0));
     get_piggyback_block := get_block msg0
   |};
   {|
     get_message_type := PrepareBlock;
     get_view := node_view s;
     get_sender := node_id s;
     get_block :=
       generate_last_block
         (generate_new_block
            (generate_new_block (get_block msg0)));
     get_piggyback_block := get_block msg0
   |}]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">get_message_type msg = PrepareBlock</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">simpl</span> <span class="kr">in</span> H;
    <span class="nb">destruct</span> H <span class="kr">as</span> [H | [H | [H | H]]];
    <span class="nb">subst</span>; <span class="kp">try</span> <span class="bp">easy</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3df" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3df"><span class="kn">Lemma</span> <span class="nf">ViewChange_quorum_global</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
      In msg (snd (tr i)) -&gt;
      get_message_type msg = ViewChange -&gt;
      vote_quorum_in_view_global tr i (get_block msg) (get_view msg).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i (get_block msg)
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">msg</span> : message),
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i (get_block msg)
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e1" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e1"><span class="nb">intros</span> tr H_prot i; 
    <span class="nb">induction</span> i <span class="kr">as</span> [|i IH_prot];
    <span class="nb">intros</span> msg H_in H_type.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr <span class="mi">0</span>))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr <span class="mi">0</span> (get_block msg)
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3e2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br></div><label class="goal-separator" for="global-v-chk3e2"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr <span class="mi">0</span>))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr <span class="mi">0</span> 
  (get_block msg) (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> H_prot <span class="kr">as</span> [H_init _];
      <span class="nb">rewrite</span> H_init <span class="kr">in</span> H_in;
      <span class="nb">inversion</span> H_in.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e4" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e4">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp">  </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e5"><span class="nb">destruct</span> (In_dec message_eq_dec msg (snd (tr i))) <span class="kr">as</span> [H_old | H_new].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3e6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3e6"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e7">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e8"><span class="nb">apply</span> vote_quorum_in_view_global_step;
         <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_old</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr i 
  (get_block msg) (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> IH_prot.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3e9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3e9">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ea" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ea"><span class="nb">assert</span> (H_prot_copy := H_prot); 
         <span class="nb">destruct</span> H_prot <span class="kr">as</span> [_ H_prot];
         spec H_prot i;
         <span class="nb">destruct</span> H_prot <span class="kr">as</span> [[n0 [H_in0 [p0 [msg0 [lm0 [H_step H_deliver]]]]]] | H_timeout].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3eb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3eb"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ec" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ec"><span class="nb">assert</span> (H_in_copy := H_in); 
         <span class="nb">rewrite</span> H_deliver <span class="kr">in</span> H_in; 
         <span class="nb">simpl</span> <span class="kr">in</span> H_in;
         <span class="nb">rewrite</span> in_app_iff <span class="kr">in</span> H_in;
         <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in | H_in];
         <span class="kp">try</span> <span class="bp">contradiction</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg lm0</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>p0</var><span class="hyp-type"><b>: </b><span>NState_transition_type</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_step</var><span class="hyp-type"><b>: </b><span>get_transition p0 (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_in_copy</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3ed" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3ed"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ee" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ee"><span class="nb">assert</span> (H_step_copy := H_step);
         <span class="nb">destruct</span> p0;
         <span class="nb">destruct</span> H_step <span class="kr">as</span> [H_update [H_out H_rest]];
         <span class="nb">rewrite</span> H_out <span class="kr">in</span> H_in; 
         <span class="c">(* For all cases that do not send messages *)</span> 
         <span class="kp">try</span> (<span class="nb">simpl</span> <span class="kr">in</span> H_in;
              <span class="bp">contradiction</span>);
         <span class="kp">try</span> (<span class="nb">apply</span> make_PrepareBlocks_message_type <span class="kr">in</span> H_in;
              <span class="nb">rewrite</span> H_type <span class="kr">in</span> H_in; <span class="bp">discriminate</span>);
         <span class="kp">try</span> <span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in | H_in]; 
         <span class="kp">try</span> (<span class="nb">rewrite</span> &lt;- H_in <span class="kr">in</span> H_type;
              <span class="nb">simpl</span> <span class="kr">in</span> H_type;
              <span class="bp">discriminate</span>); 
         <span class="kp">try</span> (<span class="nb">apply</span> pending_PrepareVote_correct <span class="kr">in</span> H_in;
              <span class="nb">rewrite</span> H_type <span class="kr">in</span> H_in; <span class="bp">easy</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n0) msg0 /\
received (fst (tr i) n0)
  {|
    get_message_type := PrepareQC;
    get_view := get_view msg0;
    get_sender := get_sender msg0;
    get_block :=
      get_block
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0));
    get_piggyback_block := GenesisBlock
  |} /\
honest_node (node_id (fst (tr i) n0)) /\
get_message_type msg0 = ViewChange /\
view_valid (fst (tr i) n0) msg0 /\
view_change_quorum_in_view
  (process (fst (tr i) n0) msg0)
  (node_view (fst (tr i) n0)) /\
is_block_proposer (node_id (fst (tr i) n0))
  (S (node_view (fst (tr i) n0)))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_in_copy</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3ef" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3ef"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f0" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f0"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in | H_in].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>make_ViewChangeQC (fst (tr i) n0)
  (highest_ViewChange_message
     (process (fst (tr i) n0) msg0)) = msg</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n0) msg0 /\
received (fst (tr i) n0)
  {|
    get_message_type := PrepareQC;
    get_view := get_view msg0;
    get_sender := get_sender msg0;
    get_block :=
      get_block
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0));
    get_piggyback_block := GenesisBlock
  |} /\
honest_node (node_id (fst (tr i) n0)) /\
get_message_type msg0 = ViewChange /\
view_valid (fst (tr i) n0) msg0 /\
view_change_quorum_in_view
  (process (fst (tr i) n0) msg0)
  (node_view (fst (tr i) n0)) /\
is_block_proposer (node_id (fst (tr i) n0))
  (S (node_view (fst (tr i) n0)))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_in_copy</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3f1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view (fst (tr i) n0))
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n0) msg0 /\
received (fst (tr i) n0)
  {|
    get_message_type := PrepareQC;
    get_view := get_view msg0;
    get_sender := get_sender msg0;
    get_block :=
      get_block
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0));
    get_piggyback_block := GenesisBlock
  |} /\
honest_node (node_id (fst (tr i) n0)) /\
get_message_type msg0 = ViewChange /\
view_valid (fst (tr i) n0) msg0 /\
view_change_quorum_in_view
  (process (fst (tr i) n0) msg0)
  (node_view (fst (tr i) n0)) /\
is_block_proposer (node_id (fst (tr i) n0))
  (S (node_view (fst (tr i) n0)))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_in_copy</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><label class="goal-separator" for="global-v-chk3f1"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><input class="alectryon-extra-goal-toggle" id="global-v-chk3f2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3f2"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f3" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f3"><span class="nb">rewrite</span> &lt;- H_in <span class="kr">in</span> H_type;
         <span class="nb">simpl</span> <span class="kr">in</span> H_type; <span class="bp">discriminate</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>lm0</var><span class="hyp-type"><b>: </b><span>list message</span></span></span><br><span><var>msg0</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (make_PrepareBlocks
     (increment_view (fst (tr i) n0))
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_in0</var><span class="hyp-type"><b>: </b><span>In n0 participants</span></span></span><br><span><var>H_update</var><span class="hyp-type"><b>: </b><span>fst (tr (S i)) n0 =
record_plural
  (increment_view
     (process
        (process (fst (tr i) n0) msg0)
        {|
          get_message_type := PrepareQC;
          get_view := get_view msg0;
          get_sender := get_sender msg0;
          get_block :=
            get_block
              (highest_ViewChange_message
                 (process 
                    (fst (tr i) n0) msg0));
          get_piggyback_block :=
            GenesisBlock
        |}))
  ({|
     get_message_type := PrepareQC;
     get_view := node_view (fst (tr i) n0);
     get_sender := node_id (fst (tr i) n0);
     get_block :=
       get_block
         (highest_ViewChange_message
            (process (fst (tr i) n0) msg0));
     get_piggyback_block := GenesisBlock
   |}
   :: make_ViewChangeQC 
        (fst (tr i) n0)
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))
      :: make_PrepareBlocks
           (increment_view (fst (tr i) n0))
           (highest_ViewChange_message
              (process (fst (tr i) n0) msg0)))</span></span></span><br><span><var>H_out</var><span class="hyp-type"><b>: </b><span>lm0 =
{|
  get_message_type := PrepareQC;
  get_view := node_view (fst (tr i) n0);
  get_sender := node_id (fst (tr i) n0);
  get_block :=
    get_block
      (highest_ViewChange_message
         (process (fst (tr i) n0) msg0));
  get_piggyback_block := GenesisBlock
|}
:: make_ViewChangeQC (fst (tr i) n0)
     (highest_ViewChange_message
        (process (fst (tr i) n0) msg0))
   :: make_PrepareBlocks
        (increment_view (fst (tr i) n0))
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0))</span></span></span><br><span><var>H_rest</var><span class="hyp-type"><b>: </b><span>received (fst (tr i) n0) msg0 /\
received (fst (tr i) n0)
  {|
    get_message_type := PrepareQC;
    get_view := get_view msg0;
    get_sender := get_sender msg0;
    get_block :=
      get_block
        (highest_ViewChange_message
           (process (fst (tr i) n0) msg0));
    get_piggyback_block := GenesisBlock
  |} /\
honest_node (node_id (fst (tr i) n0)) /\
get_message_type msg0 = ViewChange /\
view_valid (fst (tr i) n0) msg0 /\
view_change_quorum_in_view
  (process (fst (tr i) n0) msg0)
  (node_view (fst (tr i) n0)) /\
is_block_proposer (node_id (fst (tr i) n0))
  (S (node_view (fst (tr i) n0)))</span></span></span><br><span><var>H_deliver</var><span class="hyp-type"><b>: </b><span>tr (S i) =
broadcast_messages (tr i) 
  (fst (tr i) n0) (fst (tr (S i)) n0) lm0</span></span></span><br><span><var>H_in_copy</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_step_copy</var><span class="hyp-type"><b>: </b><span>get_transition
  process_ViewChange_quorum_new_proposer_type
  (fst (tr i) n0) msg0
  (fst (tr (S i)) n0) lm0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk3f4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><label class="goal-separator" for="global-v-chk3f4"><hr></label><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f5" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f5">(<span class="nb">apply</span> make_PrepareBlocks_message_type <span class="kr">in</span> H_in;
        <span class="nb">rewrite</span> H_type <span class="kr">in</span> H_in; <span class="bp">discriminate</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr (S i)))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f6" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f6"><span class="nb">rewrite</span> H_timeout <span class="kr">in</span> H_in;
         <span class="nb">simpl</span> <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IH_prot</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg (snd (tr i)) -&gt;
get_message_type msg = ViewChange -&gt;
vote_quorum_in_view_global tr i
  (get_block msg) (get_view msg)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = ViewChange</span></span></span><br><span><var>H_new</var><span class="hyp-type"><b>: </b><span>~ In msg (snd (tr i))</span></span></span><br><span><var>H_prot_copy</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_timeout</var><span class="hyp-type"><b>: </b><span>tr (S i) =
(<span class="kr">fun</span> <span class="nv">n</span> : node =&gt;
 <span class="kr">if</span> is_member n participants
 <span class="kr">then</span> flip_timeout (fst (tr i) n)
 <span class="kr">else</span> fst (tr i) n, snd (tr i))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr 
  (S i) (get_block msg) 
  (get_view msg)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">       </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f7" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f7"><span class="kn">Lemma</span> <span class="nf">vote_quorum_local_means_vote_quorum_global</span> :
  <span class="kr">forall</span> <span class="nv">tr</span>,
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">b1</span> : block) (<span class="nv">p</span> : nat),
      In n participants -&gt;
      vote_quorum_in_view (fst (tr i) n) p b1 -&gt;
      vote_quorum_in_view_global tr i b1 p.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">b1</span> : block) (<span class="nv">p</span> : nat),
In n participants -&gt;
vote_quorum_in_view (fst (tr i) n) p b1 -&gt;
vote_quorum_in_view_global tr i b1 p</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f8" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">i</span> : nat) (<span class="nv">n</span> : node) (<span class="nv">b1</span> : block) (<span class="nv">p</span> : nat),
In n participants -&gt;
vote_quorum_in_view (fst (tr i) n) p b1 -&gt;
vote_quorum_in_view_global tr i b1 p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3f9" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3f9"><span class="nb">intros</span> tr H_prot i n b1 p H_part H_local.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n) p b1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr i b1 p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3fa" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3fa"><span class="nb">red</span> <span class="kr">in</span> H_local.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr i b1 p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3fb" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3fb"><span class="nb">apply</span> quorum_subset <span class="kr">with</span> (processed_PrepareVote_in_view_about_block (fst (tr i) n) p b1); <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1) -&gt;
In msg
  (PrepareVote_about_block_in_view_global tr i b1 p)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3fc" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3fc"><span class="nb">intros</span> msg H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (PrepareVote_about_block_in_view_global tr i b1 p)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3fd" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3fd"><span class="nb">apply</span> filter_In; 
  <span class="nb">apply</span> filter_In <span class="kr">in</span> H_in.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b1 &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3fe" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3fe"><span class="nb">destruct</span> H_in <span class="kr">as</span> [H_in H_typeblockview].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_typeblockview</var><span class="hyp-type"><b>: </b><span>message_type_eqb
  (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk3ff" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk3ff"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_typeblockview</var><span class="hyp-type"><b>: </b><span>message_type_eqb
  (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr i))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk400" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_typeblockview</var><span class="hyp-type"><b>: </b><span>message_type_eqb
  (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><label class="goal-separator" for="global-v-chk400"><hr></label><div class="goal-conclusion">message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk401" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk401"><span class="nb">apply</span> processed_means_sent_global <span class="kr">with</span> n; <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>H_local</var><span class="hyp-type"><b>: </b><span>quorum
  (processed_PrepareVote_in_view_about_block
     (fst (tr i) n) p b1)</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_typeblockview</var><span class="hyp-type"><b>: </b><span>message_type_eqb
  (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b1 &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk402" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk402"><span class="kn">Lemma</span> <span class="nf">vote_quorum_in_view_step_global</span> :
  <span class="kr">forall</span> <span class="nv">tr</span> <span class="nv">i</span> <span class="nv">b</span> <span class="nv">p</span>,
    protocol_trace tr -&gt;
    vote_quorum_in_view_global tr i b p -&gt; 
    vote_quorum_in_view_global tr (S i) b p.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
protocol_trace tr -&gt;
vote_quorum_in_view_global tr i b p -&gt;
vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk403" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk403"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">tr</span> : GTrace) (<span class="nv">i</span> : nat) (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
protocol_trace tr -&gt;
vote_quorum_in_view_global tr i b p -&gt;
vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk404" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk404"><span class="nb">intros</span> tr i b p H_prot H_prepare.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view_global tr (S i) b p</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk405" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk405"><span class="nb">red</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (PrepareVote_about_block_in_view_global tr (S i) b p)</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk406" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk406"><span class="nb">apply</span> quorum_subset <span class="kr">with</span> (PrepareVote_about_block_in_view_global tr i b p).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">quorum
  (PrepareVote_about_block_in_view_global tr i b p)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk407" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><label class="goal-separator" for="global-v-chk407"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (PrepareVote_about_block_in_view_global tr i b p) -&gt;
In msg
  (PrepareVote_about_block_in_view_global tr (S i) b p)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk408" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk408"><span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">msg</span> : message,
In msg
  (PrepareVote_about_block_in_view_global tr i b p) -&gt;
In msg
  (PrepareVote_about_block_in_view_global tr (S i) b p)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk409" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk409"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg
  (PrepareVote_about_block_in_view_global tr i b p)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (PrepareVote_about_block_in_view_global tr (S i) b p)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk40a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk40a"><span class="nb">apply</span> filter_In <span class="kr">in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg
  (PrepareVote_about_block_in_view_global tr (S i) b p)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk40b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk40b"><span class="nb">apply</span> filter_In.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i))) /\
message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk40c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk40c"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk40d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><label class="goal-separator" for="global-v-chk40d"><hr></label><div class="goal-conclusion">message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk40e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk40e"><span class="nb">destruct</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (snd (tr (S i)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk40f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><label class="goal-separator" for="global-v-chk40f"><hr></label><div class="goal-conclusion">message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk410" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk410"><span class="bp">now</span> <span class="nb">apply</span> global_messages_monotonic_step.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view_global tr i b p</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In msg (snd (tr i)) /\
message_type_eqb (get_message_type msg)
  PrepareVote &amp;&amp; block_eqb (get_block msg) b &amp;&amp;
(get_view msg =? p) = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">message_type_eqb (get_message_type msg) PrepareVote &amp;&amp;
block_eqb (get_block msg) b &amp;&amp; 
(get_view msg =? p) = true</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk411" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk411"><span class="kn">Lemma</span> <span class="nf">qc_current_view_persistent</span> :
 <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace), protocol_trace tr -&gt;
 <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat), In n participants -&gt;
 <span class="kr">forall</span> (<span class="nv">b</span> : block),
  (<span class="kr">exists</span> <span class="nv">msg</span> : message,
           In msg (counting_messages (fst (tr i) n)) /\
           get_view msg = node_view (fst (tr i) n) /\
           get_block msg = b /\ get_message_type msg = PrepareQC) -&gt;
 <span class="kr">forall</span> (<span class="nv">j</span> : nat), i &lt;= j -&gt;
  <span class="kr">exists</span> <span class="nv">msg</span> : message,
    In msg (counting_messages (fst (tr j) n)) /\
    get_view msg = node_view (fst (tr i) n) /\
    get_block msg = b /\ get_message_type msg = PrepareQC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (counting_messages (fst (tr i) n)) /\
   get_view msg = node_view (fst (tr i) n) /\
   get_block msg = b /\
   get_message_type msg = PrepareQC) -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
<span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = node_view (fst (tr i) n) /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk412" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk412"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (counting_messages (fst (tr i) n)) /\
   get_view msg = node_view (fst (tr i) n) /\
   get_block msg = b /\
   get_message_type msg = PrepareQC) -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
<span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = node_view (fst (tr i) n) /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">                                                  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk413" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk413"><span class="nb">intros</span> tr H_prot n i H_part b H_QC j H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_QC</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr i) n)) /\
  get_view msg = node_view (fst (tr i) n) /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = node_view (fst (tr i) n) /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk414" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk414"><span class="nb">destruct</span> H_QC <span class="kr">as</span> [msg [H_in [H_view [H_block H_type]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>get_view msg = node_view (fst (tr i) n)</span></span></span><br><span><var>H_block</var><span class="hyp-type"><b>: </b><span>get_block msg = b</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = node_view (fst (tr i) n) /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk415" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk415"><span class="kr">exists</span> <span class="nv">msg</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>get_view msg = node_view (fst (tr i) n)</span></span></span><br><span><var>H_block</var><span class="hyp-type"><b>: </b><span>get_block msg = b</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_inclusion <span class="kr">with</span> i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk416" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk416"><span class="kn">Lemma</span> <span class="nf">qc_in_view_persistent</span> :
 <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace), protocol_trace tr -&gt;
 <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat), In n participants -&gt;
 <span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
  (<span class="kr">exists</span> <span class="nv">msg</span> : message,
           In msg (counting_messages (fst (tr i) n)) /\
           get_view msg = p /\
           get_block msg = b /\ get_message_type msg = PrepareQC) -&gt;
 <span class="kr">forall</span> (<span class="nv">j</span> : nat), i &lt;= j -&gt;
  <span class="kr">exists</span> <span class="nv">msg</span> : message,
    In msg (counting_messages (fst (tr j) n)) /\
    get_view msg = p /\
    get_block msg = b /\ get_message_type msg = PrepareQC.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (counting_messages (fst (tr i) n)) /\
   get_view msg = p /\
   get_block msg = b /\
   get_message_type msg = PrepareQC) -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
<span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = p /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk417" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk417"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
(<span class="kr">exists</span> <span class="nv">msg</span> : message,
   In msg (counting_messages (fst (tr i) n)) /\
   get_view msg = p /\
   get_block msg = b /\
   get_message_type msg = PrepareQC) -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt;
<span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = p /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">                                                  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk418" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk418"><span class="nb">intros</span> tr H_prot n i H_part b p H_QC j H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_QC</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr i) n)) /\
  get_view msg = p /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = p /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk419" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk419"><span class="nb">destruct</span> H_QC <span class="kr">as</span> [msg [H_in [H_view [H_block H_type]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>get_view msg = p</span></span></span><br><span><var>H_block</var><span class="hyp-type"><b>: </b><span>get_block msg = b</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">msg</span> : message,
  In msg (counting_messages (fst (tr j) n)) /\
  get_view msg = p /\
  get_block msg = b /\
  get_message_type msg = PrepareQC</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41a"><span class="kr">exists</span> <span class="nv">msg</span>; <span class="kp">repeat</span> <span class="nb">split</span>; <span class="kp">try</span> <span class="bp">assumption</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>msg</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In msg (counting_messages (fst (tr i) n))</span></span></span><br><span><var>H_view</var><span class="hyp-type"><b>: </b><span>get_view msg = p</span></span></span><br><span><var>H_block</var><span class="hyp-type"><b>: </b><span>get_block msg = b</span></span></span><br><span><var>H_type</var><span class="hyp-type"><b>: </b><span>get_message_type msg = PrepareQC</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">In msg (counting_messages (fst (tr j) n))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> counting_messages_inclusion <span class="kr">with</span> i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41b"><span class="kn">Lemma</span> <span class="nf">prepare_in_view_persistent</span> :
  <span class="kr">forall</span> (<span class="nv">tr</span> : GTrace),
    protocol_trace tr -&gt;
    <span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
      In n participants -&gt;
      <span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
        prepare_stage_in_view (fst (tr i) n) p b -&gt;
        <span class="kr">forall</span> (<span class="nv">j</span> : nat),
          i &lt;= j -&gt;
          prepare_stage_in_view (fst (tr j) n) p b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
prepare_stage_in_view (fst (tr i) n) p b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt; prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">tr</span> : GTrace,
protocol_trace tr -&gt;
<span class="kr">forall</span> (<span class="nv">n</span> : node) (<span class="nv">i</span> : nat),
In n participants -&gt;
<span class="kr">forall</span> (<span class="nv">b</span> : block) (<span class="nv">p</span> : nat),
prepare_stage_in_view (fst (tr i) n) p b -&gt;
<span class="kr">forall</span> <span class="nv">j</span> : nat,
i &lt;= j -&gt; prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41d" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41d"><span class="nb">intros</span> tr H_prot n i H_part b p H_prepare j H_le.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>prepare_stage_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk41e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk41e"><span class="nb">destruct</span> H_prepare <span class="kr">as</span> [H_vote | H_QC].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">prepare_stage_in_view (fst (tr j) n) p b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk41f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_QC</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><label class="goal-separator" for="global-v-chk41f"><hr></label><div class="goal-conclusion">prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk420" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk420">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk421" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk421"><span class="nb">left</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vote_quorum_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> vote_quorum_in_view_persistent <span class="kr">with</span> i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk422" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk422">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_QC</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">prepare_stage_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk423" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk423"><span class="nb">right</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>tr</var><span class="hyp-type"><b>: </b><span>GTrace</span></span></span><br><span><var>H_prot</var><span class="hyp-type"><b>: </b><span>protocol_trace tr</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_part</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>p</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_QC</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view (fst (tr i) n) p b</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_le</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">PrepareQC_in_view (fst (tr j) n) p b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> qc_in_view_persistent <span class="kr">with</span> i.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
No blocks can be at prepare stage in <span class="inlinecode"><span class="id" title="var">GState_init</span></span>. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk424" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk424"><span class="kn">Lemma</span> <span class="nf">no_prepare_blocks_GState_init</span> :
  <span class="kr">forall</span> (<span class="nv">n</span> : node),
    In n participants -&gt;
    <span class="kr">forall</span> (<span class="nv">b</span> : block),
      prepare_stage (fst GState_init n) b -&gt;
      <span class="kt">False</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
prepare_stage (fst GState_init n) b -&gt; <span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk425" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk425"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">n</span> : node,
In n participants -&gt;
<span class="kr">forall</span> <span class="nv">b</span> : block,
prepare_stage (fst GState_init n) b -&gt; <span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk426" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk426"><span class="nb">intros</span> n H_in b H_stage.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_stage</var><span class="hyp-type"><b>: </b><span>prepare_stage (fst GState_init n) b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk427" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk427"><span class="nb">unfold</span> GState_init <span class="kr">in</span> H_stage.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_stage</var><span class="hyp-type"><b>: </b><span>prepare_stage
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)
  b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk428" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk428"><span class="nb">destruct</span> H_stage <span class="kr">as</span> [v_past [H_past H_prepare]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt;=
node_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>prepare_stage_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, [])
     n) v_past b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk429" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk429"><span class="nb">simpl</span> <span class="kr">in</span> H_past.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt;= <span class="mi">0</span></span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>prepare_stage_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, [])
     n) v_past b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk42a" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk42a"><span class="nb">assert</span> (v_past = <span class="mi">0</span>) <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>v_past</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span>v_past &lt;= <span class="mi">0</span></span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>prepare_stage_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, [])
     n) v_past b</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>v_past = <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk42b" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk42b"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_prepare</var><span class="hyp-type"><b>: </b><span>prepare_stage_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, [])
     n) <span class="mi">0</span> b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk42c" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk42c"><span class="nb">destruct</span> H_prepare <span class="kr">as</span> [H_vote | H_qc].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)
  <span class="mi">0</span> b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="global-v-chk42d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_qc</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n) <span class="mi">0</span>
  b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="global-v-chk42d"><hr></label><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk42e" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk42e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)
  <span class="mi">0</span> b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk42f" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk42f"><span class="nb">inversion</span> H_vote.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)
  <span class="mi">0</span> b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>has_at_least_two_thirdsb [] = true</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk430" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk430"><span class="nb">apply</span> empty_has_no_two_thirds <span class="kr">in</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_vote</var><span class="hyp-type"><b>: </b><span>vote_quorum_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)
  <span class="mi">0</span> b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span><span class="kt">False</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">contradiction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk431" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk431">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_qc</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n) <span class="mi">0</span>
  b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk432" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk432"><span class="nb">inversion</span> H_qc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_qc</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n) <span class="mi">0</span>
  b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>In x
  (counting_messages
     (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n)) /\
get_view x = <span class="mi">0</span> /\
get_block x = b /\ get_message_type x = PrepareQC</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="global-v-chk433" style="display: none" type="checkbox"><label class="alectryon-input" for="global-v-chk433"><span class="nb">simpl</span> <span class="kr">in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>node</span></span></span><br><span><var>H_in</var><span class="hyp-type"><b>: </b><span>In n participants</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>block</span></span></span><br><span><var>H_qc</var><span class="hyp-type"><b>: </b><span>PrepareQC_in_view
  (fst (<span class="kr">fun</span> <span class="nv">n</span> : node =&gt; NState_init n, []) n) <span class="mi">0</span>
  b</span></span></span><br><span><var>H_past</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= <span class="mi">0</span></span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>message</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kt">False</span> /\
get_view x = <span class="mi">0</span> /\
get_block x = b /\ get_message_type x = PrepareQC</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">False</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">tauto</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></article></body></html>